<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveGeneric              #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE DerivingVia                #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts           #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE FlexibleInstances          #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE GADTs                      #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE KindSignatures             #-}</span><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE LambdaCase                 #-}</span><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE RankNTypes                 #-}</span><span>
</span><a name="line-10"></a><span class="hs-pragma">{-# LANGUAGE RecordWildCards            #-}</span><span>
</span><a name="line-11"></a><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables        #-}</span><span>
</span><a name="line-12"></a><span class="hs-pragma">{-# LANGUAGE StandaloneDeriving         #-}</span><span>
</span><a name="line-13"></a><span class="hs-pragma">{-# LANGUAGE UndecidableInstances       #-}</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ouroboros.Consensus.HardFork.History.Qry</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-16"></a><span>    </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><span class="hs-comment">-- Opaque</span><span>
</span><a name="line-17"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-18"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizonException"><span class="hs-identifier hs-type">PastHorizonException</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-19"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#qryFromExpr"><span class="hs-identifier hs-var">qryFromExpr</span></a><span>
</span><a name="line-20"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQuery"><span class="hs-identifier hs-var">runQuery</span></a><span>
</span><a name="line-21"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQueryThrow"><span class="hs-identifier hs-var">runQueryThrow</span></a><span>
</span><a name="line-22"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQueryPure"><span class="hs-identifier hs-var">runQueryPure</span></a><span>
</span><a name="line-23"></a><span>    </span><span class="hs-comment">-- * Interpreter</span><span>
</span><a name="line-24"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Interpreter"><span class="hs-identifier hs-type">Interpreter</span></a><span> </span><span class="hs-comment">-- opaque</span><span>
</span><a name="line-25"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#mkInterpreter"><span class="hs-identifier hs-var">mkInterpreter</span></a><span>
</span><a name="line-26"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#interpretQuery"><span class="hs-identifier hs-var">interpretQuery</span></a><span>
</span><a name="line-27"></a><span>    </span><span class="hs-comment">-- * Specific queries</span><span>
</span><a name="line-28"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#wallclockToSlot"><span class="hs-identifier hs-var">wallclockToSlot</span></a><span>
</span><a name="line-29"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToWallclock"><span class="hs-identifier hs-var">slotToWallclock</span></a><span>
</span><a name="line-30"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpoch%27"><span class="hs-identifier hs-var">slotToEpoch'</span></a><span>
</span><a name="line-31"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpoch"><span class="hs-identifier hs-var">slotToEpoch</span></a><span>
</span><a name="line-32"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlot%27"><span class="hs-identifier hs-var">epochToSlot'</span></a><span>
</span><a name="line-33"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlot"><span class="hs-identifier hs-var">epochToSlot</span></a><span>
</span><a name="line-34"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSize"><span class="hs-identifier hs-var">epochToSize</span></a><span>
</span><a name="line-35"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Codec.Serialise</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Serialise</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Exception</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">throw</span><span class="hs-special">)</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.Except</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Bifunctor</span><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Fixed</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">divMod'</span><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Foldable</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toList</span><span class="hs-special">)</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Functor.Identity</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Kind</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span>           </span><a href="Data.SOP.Strict.html"><span class="hs-identifier">Data.SOP.Strict</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">SListI</span><span class="hs-special">)</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Time</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">UTCTime</span><span class="hs-special">)</span><span>
</span><a name="line-47"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Word</span><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">GHC.Generics</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">GHC.Show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">showSpace</span><span class="hs-special">)</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">GHC.Stack</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Quiet</span><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.Block.html"><span class="hs-identifier">Ouroboros.Consensus.Block</span></a><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html"><span class="hs-identifier">Ouroboros.Consensus.BlockchainTime.WallClock.Types</span></a><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.Util.html"><span class="hs-identifier">Ouroboros.Consensus.Util</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Util.html#Some"><span class="hs-identifier hs-type">Some</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.Util.Counting.html"><span class="hs-identifier">Ouroboros.Consensus.Util.Counting</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Util.Counting.html#NonEmpty"><span class="hs-identifier hs-type">NonEmpty</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.Util.IOLike.html"><span class="hs-identifier">Ouroboros.Consensus.Util.IOLike</span></a><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.HardFork.History.EraParams.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.History.EraParams</span></a><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.HardFork.History.Summary.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.History.Summary</span></a><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.HardFork.History.Util.html"><span class="hs-identifier">Ouroboros.Consensus.HardFork.History.Util</span></a><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span class="hs-comment">{-------------------------------------------------------------------------------
  Internal: reified queries

  NOTE. The lower bound of every era is inclusive, while the upper bound is
  really exclusive, making the upper bound of every era equal to the lower
  bound of the next.

  &gt;         era A         era B         era C
  &gt;        [.....) [...............) [..........)
  &gt; epoch         e                 e'
  &gt; slot          s                 s'
  &gt; time          t                 t'

  Now let's consider what happens when we do translations of the values at
  the boundary.

   1. Slot-to-epoch translation. Using era C, we get

      &gt; e' + ((s' - s') / epochSizeC) == e'

      Using era B (technically the wrong era to be using, since the upper bound
      is exclusive), we get

      &gt; e + ((s' - s) / epochSizeB)

      These are equal by (INV-1a).

   2. Epoch-to-slot translation. Using era C, we get

      &gt; s' + ((e' - e') * epochSizeC) == s'

      Using era B, we'd get

      &gt; s + ((e' - e) * epochSizeB

      These are equal by (INV-1b).

   3. Slot to time translation. Using era C, we get

      &gt; t' + ((s' - s') * slotLenC) == t'

      Using era C, we get

      &gt; t + ((s' - s) * slotLenB)

      These are equal by (INV-2b)

   4. Time to slot translation. Using era C, we get

      &gt; s' + ((t' - t') / slotLenC) == s'

      Using era B, we get

      &gt; s + ((t' - t) / slotLenB)

      These are equal by (INV-2a).

  This means that for values at that boundary, it does not matter if we use
  this era or the next era for the translation. However, this is only true for
  these 4 translations. If we are returning the era parameters directly, then
  of course we can't use the era parameters from the wrong era.

  There is however a benefit to using the current era: there might not /be/
  a next era, and so if we use the current era, we extend the period for which
  we do calculations just that tiny bit more. This might be important for
  ledger implementations. For example, suppose we want to know if a particular
  slot @s@ is far enough away from the next epoch boundary (e.g., to determine
  if an update proposal should take effect in this epoch or the next). One
  natural way to write this would be to translate @s@ to the corresponding
  epoch @e@, then translate @e + 1@ back to a slot @s'@, and check the
  distance @s' - s@. However, it is conceivable that the safe zone stops at
  that epoch boundary; if it does, this computation would result in a
  'PastHorizonException', even if a different way to write the same computation
  (translating @s + delta@ to an epoch number, and then comparing that to @e@)
  might succeed. Rather than imposing an unnecessary limitation on the ledger,
  we therefore treat the upper bound as inclusive, so that both ways to do the
  check would succeed.
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span class="hs-comment">-- | Query</span><span>
</span><a name="line-143"></a><span class="hs-comment">--</span><span>
</span><a name="line-144"></a><span class="hs-comment">-- 'Qry' adds a monadic interface on top of 'Expr'. Although means that 'Qry'</span><span>
</span><a name="line-145"></a><span class="hs-comment">-- itself is not showable, the 'PastHorizonException' can nonetheless show the</span><span>
</span><a name="line-146"></a><span class="hs-comment">-- offending expression alongside the 'Summary' against which it was evaluated.</span><span>
</span><a name="line-147"></a><span class="hs-keyword">data</span><span> </span><a name="Qry"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier">Qry</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-148"></a><span>  </span><a name="QPure"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QPure"><span class="hs-identifier">QPure</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679586182"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="#local-6989586621679586182"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-149"></a><span>  </span><a name="QExpr"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QExpr"><span class="hs-identifier">QExpr</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ClosedExpr"><span class="hs-identifier hs-type">ClosedExpr</span></a><span> </span><a href="#local-6989586621679586183"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679586183"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="#local-6989586621679586184"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="#local-6989586621679586184"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-150"></a><span>
</span><a name="line-151"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-152"></a><span>  </span><a name="local-3458764513820541101"><span class="hs-identifier">fmap</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftM</span><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-155"></a><span>  </span><a name="local-3458764513820541680"><span class="hs-identifier">pure</span></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QPure"><span class="hs-identifier hs-var">QPure</span></a><span>
</span><a name="line-156"></a><span>  </span><span class="hs-special">(</span><a name="local-3458764513820541679"><span class="hs-operator">&lt;*&gt;</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ap</span><span>
</span><a name="line-157"></a><span>
</span><a name="line-158"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-159"></a><span>  </span><a name="local-3458764513820541102"><span class="hs-identifier">return</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">pure</span><span>
</span><a name="line-160"></a><span>  </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QPure"><span class="hs-identifier hs-var">QPure</span></a><span> </span><a name="local-6989586621679586214"><a href="#local-6989586621679586214"><span class="hs-identifier">a</span></a></a><span>   </span><a name="local-3458764513820541099"><span class="hs-operator">&gt;&gt;=</span></a><span> </span><a name="local-6989586621679586215"><a href="#local-6989586621679586215"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679586215"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679586214"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-161"></a><span>  </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QExpr"><span class="hs-identifier hs-var">QExpr</span></a><span> </span><a name="local-6989586621679586216"><a href="#local-6989586621679586216"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621679586217"><a href="#local-6989586621679586217"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-operator">&gt;&gt;=</span><span> </span><a name="local-6989586621679586218"><a href="#local-6989586621679586218"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QExpr"><span class="hs-identifier hs-var">QExpr</span></a><span> </span><a href="#local-6989586621679586216"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679586217"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">&gt;=&gt;</span><span> </span><a href="#local-6989586621679586218"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-162"></a><span>
</span><a name="line-163"></a><span class="hs-comment">-- | Construct a 'Qry' from a closed 'Expr'</span><span>
</span><a name="line-164"></a><span class="hs-identifier">qryFromExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679586238"><a href="#local-6989586621679586238"><span class="hs-identifier">f</span></a></a><span class="hs-operator">.</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586238"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679586237"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="#local-6989586621679586237"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-165"></a><a name="qryFromExpr"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#qryFromExpr"><span class="hs-identifier">qryFromExpr</span></a></a><span> </span><a name="local-6989586621679586239"><a href="#local-6989586621679586239"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QExpr"><span class="hs-identifier hs-var">QExpr</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ClosedExpr"><span class="hs-identifier hs-var">ClosedExpr</span></a><span> </span><a href="#local-6989586621679586239"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QPure"><span class="hs-identifier hs-var">QPure</span></a><span>
</span><a name="line-166"></a><span>
</span><a name="line-167"></a><span class="hs-comment">{-------------------------------------------------------------------------------
  Clarifying newtypes
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-170"></a><span>
</span><a name="line-171"></a><span class="hs-keyword">newtype</span><span> </span><a name="TimeInEra"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier">TimeInEra</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a name="TimeInEra"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier">TimeInEra</span></a></a><span>   </span><span class="hs-special">{</span><span> </span><a name="getTimeInEra"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#getTimeInEra"><span class="hs-identifier">getTimeInEra</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">NominalDiffTime</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-172"></a><span class="hs-keyword">newtype</span><span> </span><a name="TimeInSlot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier">TimeInSlot</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="TimeInSlot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier">TimeInSlot</span></a></a><span>  </span><span class="hs-special">{</span><span> </span><a name="getTimeInSlot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#getTimeInSlot"><span class="hs-identifier">getTimeInSlot</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">NominalDiffTime</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-173"></a><span class="hs-keyword">newtype</span><span> </span><a name="SlotInEra"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier">SlotInEra</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><a name="SlotInEra"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier">SlotInEra</span></a></a><span>   </span><span class="hs-special">{</span><span> </span><a name="getSlotInEra"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#getSlotInEra"><span class="hs-identifier">getSlotInEra</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word64</span><span> </span><span class="hs-special">}</span><span>          </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-174"></a><span class="hs-keyword">newtype</span><span> </span><a name="SlotInEpoch"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier">SlotInEpoch</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="SlotInEpoch"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier">SlotInEpoch</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="getSlotInEpoch"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#getSlotInEpoch"><span class="hs-identifier">getSlotInEpoch</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word64</span><span> </span><span class="hs-special">}</span><span>          </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-175"></a><span class="hs-keyword">newtype</span><span> </span><a name="EpochInEra"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier">EpochInEra</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="EpochInEra"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier">EpochInEra</span></a></a><span>  </span><span class="hs-special">{</span><span> </span><a name="getEpochInEra"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#getEpochInEra"><span class="hs-identifier">getEpochInEra</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word64</span><span> </span><span class="hs-special">}</span><span>          </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-identifier hs-type">Quiet</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier hs-type">TimeInEra</span></a><span>   </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier hs-type">TimeInEra</span></a><span>
</span><a name="line-178"></a><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-identifier hs-type">Quiet</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier hs-type">TimeInSlot</span></a><span>  </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier hs-type">TimeInSlot</span></a><span>
</span><a name="line-179"></a><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-identifier hs-type">Quiet</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-type">SlotInEra</span></a><span>   </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-type">SlotInEra</span></a><span>
</span><a name="line-180"></a><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-identifier hs-type">Quiet</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier hs-type">SlotInEpoch</span></a><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier hs-type">SlotInEpoch</span></a><span>
</span><a name="line-181"></a><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-identifier hs-type">Quiet</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier hs-type">EpochInEra</span></a><span>  </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier hs-type">EpochInEra</span></a><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span class="hs-comment">{-------------------------------------------------------------------------------
  Expressions
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span class="hs-keyword">data</span><span> </span><a name="ClosedExpr"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ClosedExpr"><span class="hs-identifier">ClosedExpr</span></a></a><span> </span><a name="local-6989586621679586180"><a href="#local-6989586621679586180"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ClosedExpr"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ClosedExpr"><span class="hs-identifier">ClosedExpr</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679586181"><a href="#local-6989586621679586181"><span class="hs-identifier">f</span></a></a><span class="hs-operator">.</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586181"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679586180"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-188"></a><span>
</span><a name="line-189"></a><span class="hs-comment">-- | Query expressions in PHOAS</span><span>
</span><a name="line-190"></a><span class="hs-keyword">data</span><span> </span><a name="Expr"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier">Expr</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679586151"><a href="#local-6989586621679586151"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Type</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-191"></a><span>  </span><span class="hs-comment">-- PHOAS infrastructure</span><span>
</span><a name="line-192"></a><span>
</span><a name="line-193"></a><span>  </span><a name="EVar"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EVar"><span class="hs-identifier">EVar</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679586152"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679586153"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586152"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679586153"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-194"></a><span>  </span><a name="ELit"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELit"><span class="hs-identifier">ELit</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="#local-6989586621679586154"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679586154"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586155"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679586154"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-195"></a><span>  </span><a name="ELet"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELet"><span class="hs-identifier">ELet</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586156"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679586157"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679586156"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679586157"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586156"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679586158"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586156"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679586158"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-196"></a><span>
</span><a name="line-197"></a><span>  </span><span class="hs-comment">-- Support for pairs makes expressions more easily composable</span><span>
</span><a name="line-198"></a><span>
</span><a name="line-199"></a><span>  </span><a name="EPair"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EPair"><span class="hs-identifier">EPair</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586159"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679586160"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586159"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679586161"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586159"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679586160"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679586161"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-200"></a><span>  </span><a name="EFst"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EFst"><span class="hs-identifier">EFst</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586162"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679586163"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679586164"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586162"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679586163"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-201"></a><span>  </span><a name="ESnd"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ESnd"><span class="hs-identifier">ESnd</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586165"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679586166"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679586167"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586165"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679586167"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-202"></a><span>
</span><a name="line-203"></a><span>  </span><span class="hs-comment">-- Convert from absolute to era-relative</span><span>
</span><a name="line-204"></a><span>
</span><a name="line-205"></a><span>  </span><a name="EAbsToRelTime"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EAbsToRelTime"><span class="hs-identifier">EAbsToRelTime</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586168"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#RelativeTime"><span class="hs-identifier hs-type">RelativeTime</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586168"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier hs-type">TimeInEra</span></a><span>
</span><a name="line-206"></a><span>  </span><a name="EAbsToRelSlot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EAbsToRelSlot"><span class="hs-identifier">EAbsToRelSlot</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586169"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586169"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-type">SlotInEra</span></a><span>
</span><a name="line-207"></a><span>  </span><a name="EAbsToRelEpoch"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EAbsToRelEpoch"><span class="hs-identifier">EAbsToRelEpoch</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586170"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586170"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier hs-type">EpochInEra</span></a><span>
</span><a name="line-208"></a><span>
</span><a name="line-209"></a><span>  </span><span class="hs-comment">-- Convert from era-relative to absolute</span><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span>  </span><a name="ERelToAbsTime"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelToAbsTime"><span class="hs-identifier">ERelToAbsTime</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586171"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier hs-type">TimeInEra</span></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586171"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#RelativeTime"><span class="hs-identifier hs-type">RelativeTime</span></a><span>
</span><a name="line-212"></a><span>  </span><a name="ERelToAbsSlot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelToAbsSlot"><span class="hs-identifier">ERelToAbsSlot</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586172"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-type">SlotInEra</span></a><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier hs-type">TimeInSlot</span></a><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586172"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a><span>
</span><a name="line-213"></a><span>  </span><a name="ERelToAbsEpoch"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelToAbsEpoch"><span class="hs-identifier">ERelToAbsEpoch</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586173"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier hs-type">EpochInEra</span></a><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier hs-type">SlotInEpoch</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586173"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a><span>
</span><a name="line-214"></a><span>
</span><a name="line-215"></a><span>  </span><span class="hs-comment">-- Convert between relative values</span><span>
</span><a name="line-216"></a><span>
</span><a name="line-217"></a><span>  </span><a name="ERelTimeToSlot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelTimeToSlot"><span class="hs-identifier">ERelTimeToSlot</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586174"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier hs-type">TimeInEra</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586174"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-type">SlotInEra</span></a><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier hs-type">TimeInSlot</span></a><span class="hs-special">)</span><span>
</span><a name="line-218"></a><span>  </span><a name="ERelSlotToTime"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelSlotToTime"><span class="hs-identifier">ERelSlotToTime</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586175"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-type">SlotInEra</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586175"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier hs-type">TimeInEra</span></a><span>
</span><a name="line-219"></a><span>  </span><a name="ERelSlotToEpoch"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelSlotToEpoch"><span class="hs-identifier">ERelSlotToEpoch</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586176"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-type">SlotInEra</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586176"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier hs-type">EpochInEra</span></a><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier hs-type">SlotInEpoch</span></a><span class="hs-special">)</span><span>
</span><a name="line-220"></a><span>  </span><a name="ERelEpochToSlot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelEpochToSlot"><span class="hs-identifier">ERelEpochToSlot</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586177"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier hs-type">EpochInEra</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586177"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-type">SlotInEra</span></a><span>
</span><a name="line-221"></a><span>
</span><a name="line-222"></a><span>  </span><span class="hs-comment">-- Get era parameters</span><span>
</span><a name="line-223"></a><span>  </span><span class="hs-comment">-- The arguments are used for bound checks</span><span>
</span><a name="line-224"></a><span>
</span><a name="line-225"></a><span>  </span><a name="ESlotLength"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ESlotLength"><span class="hs-identifier">ESlotLength</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586178"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586178"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#SlotLength"><span class="hs-identifier hs-type">SlotLength</span></a><span>
</span><a name="line-226"></a><span>  </span><a name="EEpochSize"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EEpochSize"><span class="hs-identifier">EEpochSize</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586179"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586179"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochSize"><span class="hs-identifier hs-type">EpochSize</span></a><span>
</span><a name="line-227"></a><span>
</span><a name="line-228"></a><span class="hs-comment">{-------------------------------------------------------------------------------
  Interpreter
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-231"></a><span>
</span><a name="line-232"></a><span class="hs-identifier">evalExprInEra</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraSummary"><span class="hs-identifier hs-type">EraSummary</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ClosedExpr"><span class="hs-identifier hs-type">ClosedExpr</span></a><span> </span><a href="#local-6989586621679586236"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679586236"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-233"></a><a name="evalExprInEra"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#evalExprInEra"><span class="hs-identifier">evalExprInEra</span></a></a><span> </span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraSummary"><span class="hs-identifier hs-var">EraSummary</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ClosedExpr"><span class="hs-identifier hs-var">ClosedExpr</span></a><span> </span><a name="local-6989586621679586297"><a href="#local-6989586621679586297"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679586249"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586297"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-234"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-235"></a><span>    </span><a href="Ouroboros.Consensus.HardFork.History.EraParams.html#EraParams"><span class="hs-identifier hs-var">EraParams</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679586242"><span class="hs-identifier hs-var">eraParams</span></a><span>
</span><a name="line-236"></a><span>    </span><a name="local-6989586621679586246"><a href="#local-6989586621679586246"><span class="hs-identifier">slotLen</span></a></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">getSlotLength</span><span> </span><a href="#local-6989586621679586244"><span class="hs-identifier hs-var">eraSlotLength</span></a><span>
</span><a name="line-237"></a><span>    </span><a name="local-6989586621679586247"><a href="#local-6989586621679586247"><span class="hs-identifier">epochSize</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">unEpochSize</span><span>   </span><a href="#local-6989586621679586243"><span class="hs-identifier hs-var">eraEpochSize</span></a><span>
</span><a name="line-238"></a><span>
</span><a name="line-239"></a><span>    </span><span class="hs-identifier">guardEnd</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Bound"><span class="hs-identifier hs-type">Bound</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-240"></a><span>    </span><a name="local-6989586621679586248"><a href="#local-6989586621679586248"><span class="hs-identifier">guardEnd</span></a></a><span> </span><a name="local-6989586621679586251"><a href="#local-6989586621679586251"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-241"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679586241"><span class="hs-identifier hs-var">eraEnd</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-242"></a><span>          </span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraUnbounded"><span class="hs-identifier hs-var">EraUnbounded</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-243"></a><span>          </span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraEnd"><span class="hs-identifier hs-var">EraEnd</span></a><span> </span><a name="local-6989586621679586252"><a href="#local-6989586621679586252"><span class="hs-identifier">b</span></a></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679586251"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679586252"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-244"></a><span>
</span><a name="line-245"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><span class="hs-identifier hs-type">Identity</span><span> </span><a href="#local-6989586621679586250"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679586250"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-246"></a><span>    </span><a name="local-6989586621679586249"><a href="#local-6989586621679586249"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EVar"><span class="hs-identifier hs-var">EVar</span></a><span> </span><a name="local-6989586621679586253"><a href="#local-6989586621679586253"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-247"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">runIdentity</span><span> </span><a href="#local-6989586621679586253"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-248"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELet"><span class="hs-identifier hs-var">ELet</span></a><span> </span><a name="local-6989586621679586254"><a href="#local-6989586621679586254"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621679586255"><a href="#local-6989586621679586255"><span class="hs-identifier">f</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-249"></a><span>        </span><a href="#local-6989586621679586249"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586254"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679586249"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679586255"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Identity</span><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span>    </span><span class="hs-comment">-- Literals and pairs</span><span>
</span><a name="line-252"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELit"><span class="hs-identifier hs-var">ELit</span></a><span> </span><a name="local-6989586621679586256"><a href="#local-6989586621679586256"><span class="hs-identifier">i</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-253"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679586256"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-254"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EPair"><span class="hs-identifier hs-var">EPair</span></a><span> </span><a name="local-6989586621679586257"><a href="#local-6989586621679586257"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621679586258"><a href="#local-6989586621679586258"><span class="hs-identifier">e'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-255"></a><span>        </span><a name="local-6989586621679586259"><a href="#local-6989586621679586259"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679586249"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586257"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-256"></a><span>        </span><a name="local-6989586621679586260"><a href="#local-6989586621679586260"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679586249"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586258"><span class="hs-identifier hs-var">e'</span></a><span>
</span><a name="line-257"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679586259"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679586260"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-258"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EFst"><span class="hs-identifier hs-var">EFst</span></a><span> </span><a name="local-6989586621679586261"><a href="#local-6989586621679586261"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-259"></a><span>       </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679586249"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586261"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-260"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ESnd"><span class="hs-identifier hs-var">ESnd</span></a><span> </span><a name="local-6989586621679586262"><a href="#local-6989586621679586262"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-261"></a><span>       </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679586249"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586262"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-262"></a><span>
</span><a name="line-263"></a><span>    </span><span class="hs-comment">-- Convert absolute to relative</span><span>
</span><a name="line-264"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-265"></a><span>    </span><span class="hs-comment">-- The guards here justify the subtractions.</span><span>
</span><a name="line-266"></a><span>
</span><a name="line-267"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EAbsToRelTime"><span class="hs-identifier hs-var">EAbsToRelTime</span></a><span> </span><a name="local-6989586621679586263"><a href="#local-6989586621679586263"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-268"></a><span>        </span><a name="local-6989586621679586264"><a href="#local-6989586621679586264"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679586249"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586263"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-269"></a><span>        </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679586264"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-identifier">boundTime</span><span> </span><a href="#local-6989586621679586240"><span class="hs-identifier hs-var">eraStart</span></a><span class="hs-special">)</span><span>
</span><a name="line-270"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier hs-var">TimeInEra</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679586264"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-special">`</span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#diffRelTime"><span class="hs-identifier hs-var">diffRelTime</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">boundTime</span><span> </span><a href="#local-6989586621679586240"><span class="hs-identifier hs-var">eraStart</span></a><span class="hs-special">)</span><span>
</span><a name="line-271"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EAbsToRelSlot"><span class="hs-identifier hs-var">EAbsToRelSlot</span></a><span> </span><a name="local-6989586621679586265"><a href="#local-6989586621679586265"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-272"></a><span>        </span><a name="local-6989586621679586266"><a href="#local-6989586621679586266"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679586249"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586265"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-273"></a><span>        </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679586266"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-identifier">boundSlot</span><span> </span><a href="#local-6989586621679586240"><span class="hs-identifier hs-var">eraStart</span></a><span class="hs-special">)</span><span>
</span><a name="line-274"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-var">SlotInEra</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Util.html#countSlots"><span class="hs-identifier hs-var">countSlots</span></a><span> </span><a href="#local-6989586621679586266"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">boundSlot</span><span> </span><a href="#local-6989586621679586240"><span class="hs-identifier hs-var">eraStart</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-275"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EAbsToRelEpoch"><span class="hs-identifier hs-var">EAbsToRelEpoch</span></a><span> </span><a name="local-6989586621679586267"><a href="#local-6989586621679586267"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-276"></a><span>        </span><a name="local-6989586621679586268"><a href="#local-6989586621679586268"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679586249"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586267"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-277"></a><span>        </span><span class="hs-identifier hs-var">guard</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679586268"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-identifier">boundEpoch</span><span> </span><a href="#local-6989586621679586240"><span class="hs-identifier hs-var">eraStart</span></a><span class="hs-special">)</span><span>
</span><a name="line-278"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier hs-var">EpochInEra</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Util.html#countEpochs"><span class="hs-identifier hs-var">countEpochs</span></a><span> </span><a href="#local-6989586621679586268"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">boundEpoch</span><span> </span><a href="#local-6989586621679586240"><span class="hs-identifier hs-var">eraStart</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-279"></a><span>
</span><a name="line-280"></a><span>    </span><span class="hs-comment">-- Convert relative to absolute</span><span>
</span><a name="line-281"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-282"></a><span>    </span><span class="hs-comment">-- As justified by the proof above, the guards treat the upper bound</span><span>
</span><a name="line-283"></a><span>    </span><span class="hs-comment">-- as inclusive.</span><span>
</span><a name="line-284"></a><span>
</span><a name="line-285"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelToAbsTime"><span class="hs-identifier hs-var">ERelToAbsTime</span></a><span> </span><a name="local-6989586621679586269"><a href="#local-6989586621679586269"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-286"></a><span>        </span><a name="local-6989586621679586270"><a href="#local-6989586621679586270"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679586249"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586269"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-287"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679586271"><a href="#local-6989586621679586271"><span class="hs-identifier">absTime</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">getTimeInEra</span><span> </span><a href="#local-6989586621679586270"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-special">`</span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#addRelTime"><span class="hs-identifier hs-var">addRelTime</span></a><span class="hs-special">`</span><span> </span><span class="hs-identifier">boundTime</span><span> </span><a href="#local-6989586621679586240"><span class="hs-identifier hs-var">eraStart</span></a><span>
</span><a name="line-288"></a><span>        </span><a href="#local-6989586621679586248"><span class="hs-identifier hs-var">guardEnd</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679586272"><a href="#local-6989586621679586272"><span class="hs-identifier">end</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679586271"><span class="hs-identifier hs-var">absTime</span></a><span> </span><span class="hs-operator hs-var">&lt;=</span><span> </span><span class="hs-identifier">boundTime</span><span> </span><a href="#local-6989586621679586272"><span class="hs-identifier hs-var">end</span></a><span>
</span><a name="line-289"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679586271"><span class="hs-identifier hs-var">absTime</span></a><span>
</span><a name="line-290"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelToAbsSlot"><span class="hs-identifier hs-var">ERelToAbsSlot</span></a><span> </span><a name="local-6989586621679586273"><a href="#local-6989586621679586273"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-291"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679586274"><a href="#local-6989586621679586274"><span class="hs-identifier">s</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679586275"><a href="#local-6989586621679586275"><span class="hs-identifier">t</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679586249"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586273"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-292"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679586276"><a href="#local-6989586621679586276"><span class="hs-identifier">absSlot</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Util.html#addSlots"><span class="hs-identifier hs-var">addSlots</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">getSlotInEra</span><span> </span><a href="#local-6989586621679586274"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">boundSlot</span><span> </span><a href="#local-6989586621679586240"><span class="hs-identifier hs-var">eraStart</span></a><span class="hs-special">)</span><span>
</span><a name="line-293"></a><span>        </span><a href="#local-6989586621679586248"><span class="hs-identifier hs-var">guardEnd</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679586277"><a href="#local-6989586621679586277"><span class="hs-identifier">end</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679586276"><span class="hs-identifier hs-var">absSlot</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span>  </span><span class="hs-identifier">boundSlot</span><span> </span><a href="#local-6989586621679586277"><span class="hs-identifier hs-var">end</span></a><span>
</span><a name="line-294"></a><span>                        </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679586276"><span class="hs-identifier hs-var">absSlot</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">boundSlot</span><span> </span><a href="#local-6989586621679586277"><span class="hs-identifier hs-var">end</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier">getTimeInSlot</span><span> </span><a href="#local-6989586621679586275"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-295"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679586276"><span class="hs-identifier hs-var">absSlot</span></a><span>
</span><a name="line-296"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelToAbsEpoch"><span class="hs-identifier hs-var">ERelToAbsEpoch</span></a><span> </span><a name="local-6989586621679586278"><a href="#local-6989586621679586278"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-297"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679586279"><a href="#local-6989586621679586279"><span class="hs-identifier">e</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679586280"><a href="#local-6989586621679586280"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679586249"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586278"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-298"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679586281"><a href="#local-6989586621679586281"><span class="hs-identifier">absEpoch</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Util.html#addEpochs"><span class="hs-identifier hs-var">addEpochs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">getEpochInEra</span><span> </span><a href="#local-6989586621679586279"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">boundEpoch</span><span> </span><a href="#local-6989586621679586240"><span class="hs-identifier hs-var">eraStart</span></a><span class="hs-special">)</span><span>
</span><a name="line-299"></a><span>        </span><a href="#local-6989586621679586248"><span class="hs-identifier hs-var">guardEnd</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679586282"><a href="#local-6989586621679586282"><span class="hs-identifier">end</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679586281"><span class="hs-identifier hs-var">absEpoch</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span>  </span><span class="hs-identifier">boundEpoch</span><span> </span><a href="#local-6989586621679586282"><span class="hs-identifier hs-var">end</span></a><span>
</span><a name="line-300"></a><span>                        </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679586281"><span class="hs-identifier hs-var">absEpoch</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">boundEpoch</span><span> </span><a href="#local-6989586621679586282"><span class="hs-identifier hs-var">end</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier">getSlotInEpoch</span><span> </span><a href="#local-6989586621679586280"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-301"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679586281"><span class="hs-identifier hs-var">absEpoch</span></a><span>
</span><a name="line-302"></a><span>
</span><a name="line-303"></a><span>    </span><span class="hs-comment">-- Convert between relative values</span><span>
</span><a name="line-304"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-305"></a><span>    </span><span class="hs-comment">-- No guards necessary</span><span>
</span><a name="line-306"></a><span>
</span><a name="line-307"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelTimeToSlot"><span class="hs-identifier hs-var">ERelTimeToSlot</span></a><span> </span><a name="local-6989586621679586283"><a href="#local-6989586621679586283"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-308"></a><span>        </span><a name="local-6989586621679586284"><a href="#local-6989586621679586284"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679586249"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586283"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-309"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">bimap</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-var">SlotInEra</span></a><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier hs-var">TimeInSlot</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">getTimeInEra</span><span> </span><a href="#local-6989586621679586284"><span class="hs-identifier hs-var">t</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">divMod'</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679586246"><span class="hs-identifier hs-var">slotLen</span></a><span class="hs-special">)</span><span>
</span><a name="line-310"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelSlotToTime"><span class="hs-identifier hs-var">ERelSlotToTime</span></a><span> </span><a name="local-6989586621679586285"><a href="#local-6989586621679586285"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-311"></a><span>        </span><a name="local-6989586621679586286"><a href="#local-6989586621679586286"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679586249"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586285"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-312"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInEra"><span class="hs-identifier hs-var">TimeInEra</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">getSlotInEra</span><span> </span><a href="#local-6989586621679586286"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621679586246"><span class="hs-identifier hs-var">slotLen</span></a><span class="hs-special">)</span><span>
</span><a name="line-313"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelSlotToEpoch"><span class="hs-identifier hs-var">ERelSlotToEpoch</span></a><span> </span><a name="local-6989586621679586287"><a href="#local-6989586621679586287"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-314"></a><span>        </span><a name="local-6989586621679586288"><a href="#local-6989586621679586288"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679586249"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586287"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-315"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">bimap</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EpochInEra"><span class="hs-identifier hs-var">EpochInEra</span></a><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier hs-var">SlotInEpoch</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">getSlotInEra</span><span> </span><a href="#local-6989586621679586288"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">divMod</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679586247"><span class="hs-identifier hs-var">epochSize</span></a><span>
</span><a name="line-316"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelEpochToSlot"><span class="hs-identifier hs-var">ERelEpochToSlot</span></a><span> </span><a name="local-6989586621679586289"><a href="#local-6989586621679586289"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-317"></a><span>        </span><a name="local-6989586621679586290"><a href="#local-6989586621679586290"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679586249"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586289"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-318"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEra"><span class="hs-identifier hs-var">SlotInEra</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">getEpochInEra</span><span> </span><a href="#local-6989586621679586290"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621679586247"><span class="hs-identifier hs-var">epochSize</span></a><span class="hs-special">)</span><span>
</span><a name="line-319"></a><span>
</span><a name="line-320"></a><span>    </span><span class="hs-comment">-- Get era parameters</span><span>
</span><a name="line-321"></a><span>    </span><span class="hs-comment">--</span><span>
</span><a name="line-322"></a><span>    </span><span class="hs-comment">-- Here the upper bound must definitely be exclusive, or we'd return the</span><span>
</span><a name="line-323"></a><span>    </span><span class="hs-comment">-- era parameters from the wrong era.</span><span>
</span><a name="line-324"></a><span>
</span><a name="line-325"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ESlotLength"><span class="hs-identifier hs-var">ESlotLength</span></a><span> </span><a name="local-6989586621679586291"><a href="#local-6989586621679586291"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-326"></a><span>        </span><a name="local-6989586621679586292"><a href="#local-6989586621679586292"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679586249"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586291"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-327"></a><span>        </span><span class="hs-identifier hs-var">guard</span><span>    </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679586292"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-identifier">boundSlot</span><span> </span><a href="#local-6989586621679586240"><span class="hs-identifier hs-var">eraStart</span></a><span>
</span><a name="line-328"></a><span>        </span><a href="#local-6989586621679586248"><span class="hs-identifier hs-var">guardEnd</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679586293"><a href="#local-6989586621679586293"><span class="hs-identifier">end</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679586292"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-identifier">boundSlot</span><span> </span><a href="#local-6989586621679586293"><span class="hs-identifier hs-var">end</span></a><span>
</span><a name="line-329"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679586244"><span class="hs-identifier hs-var">eraSlotLength</span></a><span>
</span><a name="line-330"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EEpochSize"><span class="hs-identifier hs-var">EEpochSize</span></a><span> </span><a name="local-6989586621679586294"><a href="#local-6989586621679586294"><span class="hs-identifier">expr</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-331"></a><span>        </span><a name="local-6989586621679586295"><a href="#local-6989586621679586295"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679586249"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586294"><span class="hs-identifier hs-var">expr</span></a><span>
</span><a name="line-332"></a><span>        </span><span class="hs-identifier hs-var">guard</span><span>    </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679586295"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-identifier">boundEpoch</span><span> </span><a href="#local-6989586621679586240"><span class="hs-identifier hs-var">eraStart</span></a><span>
</span><a name="line-333"></a><span>        </span><a href="#local-6989586621679586248"><span class="hs-identifier hs-var">guardEnd</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679586296"><a href="#local-6989586621679586296"><span class="hs-identifier">end</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679586295"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-identifier">boundEpoch</span><span> </span><a href="#local-6989586621679586296"><span class="hs-identifier hs-var">end</span></a><span>
</span><a name="line-334"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679586243"><span class="hs-identifier hs-var">eraEpochSize</span></a><span>
</span><a name="line-335"></a><span>
</span><a name="line-336"></a><span class="hs-comment">{-------------------------------------------------------------------------------
  PastHorizonException
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-339"></a><span>
</span><a name="line-340"></a><span class="hs-comment">-- | We tried to convert something that is past the horizon</span><span>
</span><a name="line-341"></a><span class="hs-comment">--</span><span>
</span><a name="line-342"></a><span class="hs-comment">-- That is, we tried to convert something that is past the point in time</span><span>
</span><a name="line-343"></a><span class="hs-comment">-- beyond which we lack information due to uncertainty about the next</span><span>
</span><a name="line-344"></a><span class="hs-comment">-- hard fork.</span><span>
</span><a name="line-345"></a><span class="hs-keyword">data</span><span> </span><a name="PastHorizonException"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizonException"><span class="hs-identifier">PastHorizonException</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="PastHorizon"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizon"><span class="hs-identifier">PastHorizon</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-346"></a><span>      </span><span class="hs-comment">-- | Callstack to the call to 'runQuery'</span><span>
</span><a name="line-347"></a><span>      </span><a name="pastHorizonCallStack"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#pastHorizonCallStack"><span class="hs-identifier">pastHorizonCallStack</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">CallStack</span><span>
</span><a name="line-348"></a><span>
</span><a name="line-349"></a><span>      </span><span class="hs-comment">-- | The 'Expr' we tried to evaluate</span><span>
</span><a name="line-350"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pastHorizonExpression"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#pastHorizonExpression"><span class="hs-identifier">pastHorizonExpression</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Util.html#Some"><span class="hs-identifier hs-type">Some</span></a><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ClosedExpr"><span class="hs-identifier hs-type">ClosedExpr</span></a><span>
</span><a name="line-351"></a><span>
</span><a name="line-352"></a><span>      </span><span class="hs-comment">-- | The 'EraSummary's that we tried to evaluate the 'Expr' against</span><span>
</span><a name="line-353"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pastHorizonSummary"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#pastHorizonSummary"><span class="hs-identifier">pastHorizonSummary</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraSummary"><span class="hs-identifier hs-type">EraSummary</span></a><span class="hs-special">]</span><span>
</span><a name="line-354"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-355"></a><span>
</span><a name="line-356"></a><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizonException"><span class="hs-identifier hs-type">PastHorizonException</span></a><span>
</span><a name="line-357"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Exception</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizonException"><span class="hs-identifier hs-type">PastHorizonException</span></a><span>
</span><a name="line-358"></a><span>
</span><a name="line-359"></a><span class="hs-comment">{-------------------------------------------------------------------------------
  Running queries
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-362"></a><span>
</span><a name="line-363"></a><span class="hs-comment">-- | Run a query</span><span>
</span><a name="line-364"></a><span class="hs-comment">--</span><span>
</span><a name="line-365"></a><span class="hs-comment">-- Unlike an 'Expr', which is evaluated in a single era, a 'Qry' is evaluated</span><span>
</span><a name="line-366"></a><span class="hs-comment">-- against /all/ eras. Only if all 'Expr's embedded in the 'Qry' can be</span><span>
</span><a name="line-367"></a><span class="hs-comment">-- evaluated in the /same/ era (we don't want to mix properties of different</span><span>
</span><a name="line-368"></a><span class="hs-comment">-- eras in one query) do we return the result. If there is no era in which we</span><span>
</span><a name="line-369"></a><span class="hs-comment">-- can evaluate all 'Expr's in the 'Qry', we report a 'PastHorizonException'.</span><span>
</span><a name="line-370"></a><span class="hs-comment">--</span><span>
</span><a name="line-371"></a><span class="hs-comment">-- NOTE: this means that queries about separate eras have to be run separately,</span><span>
</span><a name="line-372"></a><span class="hs-comment">-- they should not be composed into a single query. How could we know to which</span><span>
</span><a name="line-373"></a><span class="hs-comment">-- era which relative slot/time refers?</span><span>
</span><a name="line-374"></a><span class="hs-identifier">runQuery</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-375"></a><span>     </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679586234"><a href="#local-6989586621679586234"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679586235"><a href="#local-6989586621679586235"><span class="hs-identifier">xs</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">HasCallStack</span><span>
</span><a name="line-376"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="#local-6989586621679586234"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Summary"><span class="hs-identifier hs-type">Summary</span></a><span> </span><a href="#local-6989586621679586235"><span class="hs-identifier hs-type">xs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizonException"><span class="hs-identifier hs-type">PastHorizonException</span></a><span> </span><a href="#local-6989586621679586234"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-377"></a><a name="runQuery"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQuery"><span class="hs-identifier">runQuery</span></a></a><span> </span><a name="local-6989586621679586298"><a href="#local-6989586621679586298"><span class="hs-identifier">qry</span></a></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Summary"><span class="hs-identifier hs-var">Summary</span></a><span> </span><a name="local-6989586621679586299"><a href="#local-6989586621679586299"><span class="hs-identifier">summary</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679586300"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586299"><span class="hs-identifier hs-var">summary</span></a><span>
</span><a name="line-378"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-379"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Util.Counting.html#NonEmpty"><span class="hs-identifier hs-type">NonEmpty</span></a><span> </span><a href="#local-6989586621679586302"><span class="hs-identifier hs-type">xs'</span></a><span> </span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraSummary"><span class="hs-identifier hs-type">EraSummary</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizonException"><span class="hs-identifier hs-type">PastHorizonException</span></a><span> </span><a href="#local-6989586621679586234"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-380"></a><span>    </span><a name="local-6989586621679586300"><a href="#local-6989586621679586300"><span class="hs-identifier">go</span></a></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Util.Counting.html#NonEmptyOne"><span class="hs-identifier hs-var">NonEmptyOne</span></a><span> </span><a name="local-6989586621679586304"><a href="#local-6989586621679586304"><span class="hs-identifier">era</span></a></a><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679586301"><span class="hs-identifier hs-var">tryEra</span></a><span> </span><a href="#local-6989586621679586304"><span class="hs-identifier hs-var">era</span></a><span> </span><a href="#local-6989586621679586298"><span class="hs-identifier hs-var">qry</span></a><span>
</span><a name="line-381"></a><span>    </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Util.Counting.html#NonEmptyCons"><span class="hs-identifier hs-var">NonEmptyCons</span></a><span> </span><a name="local-6989586621679586305"><a href="#local-6989586621679586305"><span class="hs-identifier">era</span></a></a><span> </span><a name="local-6989586621679586306"><a href="#local-6989586621679586306"><span class="hs-identifier">eras</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679586301"><span class="hs-identifier hs-var">tryEra</span></a><span> </span><a href="#local-6989586621679586305"><span class="hs-identifier hs-var">era</span></a><span> </span><a href="#local-6989586621679586298"><span class="hs-identifier hs-var">qry</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-382"></a><span>        </span><span class="hs-identifier hs-var">Left</span><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679586300"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586306"><span class="hs-identifier hs-var">eras</span></a><span>
</span><a name="line-383"></a><span>        </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679586307"><a href="#local-6989586621679586307"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679586307"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-384"></a><span>
</span><a name="line-385"></a><span>    </span><span class="hs-identifier">tryEra</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679586303"><a href="#local-6989586621679586303"><span class="hs-identifier">b</span></a></a><span class="hs-operator">.</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#EraSummary"><span class="hs-identifier hs-type">EraSummary</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="#local-6989586621679586303"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizonException"><span class="hs-identifier hs-type">PastHorizonException</span></a><span> </span><a href="#local-6989586621679586303"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-386"></a><span>    </span><a name="local-6989586621679586301"><a href="#local-6989586621679586301"><span class="hs-identifier">tryEra</span></a></a><span> </span><a name="local-6989586621679586308"><a href="#local-6989586621679586308"><span class="hs-identifier">era</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-387"></a><span>        </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QPure"><span class="hs-identifier hs-var">QPure</span></a><span> </span><a name="local-6989586621679586309"><a href="#local-6989586621679586309"><span class="hs-identifier">x</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679586309"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-388"></a><span>        </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#QExpr"><span class="hs-identifier hs-var">QExpr</span></a><span> </span><a name="local-6989586621679586310"><a href="#local-6989586621679586310"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621679586311"><a href="#local-6989586621679586311"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-389"></a><span>          </span><span class="hs-keyword">case</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#evalExprInEra"><span class="hs-identifier hs-var">evalExprInEra</span></a><span> </span><a href="#local-6989586621679586308"><span class="hs-identifier hs-var">era</span></a><span> </span><a href="#local-6989586621679586310"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-390"></a><span>            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679586312"><a href="#local-6989586621679586312"><span class="hs-identifier">x</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-391"></a><span>              </span><a href="#local-6989586621679586301"><span class="hs-identifier hs-var">tryEra</span></a><span> </span><a href="#local-6989586621679586308"><span class="hs-identifier hs-var">era</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679586311"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679586312"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-392"></a><span>            </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-393"></a><span>              </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizon"><span class="hs-identifier hs-var">PastHorizon</span></a><span> </span><span class="hs-identifier hs-var">callStack</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Util.html#Some"><span class="hs-identifier hs-var">Some</span></a><span> </span><a href="#local-6989586621679586310"><span class="hs-identifier hs-var">e</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toList</span><span> </span><a href="#local-6989586621679586299"><span class="hs-identifier hs-var">summary</span></a><span class="hs-special">)</span><span>
</span><a name="line-394"></a><span>
</span><a name="line-395"></a><span class="hs-identifier">runQueryThrow</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HasCallStack</span><span class="hs-special">,</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/src/Control.Monad.Class.MonadThrow.html#MonadThrow"><span class="hs-identifier hs-type">MonadThrow</span></a><span> </span><a href="#local-6989586621679586231"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">)</span><span class="hs-glyph">=&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="#local-6989586621679586232"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Summary"><span class="hs-identifier hs-type">Summary</span></a><span> </span><a href="#local-6989586621679586233"><span class="hs-identifier hs-type">xs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679586231"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679586232"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-396"></a><a name="runQueryThrow"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQueryThrow"><span class="hs-identifier">runQueryThrow</span></a></a><span> </span><a name="local-6989586621679586313"><a href="#local-6989586621679586313"><span class="hs-identifier">q</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">either</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/io-sim-classes-0.1.0.0/noopt/doc/html/io-sim-classes/src/Control.Monad.Class.MonadThrow.html#throwM"><span class="hs-identifier hs-var">throwM</span></a><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQuery"><span class="hs-identifier hs-var">runQuery</span></a><span> </span><a href="#local-6989586621679586313"><span class="hs-identifier hs-var">q</span></a><span>
</span><a name="line-397"></a><span>
</span><a name="line-398"></a><span class="hs-identifier">runQueryPure</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">HasCallStack</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="#local-6989586621679586229"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Summary"><span class="hs-identifier hs-type">Summary</span></a><span> </span><a href="#local-6989586621679586230"><span class="hs-identifier hs-type">xs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679586229"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-399"></a><a name="runQueryPure"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQueryPure"><span class="hs-identifier">runQueryPure</span></a></a><span> </span><a name="local-6989586621679586314"><a href="#local-6989586621679586314"><span class="hs-identifier">q</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">either</span><span> </span><span class="hs-identifier hs-var">throw</span><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQuery"><span class="hs-identifier hs-var">runQuery</span></a><span> </span><a href="#local-6989586621679586314"><span class="hs-identifier hs-var">q</span></a><span>
</span><a name="line-400"></a><span>
</span><a name="line-401"></a><span class="hs-comment">{-------------------------------------------------------------------------------
  Interpreter
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-404"></a><span>
</span><a name="line-405"></a><span class="hs-comment">-- | Can be sent across the LocalStateQuery protocol to interpret queries in</span><span>
</span><a name="line-406"></a><span class="hs-comment">-- the wallet.</span><span>
</span><a name="line-407"></a><span class="hs-comment">--</span><span>
</span><a name="line-408"></a><span class="hs-comment">-- The 'Summary' should be considered internal.</span><span>
</span><a name="line-409"></a><span class="hs-keyword">newtype</span><span> </span><a name="Interpreter"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Interpreter"><span class="hs-identifier">Interpreter</span></a></a><span> </span><a name="local-6989586621679586150"><a href="#local-6989586621679586150"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Interpreter"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Interpreter"><span class="hs-identifier">Interpreter</span></a></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Summary"><span class="hs-identifier hs-type">Summary</span></a><span> </span><a href="#local-6989586621679586150"><span class="hs-identifier hs-type">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-410"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">)</span><span>
</span><a name="line-411"></a><span>
</span><a name="line-412"></a><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">SListI</span><span> </span><a href="#local-6989586621679586343"><span class="hs-identifier hs-type">xs</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Serialise</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Interpreter"><span class="hs-identifier hs-type">Interpreter</span></a><span> </span><a href="#local-6989586621679586343"><span class="hs-identifier hs-type">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-413"></a><span>
</span><a name="line-414"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Interpreter"><span class="hs-identifier hs-type">Interpreter</span></a><span> </span><a href="#local-6989586621679586213"><span class="hs-identifier hs-type">xs</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-415"></a><span>  </span><a name="local-8214565720323790331"><span class="hs-identifier">show</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&lt;Interpreter&gt;&quot;</span><span>
</span><a name="line-416"></a><span>
</span><a name="line-417"></a><span class="hs-identifier">mkInterpreter</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Summary.html#Summary"><span class="hs-identifier hs-type">Summary</span></a><span> </span><a href="#local-6989586621679586228"><span class="hs-identifier hs-type">xs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Interpreter"><span class="hs-identifier hs-type">Interpreter</span></a><span> </span><a href="#local-6989586621679586228"><span class="hs-identifier hs-type">xs</span></a><span>
</span><a name="line-418"></a><a name="mkInterpreter"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#mkInterpreter"><span class="hs-identifier">mkInterpreter</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Interpreter"><span class="hs-identifier hs-var">Interpreter</span></a><span>
</span><a name="line-419"></a><span>
</span><a name="line-420"></a><span class="hs-identifier">interpretQuery</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-421"></a><span>     </span><span class="hs-identifier hs-type">HasCallStack</span><span>
</span><a name="line-422"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Interpreter"><span class="hs-identifier hs-type">Interpreter</span></a><span> </span><a href="#local-6989586621679586226"><span class="hs-identifier hs-type">xs</span></a><span>
</span><a name="line-423"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="#local-6989586621679586227"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-424"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#PastHorizonException"><span class="hs-identifier hs-type">PastHorizonException</span></a><span> </span><a href="#local-6989586621679586227"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-425"></a><a name="interpretQuery"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#interpretQuery"><span class="hs-identifier">interpretQuery</span></a></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Interpreter"><span class="hs-identifier hs-var">Interpreter</span></a><span> </span><a name="local-6989586621679586315"><a href="#local-6989586621679586315"><span class="hs-identifier">summary</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679586316"><a href="#local-6989586621679586316"><span class="hs-identifier">qry</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#runQuery"><span class="hs-identifier hs-var">runQuery</span></a><span> </span><a href="#local-6989586621679586316"><span class="hs-identifier hs-var">qry</span></a><span> </span><a href="#local-6989586621679586315"><span class="hs-identifier hs-var">summary</span></a><span>
</span><a name="line-426"></a><span>
</span><a name="line-427"></a><span class="hs-comment">{-------------------------------------------------------------------------------
  Specific queries

  The primed forms are the ones used in the 'EpochInfo' construction.
  Critically, they do not ask for any of the era parameters. This means that
  their valid range /includes/ the end bound.

  All of these queries are constructed so that they contain a single 'Expr'
  (which is therefore evaluated against a single era).
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-437"></a><span>
</span><a name="line-438"></a><span class="hs-comment">-- | Translate 'UTCTime' to 'SlotNo'</span><span>
</span><a name="line-439"></a><span class="hs-comment">--</span><span>
</span><a name="line-440"></a><span class="hs-comment">-- Additionally returns the time spent and time left in this slot.</span><span>
</span><a name="line-441"></a><span class="hs-identifier">wallclockToSlot</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#RelativeTime"><span class="hs-identifier hs-type">RelativeTime</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">NominalDiffTime</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">NominalDiffTime</span><span class="hs-special">)</span><span>
</span><a name="line-442"></a><a name="wallclockToSlot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#wallclockToSlot"><span class="hs-identifier">wallclockToSlot</span></a></a><span> </span><a name="local-6989586621679586317"><a href="#local-6989586621679586317"><span class="hs-identifier">absTime</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-443"></a><span>    </span><a href="#local-6989586621679586318"><span class="hs-identifier hs-var">aux</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#qryFromExpr"><span class="hs-identifier hs-var">qryFromExpr</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#wallclockToSlotExpr"><span class="hs-identifier hs-var">wallclockToSlotExpr</span></a><span> </span><a href="#local-6989586621679586317"><span class="hs-identifier hs-var">absTime</span></a><span class="hs-special">)</span><span>
</span><a name="line-444"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-445"></a><span>    </span><span class="hs-identifier">aux</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier hs-type">TimeInSlot</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#SlotLength"><span class="hs-identifier hs-type">SlotLength</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-446"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">NominalDiffTime</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">NominalDiffTime</span><span class="hs-special">)</span><span>
</span><a name="line-447"></a><span>    </span><a name="local-6989586621679586318"><a href="#local-6989586621679586318"><span class="hs-identifier">aux</span></a></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier hs-var">TimeInSlot</span></a><span> </span><a name="local-6989586621679586319"><a href="#local-6989586621679586319"><span class="hs-identifier">timeInSlot</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679586320"><a href="#local-6989586621679586320"><span class="hs-identifier">absSlot</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679586321"><a href="#local-6989586621679586321"><span class="hs-identifier">slotLen</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-448"></a><span>          </span><a href="#local-6989586621679586320"><span class="hs-identifier hs-var">absSlot</span></a><span>
</span><a name="line-449"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679586319"><span class="hs-identifier hs-var">timeInSlot</span></a><span>
</span><a name="line-450"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">getSlotLength</span><span> </span><a href="#local-6989586621679586321"><span class="hs-identifier hs-var">slotLen</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679586319"><span class="hs-identifier hs-var">timeInSlot</span></a><span>
</span><a name="line-451"></a><span>        </span><span class="hs-special">)</span><span>
</span><a name="line-452"></a><span>
</span><a name="line-453"></a><span class="hs-comment">-- | Translate 'SlotNo' to the 'UTCTime' at the start of that slot</span><span>
</span><a name="line-454"></a><span class="hs-comment">--</span><span>
</span><a name="line-455"></a><span class="hs-comment">-- Additionally returns the length of the slot.</span><span>
</span><a name="line-456"></a><span class="hs-identifier">slotToWallclock</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#RelativeTime"><span class="hs-identifier hs-type">RelativeTime</span></a><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#SlotLength"><span class="hs-identifier hs-type">SlotLength</span></a><span class="hs-special">)</span><span>
</span><a name="line-457"></a><a name="slotToWallclock"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToWallclock"><span class="hs-identifier">slotToWallclock</span></a></a><span> </span><a name="local-6989586621679586322"><a href="#local-6989586621679586322"><span class="hs-identifier">absSlot</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-458"></a><span>    </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#qryFromExpr"><span class="hs-identifier hs-var">qryFromExpr</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToWallclockExpr"><span class="hs-identifier hs-var">slotToWallclockExpr</span></a><span> </span><a href="#local-6989586621679586322"><span class="hs-identifier hs-var">absSlot</span></a><span class="hs-special">)</span><span>
</span><a name="line-459"></a><span>
</span><a name="line-460"></a><span class="hs-comment">-- | Convert 'SlotNo' to 'EpochNo' and the relative slot within the epoch</span><span>
</span><a name="line-461"></a><span class="hs-identifier">slotToEpoch'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Word64</span><span class="hs-special">)</span><span>
</span><a name="line-462"></a><a name="slotToEpoch%27"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpoch%27"><span class="hs-identifier">slotToEpoch'</span></a></a><span> </span><a name="local-6989586621679586323"><a href="#local-6989586621679586323"><span class="hs-identifier">absSlot</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-463"></a><span>    </span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-identifier">getSlotInEpoch</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#qryFromExpr"><span class="hs-identifier hs-var">qryFromExpr</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpochExpr%27"><span class="hs-identifier hs-var">slotToEpochExpr'</span></a><span> </span><a href="#local-6989586621679586323"><span class="hs-identifier hs-var">absSlot</span></a><span class="hs-special">)</span><span>
</span><a name="line-464"></a><span>
</span><a name="line-465"></a><span class="hs-comment">-- | Translate 'SlotNo' to its corresponding 'EpochNo'</span><span>
</span><a name="line-466"></a><span class="hs-comment">--</span><span>
</span><a name="line-467"></a><span class="hs-comment">-- Additionally returns the relative slot within this epoch and how many</span><span>
</span><a name="line-468"></a><span class="hs-comment">-- slots are left in this slot.</span><span>
</span><a name="line-469"></a><span class="hs-identifier">slotToEpoch</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Word64</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Word64</span><span class="hs-special">)</span><span>
</span><a name="line-470"></a><a name="slotToEpoch"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpoch"><span class="hs-identifier">slotToEpoch</span></a></a><span> </span><a name="local-6989586621679586324"><a href="#local-6989586621679586324"><span class="hs-identifier">absSlot</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-471"></a><span>    </span><a href="#local-6989586621679586325"><span class="hs-identifier hs-var">aux</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#qryFromExpr"><span class="hs-identifier hs-var">qryFromExpr</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpochExpr"><span class="hs-identifier hs-var">slotToEpochExpr</span></a><span> </span><a href="#local-6989586621679586324"><span class="hs-identifier hs-var">absSlot</span></a><span class="hs-special">)</span><span>
</span><a name="line-472"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-473"></a><span>    </span><span class="hs-identifier">aux</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier hs-type">SlotInEpoch</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochSize"><span class="hs-identifier hs-type">EpochSize</span></a><span class="hs-special">)</span><span>
</span><a name="line-474"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Word64</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Word64</span><span class="hs-special">)</span><span>
</span><a name="line-475"></a><span>    </span><a name="local-6989586621679586325"><a href="#local-6989586621679586325"><span class="hs-identifier">aux</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a name="local-6989586621679586326"><a href="#local-6989586621679586326"><span class="hs-identifier">absEpoch</span></a></a><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier hs-var">SlotInEpoch</span></a><span> </span><a name="local-6989586621679586327"><a href="#local-6989586621679586327"><span class="hs-identifier">slotInEpoch</span></a></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679586328"><a href="#local-6989586621679586328"><span class="hs-identifier">epochSize</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-476"></a><span>          </span><a href="#local-6989586621679586326"><span class="hs-identifier hs-var">absEpoch</span></a><span>
</span><a name="line-477"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679586327"><span class="hs-identifier hs-var">slotInEpoch</span></a><span>
</span><a name="line-478"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">unEpochSize</span><span> </span><a href="#local-6989586621679586328"><span class="hs-identifier hs-var">epochSize</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679586327"><span class="hs-identifier hs-var">slotInEpoch</span></a><span>
</span><a name="line-479"></a><span>        </span><span class="hs-special">)</span><span>
</span><a name="line-480"></a><span>
</span><a name="line-481"></a><span class="hs-identifier">epochToSlot'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a><span>
</span><a name="line-482"></a><a name="epochToSlot%27"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlot%27"><span class="hs-identifier">epochToSlot'</span></a></a><span> </span><a name="local-6989586621679586329"><a href="#local-6989586621679586329"><span class="hs-identifier">absEpoch</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-483"></a><span>    </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#qryFromExpr"><span class="hs-identifier hs-var">qryFromExpr</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlotExpr%27"><span class="hs-identifier hs-var">epochToSlotExpr'</span></a><span> </span><a href="#local-6989586621679586329"><span class="hs-identifier hs-var">absEpoch</span></a><span class="hs-special">)</span><span>
</span><a name="line-484"></a><span>
</span><a name="line-485"></a><span class="hs-comment">-- | Translate 'EpochNo' to the 'SlotNo' of the first slot in that epoch</span><span>
</span><a name="line-486"></a><span class="hs-comment">--</span><span>
</span><a name="line-487"></a><span class="hs-comment">-- Additionally returns the size of the epoch.</span><span>
</span><a name="line-488"></a><span class="hs-identifier">epochToSlot</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a><span class="hs-special">,</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochSize"><span class="hs-identifier hs-type">EpochSize</span></a><span class="hs-special">)</span><span>
</span><a name="line-489"></a><a name="epochToSlot"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlot"><span class="hs-identifier">epochToSlot</span></a></a><span> </span><a name="local-6989586621679586330"><a href="#local-6989586621679586330"><span class="hs-identifier">absEpoch</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-490"></a><span>    </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#qryFromExpr"><span class="hs-identifier hs-var">qryFromExpr</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlotExpr"><span class="hs-identifier hs-var">epochToSlotExpr</span></a><span> </span><a href="#local-6989586621679586330"><span class="hs-identifier hs-var">absEpoch</span></a><span class="hs-special">)</span><span>
</span><a name="line-491"></a><span>
</span><a name="line-492"></a><span class="hs-identifier">epochToSize</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Qry"><span class="hs-identifier hs-type">Qry</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochSize"><span class="hs-identifier hs-type">EpochSize</span></a><span>
</span><a name="line-493"></a><a name="epochToSize"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSize"><span class="hs-identifier">epochToSize</span></a></a><span> </span><a name="local-6989586621679586331"><a href="#local-6989586621679586331"><span class="hs-identifier">absEpoch</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-494"></a><span>    </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#qryFromExpr"><span class="hs-identifier hs-var">qryFromExpr</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSizeExpr"><span class="hs-identifier hs-var">epochToSizeExpr</span></a><span> </span><a href="#local-6989586621679586331"><span class="hs-identifier hs-var">absEpoch</span></a><span class="hs-special">)</span><span>
</span><a name="line-495"></a><span>
</span><a name="line-496"></a><span class="hs-comment">{-------------------------------------------------------------------------------
  Supporting expressions for the queries above
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-499"></a><span>
</span><a name="line-500"></a><span class="hs-identifier">wallclockToSlotExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#RelativeTime"><span class="hs-identifier hs-type">RelativeTime</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586225"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier hs-type">TimeInSlot</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#SlotLength"><span class="hs-identifier hs-type">SlotLength</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-501"></a><a name="wallclockToSlotExpr"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#wallclockToSlotExpr"><span class="hs-identifier">wallclockToSlotExpr</span></a></a><span> </span><a name="local-6989586621679586332"><a href="#local-6989586621679586332"><span class="hs-identifier">absTime</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-502"></a><span>    </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELet"><span class="hs-identifier hs-var">ELet</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelTimeToSlot"><span class="hs-identifier hs-var">ERelTimeToSlot</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EAbsToRelTime"><span class="hs-identifier hs-var">EAbsToRelTime</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELit"><span class="hs-identifier hs-var">ELit</span></a><span> </span><a href="#local-6989586621679586332"><span class="hs-identifier hs-var">absTime</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679586333"><a href="#local-6989586621679586333"><span class="hs-identifier">relSlot</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-503"></a><span>    </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELet"><span class="hs-identifier hs-var">ELet</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelToAbsSlot"><span class="hs-identifier hs-var">ERelToAbsSlot</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EVar"><span class="hs-identifier hs-var">EVar</span></a><span> </span><a href="#local-6989586621679586333"><span class="hs-identifier hs-var">relSlot</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679586334"><a href="#local-6989586621679586334"><span class="hs-identifier">absSlot</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-504"></a><span>    </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EPair"><span class="hs-identifier hs-var">EPair</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ESnd"><span class="hs-identifier hs-var">ESnd</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EVar"><span class="hs-identifier hs-var">EVar</span></a><span> </span><a href="#local-6989586621679586333"><span class="hs-identifier hs-var">relSlot</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-505"></a><span>          </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EPair"><span class="hs-identifier hs-var">EPair</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EVar"><span class="hs-identifier hs-var">EVar</span></a><span> </span><a href="#local-6989586621679586334"><span class="hs-identifier hs-var">absSlot</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ESlotLength"><span class="hs-identifier hs-var">ESlotLength</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EVar"><span class="hs-identifier hs-var">EVar</span></a><span> </span><a href="#local-6989586621679586334"><span class="hs-identifier hs-var">absSlot</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-506"></a><span>
</span><a name="line-507"></a><span class="hs-identifier">slotToWallclockExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586224"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#RelativeTime"><span class="hs-identifier hs-type">RelativeTime</span></a><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.BlockchainTime.WallClock.Types.html#SlotLength"><span class="hs-identifier hs-type">SlotLength</span></a><span class="hs-special">)</span><span>
</span><a name="line-508"></a><a name="slotToWallclockExpr"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToWallclockExpr"><span class="hs-identifier">slotToWallclockExpr</span></a></a><span> </span><a name="local-6989586621679586335"><a href="#local-6989586621679586335"><span class="hs-identifier">absSlot</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-509"></a><span>    </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EPair"><span class="hs-identifier hs-var">EPair</span></a><span>
</span><a name="line-510"></a><span>      </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelToAbsTime"><span class="hs-identifier hs-var">ERelToAbsTime</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelSlotToTime"><span class="hs-identifier hs-var">ERelSlotToTime</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EAbsToRelSlot"><span class="hs-identifier hs-var">EAbsToRelSlot</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELit"><span class="hs-identifier hs-var">ELit</span></a><span> </span><a href="#local-6989586621679586335"><span class="hs-identifier hs-var">absSlot</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-511"></a><span>      </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ESlotLength"><span class="hs-identifier hs-var">ESlotLength</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELit"><span class="hs-identifier hs-var">ELit</span></a><span> </span><a href="#local-6989586621679586335"><span class="hs-identifier hs-var">absSlot</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-512"></a><span>
</span><a name="line-513"></a><span class="hs-identifier">slotToEpochExpr'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586223"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier hs-type">SlotInEpoch</span></a><span class="hs-special">)</span><span>
</span><a name="line-514"></a><a name="slotToEpochExpr%27"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpochExpr%27"><span class="hs-identifier">slotToEpochExpr'</span></a></a><span> </span><a name="local-6989586621679586336"><a href="#local-6989586621679586336"><span class="hs-identifier">absSlot</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-515"></a><span>    </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELet"><span class="hs-identifier hs-var">ELet</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelSlotToEpoch"><span class="hs-identifier hs-var">ERelSlotToEpoch</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EAbsToRelSlot"><span class="hs-identifier hs-var">EAbsToRelSlot</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELit"><span class="hs-identifier hs-var">ELit</span></a><span> </span><a href="#local-6989586621679586336"><span class="hs-identifier hs-var">absSlot</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679586337"><a href="#local-6989586621679586337"><span class="hs-identifier">epochSlot</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-516"></a><span>    </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EPair"><span class="hs-identifier hs-var">EPair</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelToAbsEpoch"><span class="hs-identifier hs-var">ERelToAbsEpoch</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EVar"><span class="hs-identifier hs-var">EVar</span></a><span> </span><a href="#local-6989586621679586337"><span class="hs-identifier hs-var">epochSlot</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ESnd"><span class="hs-identifier hs-var">ESnd</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EVar"><span class="hs-identifier hs-var">EVar</span></a><span> </span><a href="#local-6989586621679586337"><span class="hs-identifier hs-var">epochSlot</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-517"></a><span>
</span><a name="line-518"></a><span class="hs-identifier">slotToEpochExpr</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-519"></a><span>     </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a><span>
</span><a name="line-520"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586222"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#SlotInEpoch"><span class="hs-identifier hs-type">SlotInEpoch</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochSize"><span class="hs-identifier hs-type">EpochSize</span></a><span class="hs-special">)</span><span>
</span><a name="line-521"></a><a name="slotToEpochExpr"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpochExpr"><span class="hs-identifier">slotToEpochExpr</span></a></a><span> </span><a name="local-6989586621679586338"><a href="#local-6989586621679586338"><span class="hs-identifier">absSlot</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-522"></a><span>    </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELet"><span class="hs-identifier hs-var">ELet</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#slotToEpochExpr%27"><span class="hs-identifier hs-var">slotToEpochExpr'</span></a><span> </span><a href="#local-6989586621679586338"><span class="hs-identifier hs-var">absSlot</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679586339"><a href="#local-6989586621679586339"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-523"></a><span>    </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EPair"><span class="hs-identifier hs-var">EPair</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EVar"><span class="hs-identifier hs-var">EVar</span></a><span> </span><a href="#local-6989586621679586339"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EEpochSize"><span class="hs-identifier hs-var">EEpochSize</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EFst"><span class="hs-identifier hs-var">EFst</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EVar"><span class="hs-identifier hs-var">EVar</span></a><span> </span><a href="#local-6989586621679586339"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-524"></a><span>
</span><a name="line-525"></a><span class="hs-identifier">epochToSlotExpr'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586221"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a><span>
</span><a name="line-526"></a><a name="epochToSlotExpr%27"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlotExpr%27"><span class="hs-identifier">epochToSlotExpr'</span></a></a><span> </span><a name="local-6989586621679586340"><a href="#local-6989586621679586340"><span class="hs-identifier">absEpoch</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-527"></a><span>    </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelToAbsSlot"><span class="hs-identifier hs-var">ERelToAbsSlot</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EPair"><span class="hs-identifier hs-var">EPair</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelEpochToSlot"><span class="hs-identifier hs-var">ERelEpochToSlot</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EAbsToRelEpoch"><span class="hs-identifier hs-var">EAbsToRelEpoch</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELit"><span class="hs-identifier hs-var">ELit</span></a><span> </span><a href="#local-6989586621679586340"><span class="hs-identifier hs-var">absEpoch</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-528"></a><span>                         </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELit"><span class="hs-identifier hs-var">ELit</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#TimeInSlot"><span class="hs-identifier hs-var">TimeInSlot</span></a><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-529"></a><span>
</span><a name="line-530"></a><span class="hs-identifier">epochToSlotExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586220"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#SlotNo"><span class="hs-identifier hs-type">SlotNo</span></a><span class="hs-special">,</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochSize"><span class="hs-identifier hs-type">EpochSize</span></a><span class="hs-special">)</span><span>
</span><a name="line-531"></a><a name="epochToSlotExpr"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlotExpr"><span class="hs-identifier">epochToSlotExpr</span></a></a><span> </span><a name="local-6989586621679586341"><a href="#local-6989586621679586341"><span class="hs-identifier">absEpoch</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-532"></a><span>    </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EPair"><span class="hs-identifier hs-var">EPair</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSlotExpr%27"><span class="hs-identifier hs-var">epochToSlotExpr'</span></a><span> </span><a href="#local-6989586621679586341"><span class="hs-identifier hs-var">absEpoch</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSizeExpr"><span class="hs-identifier hs-var">epochToSizeExpr</span></a><span> </span><a href="#local-6989586621679586341"><span class="hs-identifier hs-var">absEpoch</span></a><span class="hs-special">)</span><span>
</span><a name="line-533"></a><span>
</span><a name="line-534"></a><span class="hs-identifier">epochToSizeExpr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="#local-6989586621679586219"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochSize"><span class="hs-identifier hs-type">EpochSize</span></a><span>
</span><a name="line-535"></a><a name="epochToSizeExpr"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#epochToSizeExpr"><span class="hs-identifier">epochToSizeExpr</span></a></a><span> </span><a name="local-6989586621679586342"><a href="#local-6989586621679586342"><span class="hs-identifier">absEpoch</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-536"></a><span>    </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EEpochSize"><span class="hs-identifier hs-var">EEpochSize</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELit"><span class="hs-identifier hs-var">ELit</span></a><span> </span><a href="#local-6989586621679586342"><span class="hs-identifier hs-var">absEpoch</span></a><span class="hs-special">)</span><span>
</span><a name="line-537"></a><span>
</span><a name="line-538"></a><span class="hs-comment">{-------------------------------------------------------------------------------
  'Show' instances
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-541"></a><span>
</span><a name="line-542"></a><span class="hs-keyword">newtype</span><span> </span><a name="Var"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Var"><span class="hs-identifier">Var</span></a></a><span> </span><a name="local-6989586621679586149"><a href="#local-6989586621679586149"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Var"><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Var"><span class="hs-identifier">Var</span></a></a><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-543"></a><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-544"></a><span>
</span><a name="line-545"></a><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Util.html#Some"><span class="hs-identifier hs-type">Some</span></a><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ClosedExpr"><span class="hs-identifier hs-type">ClosedExpr</span></a><span class="hs-special">)</span><span>
</span><a name="line-546"></a><span>
</span><a name="line-547"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ClosedExpr"><span class="hs-identifier hs-type">ClosedExpr</span></a><span> </span><a href="#local-6989586621679586185"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-548"></a><span>  </span><a name="local-8214565720323790332"><span class="hs-identifier">showsPrec</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679586211"><a href="#local-6989586621679586211"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ClosedExpr"><span class="hs-identifier hs-var">ClosedExpr</span></a><span> </span><a name="local-6989586621679586212"><a href="#local-6989586621679586212"><span class="hs-identifier">e</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679586186"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679586211"><span class="hs-identifier hs-var">d</span></a><span> </span><a href="#local-6989586621679586212"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-549"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-550"></a><span>      </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>  </span><span class="hs-comment">-- How many variables are already in scope?</span><span>
</span><a name="line-551"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>  </span><span class="hs-comment">-- Precedence</span><span>
</span><a name="line-552"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Expr"><span class="hs-identifier hs-type">Expr</span></a><span> </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Var"><span class="hs-identifier hs-type">Var</span></a><span> </span><a href="#local-6989586621679586187"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">ShowS</span><span>
</span><a name="line-553"></a><span>      </span><a name="local-6989586621679586186"><a href="#local-6989586621679586186"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679586188"><a href="#local-6989586621679586188"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679586189"><a href="#local-6989586621679586189"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">showParen</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679586189"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><span class="hs-number">11</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-554"></a><span>
</span><a name="line-555"></a><span>          </span><span class="hs-comment">-- Variables and let-binding</span><span>
</span><a name="line-556"></a><span>          </span><span class="hs-comment">--</span><span>
</span><a name="line-557"></a><span>          </span><span class="hs-comment">-- We recover Haskell syntax here, e.g.</span><span>
</span><a name="line-558"></a><span>          </span><span class="hs-comment">--</span><span>
</span><a name="line-559"></a><span>          </span><span class="hs-comment">-- &gt; ELet .. (\x -&gt; .... x ....)</span><span>
</span><a name="line-560"></a><span>
</span><a name="line-561"></a><span>          </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EVar"><span class="hs-identifier hs-var">EVar</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a name="local-6989586621679586190"><a href="#local-6989586621679586190"><span class="hs-identifier">x</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">showString</span><span> </span><span class="hs-string">&quot;EVar &quot;</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">showString</span><span> </span><a href="#local-6989586621679586190"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-562"></a><span>          </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELet"><span class="hs-identifier hs-var">ELet</span></a><span> </span><a name="local-6989586621679586191"><a href="#local-6989586621679586191"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621679586192"><a href="#local-6989586621679586192"><span class="hs-identifier">f</span></a></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679586193"><a href="#local-6989586621679586193"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;x&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679586188"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-563"></a><span>                          </span><span class="hs-identifier hs-var">showString</span><span> </span><span class="hs-string">&quot;ELet &quot;</span><span>
</span><a name="line-564"></a><span>                        </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679586186"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586188"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-number">11</span><span> </span><a href="#local-6989586621679586191"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-565"></a><span>                        </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">showString</span><span> </span><span class="hs-string">&quot; (\\&quot;</span><span>
</span><a name="line-566"></a><span>                        </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">showString</span><span> </span><a href="#local-6989586621679586193"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-567"></a><span>                        </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">showString</span><span> </span><span class="hs-string">&quot; -&gt; &quot;</span><span>
</span><a name="line-568"></a><span>                        </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679586186"><span class="hs-identifier hs-var">go</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679586188"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679586192"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a href="#local-6989586621679586193"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-569"></a><span>                        </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">showString</span><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-570"></a><span>
</span><a name="line-571"></a><span>          </span><span class="hs-comment">-- Literals</span><span>
</span><a name="line-572"></a><span>
</span><a name="line-573"></a><span>          </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ELit"><span class="hs-identifier hs-var">ELit</span></a><span> </span><a name="local-6989586621679586194"><a href="#local-6989586621679586194"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">showString</span><span> </span><span class="hs-string">&quot;ELit &quot;</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">showsPrec</span><span> </span><span class="hs-number">11</span><span> </span><a href="#local-6989586621679586194"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-574"></a><span>
</span><a name="line-575"></a><span>          </span><span class="hs-comment">-- Pairs</span><span>
</span><a name="line-576"></a><span>
</span><a name="line-577"></a><span>          </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EPair"><span class="hs-identifier hs-var">EPair</span></a><span> </span><a name="local-6989586621679586195"><a href="#local-6989586621679586195"><span class="hs-identifier">e</span></a></a><span> </span><a name="local-6989586621679586196"><a href="#local-6989586621679586196"><span class="hs-identifier">e'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">showString</span><span> </span><span class="hs-string">&quot;EPair &quot;</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679586186"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586188"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-number">11</span><span> </span><a href="#local-6989586621679586195"><span class="hs-identifier hs-var">e</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">showSpace</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679586186"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586188"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-number">11</span><span> </span><a href="#local-6989586621679586196"><span class="hs-identifier hs-var">e'</span></a><span>
</span><a name="line-578"></a><span>          </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EFst"><span class="hs-identifier hs-var">EFst</span></a><span>  </span><a name="local-6989586621679586197"><a href="#local-6989586621679586197"><span class="hs-identifier">e</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">showString</span><span> </span><span class="hs-string">&quot;EFst &quot;</span><span>  </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679586186"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586188"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-number">11</span><span> </span><a href="#local-6989586621679586197"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-579"></a><span>          </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ESnd"><span class="hs-identifier hs-var">ESnd</span></a><span>  </span><a name="local-6989586621679586198"><a href="#local-6989586621679586198"><span class="hs-identifier">e</span></a></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">showString</span><span> </span><span class="hs-string">&quot;ESnd &quot;</span><span>  </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679586186"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586188"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-number">11</span><span> </span><a href="#local-6989586621679586198"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-580"></a><span>
</span><a name="line-581"></a><span>          </span><span class="hs-comment">-- Domain specific</span><span>
</span><a name="line-582"></a><span>
</span><a name="line-583"></a><span>          </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EAbsToRelTime"><span class="hs-identifier hs-var">EAbsToRelTime</span></a><span>   </span><a name="local-6989586621679586199"><a href="#local-6989586621679586199"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">showString</span><span> </span><span class="hs-string">&quot;EAbsToRelTime &quot;</span><span>   </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679586186"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586188"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-number">11</span><span> </span><a href="#local-6989586621679586199"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-584"></a><span>          </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EAbsToRelSlot"><span class="hs-identifier hs-var">EAbsToRelSlot</span></a><span>   </span><a name="local-6989586621679586200"><a href="#local-6989586621679586200"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">showString</span><span> </span><span class="hs-string">&quot;EAbsToRelSlot &quot;</span><span>   </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679586186"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586188"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-number">11</span><span> </span><a href="#local-6989586621679586200"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-585"></a><span>          </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EAbsToRelEpoch"><span class="hs-identifier hs-var">EAbsToRelEpoch</span></a><span>  </span><a name="local-6989586621679586201"><a href="#local-6989586621679586201"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">showString</span><span> </span><span class="hs-string">&quot;EAbsToRelEpoch &quot;</span><span>  </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679586186"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586188"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-number">11</span><span> </span><a href="#local-6989586621679586201"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-586"></a><span>          </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelToAbsTime"><span class="hs-identifier hs-var">ERelToAbsTime</span></a><span>   </span><a name="local-6989586621679586202"><a href="#local-6989586621679586202"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">showString</span><span> </span><span class="hs-string">&quot;ERelToAbsTime &quot;</span><span>   </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679586186"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586188"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-number">11</span><span> </span><a href="#local-6989586621679586202"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-587"></a><span>          </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelToAbsSlot"><span class="hs-identifier hs-var">ERelToAbsSlot</span></a><span>   </span><a name="local-6989586621679586203"><a href="#local-6989586621679586203"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">showString</span><span> </span><span class="hs-string">&quot;ERelToAbsSlot &quot;</span><span>   </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679586186"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586188"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-number">11</span><span> </span><a href="#local-6989586621679586203"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-588"></a><span>          </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelToAbsEpoch"><span class="hs-identifier hs-var">ERelToAbsEpoch</span></a><span>  </span><a name="local-6989586621679586204"><a href="#local-6989586621679586204"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">showString</span><span> </span><span class="hs-string">&quot;ERelToAbsEpoch &quot;</span><span>  </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679586186"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586188"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-number">11</span><span> </span><a href="#local-6989586621679586204"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-589"></a><span>          </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelTimeToSlot"><span class="hs-identifier hs-var">ERelTimeToSlot</span></a><span>  </span><a name="local-6989586621679586205"><a href="#local-6989586621679586205"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">showString</span><span> </span><span class="hs-string">&quot;ERelTimeToSlot &quot;</span><span>  </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679586186"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586188"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-number">11</span><span> </span><a href="#local-6989586621679586205"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-590"></a><span>          </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelSlotToTime"><span class="hs-identifier hs-var">ERelSlotToTime</span></a><span>  </span><a name="local-6989586621679586206"><a href="#local-6989586621679586206"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">showString</span><span> </span><span class="hs-string">&quot;ERelSlotToTime &quot;</span><span>  </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679586186"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586188"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-number">11</span><span> </span><a href="#local-6989586621679586206"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-591"></a><span>          </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelSlotToEpoch"><span class="hs-identifier hs-var">ERelSlotToEpoch</span></a><span> </span><a name="local-6989586621679586207"><a href="#local-6989586621679586207"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">showString</span><span> </span><span class="hs-string">&quot;ERelSlotToEpoch &quot;</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679586186"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586188"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-number">11</span><span> </span><a href="#local-6989586621679586207"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-592"></a><span>          </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ERelEpochToSlot"><span class="hs-identifier hs-var">ERelEpochToSlot</span></a><span> </span><a name="local-6989586621679586208"><a href="#local-6989586621679586208"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">showString</span><span> </span><span class="hs-string">&quot;ERelEpochToSlot &quot;</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679586186"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586188"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-number">11</span><span> </span><a href="#local-6989586621679586208"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-593"></a><span>          </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#ESlotLength"><span class="hs-identifier hs-var">ESlotLength</span></a><span>     </span><a name="local-6989586621679586209"><a href="#local-6989586621679586209"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">showString</span><span> </span><span class="hs-string">&quot;ESlotLength &quot;</span><span>     </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679586186"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586188"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-number">11</span><span> </span><a href="#local-6989586621679586209"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-594"></a><span>          </span><a href="Ouroboros.Consensus.HardFork.History.Qry.html#EEpochSize"><span class="hs-identifier hs-var">EEpochSize</span></a><span>      </span><a name="local-6989586621679586210"><a href="#local-6989586621679586210"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">showString</span><span> </span><span class="hs-string">&quot;EEpochSize &quot;</span><span>      </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679586186"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679586188"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-number">11</span><span> </span><a href="#local-6989586621679586210"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-595"></a></pre></body></html>