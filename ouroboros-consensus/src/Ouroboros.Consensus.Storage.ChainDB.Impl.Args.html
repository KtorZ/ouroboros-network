<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ExistentialQuantification #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE RankNTypes                #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE RecordWildCards           #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables       #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE TypeApplications          #-}</span><span>
</span><a name="line-6"></a><span>
</span><a name="line-7"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ouroboros.Consensus.Storage.ChainDB.Impl.Args</span><span>
</span><a name="line-8"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbArgs"><span class="hs-identifier hs-type">ChainDbArgs</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-9"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbSpecificArgs"><span class="hs-identifier hs-type">ChainDbSpecificArgs</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-10"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#defaultArgs"><span class="hs-identifier hs-var">defaultArgs</span></a><span>
</span><a name="line-11"></a><span>    </span><span class="hs-comment">-- * Internal</span><span>
</span><a name="line-12"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#fromChainDbArgs"><span class="hs-identifier hs-var">fromChainDbArgs</span></a><span>
</span><a name="line-13"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Proxy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Time.Clock</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">DiffTime</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">secondsToDiffTime</span><span class="hs-special">)</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span>           </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/contra-tracer-0.1.0.0/noopt/doc/html/contra-tracer/src/Control.Tracer.html"><span class="hs-identifier">Control.Tracer</span></a><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/contra-tracer-0.1.0.0/noopt/doc/html/contra-tracer/src/Control.Tracer.html#Tracer"><span class="hs-identifier hs-type">Tracer</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">contramap</span><span class="hs-special">,</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/contra-tracer-0.1.0.0/noopt/doc/html/contra-tracer/src/Control.Tracer.html#nullTracer"><span class="hs-identifier hs-var">nullTracer</span></a><span class="hs-special">)</span><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.Block.html"><span class="hs-identifier">Ouroboros.Consensus.Block</span></a><span>
</span><a name="line-21"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.Config.html"><span class="hs-identifier">Ouroboros.Consensus.Config</span></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.Fragment.InFuture.html"><span class="hs-identifier">Ouroboros.Consensus.Fragment.InFuture</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Fragment.InFuture.html#CheckInFuture"><span class="hs-identifier hs-type">CheckInFuture</span></a><span class="hs-special">)</span><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.Ledger.Extended.html"><span class="hs-identifier">Ouroboros.Consensus.Ledger.Extended</span></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.Util.Args.html"><span class="hs-identifier">Ouroboros.Consensus.Util.Args</span></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.Util.ResourceRegistry.html"><span class="hs-identifier">Ouroboros.Consensus.Util.ResourceRegistry</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Util.ResourceRegistry.html#ResourceRegistry"><span class="hs-identifier hs-type">ResourceRegistry</span></a><span class="hs-special">)</span><span>
</span><a name="line-26"></a><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.Storage.FS.API.html"><span class="hs-identifier">Ouroboros.Consensus.Storage.FS.API</span></a><span>
</span><a name="line-28"></a><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.LgrDB.html"><span class="hs-identifier">Ouroboros.Consensus.Storage.ChainDB.Impl.LgrDB</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LgrDB</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Types.html"><span class="hs-identifier">Ouroboros.Consensus.Storage.ChainDB.Impl.Types</span></a><span>
</span><a name="line-31"></a><span>                     </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Types.html#TraceEvent"><span class="hs-identifier hs-type">TraceEvent</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.Storage.ImmutableDB.html"><span class="hs-identifier">Ouroboros.Consensus.Storage.ImmutableDB</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Storage.ImmutableDB.Chunks.Internal.html#ChunkInfo"><span class="hs-identifier hs-type">ChunkInfo</span></a><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Ouroboros.Consensus.Storage.ImmutableDB.html"><span class="hs-identifier">Ouroboros.Consensus.Storage.ImmutableDB</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">ImmutableDB</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Ouroboros.Consensus.Storage.VolatileDB.html"><span class="hs-identifier">Ouroboros.Consensus.Storage.VolatileDB</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">VolatileDB</span><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span class="hs-comment">{-------------------------------------------------------------------------------
  Arguments
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-39"></a><span>
</span><a name="line-40"></a><span class="hs-keyword">data</span><span> </span><a name="ChainDbArgs"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbArgs"><span class="hs-identifier">ChainDbArgs</span></a></a><span> </span><a name="local-6989586621680088017"><a href="#local-6989586621680088017"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621680088018"><a href="#local-6989586621680088018"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621680088019"><a href="#local-6989586621680088019"><span class="hs-identifier">blk</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ChainDbArgs"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbArgs"><span class="hs-identifier">ChainDbArgs</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span>      </span><span class="hs-comment">-- HasFS instances</span><span>
</span><a name="line-43"></a><span>      </span><a name="cdbHasFSImmutableDB"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbHasFSImmutableDB"><span class="hs-identifier">cdbHasFSImmutableDB</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Storage.FS.API.html#SomeHasFS"><span class="hs-identifier hs-type">SomeHasFS</span></a><span> </span><a href="#local-6989586621680088018"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-44"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbHasFSVolatileDB"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbHasFSVolatileDB"><span class="hs-identifier">cdbHasFSVolatileDB</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Storage.FS.API.html#SomeHasFS"><span class="hs-identifier hs-type">SomeHasFS</span></a><span> </span><a href="#local-6989586621680088018"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-45"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbHasFSLgrDB"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbHasFSLgrDB"><span class="hs-identifier">cdbHasFSLgrDB</span></a></a><span>             </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Storage.FS.API.html#SomeHasFS"><span class="hs-identifier hs-type">SomeHasFS</span></a><span> </span><a href="#local-6989586621680088018"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span>      </span><span class="hs-comment">-- Policy</span><span>
</span><a name="line-48"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbImmutableDbValidation"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbImmutableDbValidation"><span class="hs-identifier">cdbImmutableDbValidation</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Storage.ImmutableDB.Impl.Types.html#ValidationPolicy"><span class="hs-identifier hs-type">ImmutableDB.ValidationPolicy</span></a><span>
</span><a name="line-49"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbVolatileDbValidation"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbVolatileDbValidation"><span class="hs-identifier">cdbVolatileDbValidation</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Storage.VolatileDB.Impl.Types.html#BlockValidationPolicy"><span class="hs-identifier hs-type">VolatileDB.BlockValidationPolicy</span></a><span>
</span><a name="line-50"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbMaxBlocksPerFile"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbMaxBlocksPerFile"><span class="hs-identifier">cdbMaxBlocksPerFile</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Storage.VolatileDB.Impl.Types.html#BlocksPerFile"><span class="hs-identifier hs-type">VolatileDB.BlocksPerFile</span></a><span>
</span><a name="line-51"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbParamsLgrDB"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbParamsLgrDB"><span class="hs-identifier">cdbParamsLgrDB</span></a></a><span>            </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Util.Args.html#HKD"><span class="hs-identifier hs-type">HKD</span></a><span> </span><a href="#local-6989586621680088017"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#LedgerDbParams"><span class="hs-identifier hs-type">LgrDB.LedgerDbParams</span></a><span>
</span><a name="line-52"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbDiskPolicy"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbDiskPolicy"><span class="hs-identifier">cdbDiskPolicy</span></a></a><span>             </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Util.Args.html#HKD"><span class="hs-identifier hs-type">HKD</span></a><span> </span><a href="#local-6989586621680088017"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="Ouroboros.Consensus.Storage.LedgerDB.DiskPolicy.html#DiskPolicy"><span class="hs-identifier hs-type">LgrDB.DiskPolicy</span></a><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span>      </span><span class="hs-comment">-- Integration</span><span>
</span><a name="line-55"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbTopLevelConfig"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbTopLevelConfig"><span class="hs-identifier">cdbTopLevelConfig</span></a></a><span>         </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Util.Args.html#HKD"><span class="hs-identifier hs-type">HKD</span></a><span> </span><a href="#local-6989586621680088017"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Config.html#TopLevelConfig"><span class="hs-identifier hs-type">TopLevelConfig</span></a><span> </span><a href="#local-6989586621680088019"><span class="hs-identifier hs-type">blk</span></a><span class="hs-special">)</span><span>
</span><a name="line-56"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbChunkInfo"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbChunkInfo"><span class="hs-identifier">cdbChunkInfo</span></a></a><span>              </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Util.Args.html#HKD"><span class="hs-identifier hs-type">HKD</span></a><span> </span><a href="#local-6989586621680088017"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="Ouroboros.Consensus.Storage.ImmutableDB.Chunks.Internal.html#ChunkInfo"><span class="hs-identifier hs-type">ChunkInfo</span></a><span>
</span><a name="line-57"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbCheckIntegrity"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbCheckIntegrity"><span class="hs-identifier">cdbCheckIntegrity</span></a></a><span>         </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Util.Args.html#HKD"><span class="hs-identifier hs-type">HKD</span></a><span> </span><a href="#local-6989586621680088017"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680088019"><span class="hs-identifier hs-type">blk</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbGenesis"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbGenesis"><span class="hs-identifier">cdbGenesis</span></a></a><span>                </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Util.Args.html#HKD"><span class="hs-identifier hs-type">HKD</span></a><span> </span><a href="#local-6989586621680088017"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621680088018"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Ledger.Extended.html#ExtLedgerState"><span class="hs-identifier hs-type">ExtLedgerState</span></a><span> </span><a href="#local-6989586621680088019"><span class="hs-identifier hs-type">blk</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbCheckInFuture"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbCheckInFuture"><span class="hs-identifier">cdbCheckInFuture</span></a></a><span>          </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Util.Args.html#HKD"><span class="hs-identifier hs-type">HKD</span></a><span> </span><a href="#local-6989586621680088017"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Fragment.InFuture.html#CheckInFuture"><span class="hs-identifier hs-type">CheckInFuture</span></a><span> </span><a href="#local-6989586621680088018"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621680088019"><span class="hs-identifier hs-type">blk</span></a><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbImmutableDbCacheConfig"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbImmutableDbCacheConfig"><span class="hs-identifier">cdbImmutableDbCacheConfig</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Storage.ImmutableDB.Impl.Index.Cache.html#CacheConfig"><span class="hs-identifier hs-type">ImmutableDB.CacheConfig</span></a><span>
</span><a name="line-61"></a><span>
</span><a name="line-62"></a><span>      </span><span class="hs-comment">-- Misc</span><span>
</span><a name="line-63"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbTracer"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbTracer"><span class="hs-identifier">cdbTracer</span></a></a><span>                 </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/contra-tracer-0.1.0.0/noopt/doc/html/contra-tracer/src/Control.Tracer.html#Tracer"><span class="hs-identifier hs-type">Tracer</span></a><span> </span><a href="#local-6989586621680088018"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Types.html#TraceEvent"><span class="hs-identifier hs-type">TraceEvent</span></a><span> </span><a href="#local-6989586621680088019"><span class="hs-identifier hs-type">blk</span></a><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbTraceLedger"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbTraceLedger"><span class="hs-identifier">cdbTraceLedger</span></a></a><span>            </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/contra-tracer-0.1.0.0/noopt/doc/html/contra-tracer/src/Control.Tracer.html#Tracer"><span class="hs-identifier hs-type">Tracer</span></a><span> </span><a href="#local-6989586621680088018"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.LgrDB.html#LedgerDB"><span class="hs-identifier hs-type">LgrDB.LedgerDB</span></a><span> </span><a href="#local-6989586621680088019"><span class="hs-identifier hs-type">blk</span></a><span class="hs-special">)</span><span>
</span><a name="line-65"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbRegistry"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbRegistry"><span class="hs-identifier">cdbRegistry</span></a></a><span>               </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Util.Args.html#HKD"><span class="hs-identifier hs-type">HKD</span></a><span> </span><a href="#local-6989586621680088017"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Util.ResourceRegistry.html#ResourceRegistry"><span class="hs-identifier hs-type">ResourceRegistry</span></a><span> </span><a href="#local-6989586621680088018"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-66"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbGcDelay"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbGcDelay"><span class="hs-identifier">cdbGcDelay</span></a></a><span>                </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DiffTime</span><span>
</span><a name="line-67"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbGcInterval"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbGcInterval"><span class="hs-identifier">cdbGcInterval</span></a></a><span>             </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DiffTime</span><span>
</span><a name="line-68"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbBlocksToAddSize"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbBlocksToAddSize"><span class="hs-identifier">cdbBlocksToAddSize</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word</span><span>
</span><a name="line-69"></a><span>      </span><span class="hs-comment">-- ^ Size of the queue used to store asynchronously added blocks. This</span><span>
</span><a name="line-70"></a><span>      </span><span class="hs-comment">-- is the maximum number of blocks that could be kept in memory at the</span><span>
</span><a name="line-71"></a><span>      </span><span class="hs-comment">-- same time when the background thread processing the blocks can't keep</span><span>
</span><a name="line-72"></a><span>      </span><span class="hs-comment">-- up.</span><span>
</span><a name="line-73"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-74"></a><span>
</span><a name="line-75"></a><span class="hs-comment">-- | Arguments specific to the ChainDB, not to the ImmutableDB, VolatileDB, or</span><span>
</span><a name="line-76"></a><span class="hs-comment">-- LedgerDB.</span><span>
</span><a name="line-77"></a><span class="hs-keyword">data</span><span> </span><a name="ChainDbSpecificArgs"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbSpecificArgs"><span class="hs-identifier">ChainDbSpecificArgs</span></a></a><span> </span><a name="local-6989586621680088014"><a href="#local-6989586621680088014"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621680088015"><a href="#local-6989586621680088015"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621680088016"><a href="#local-6989586621680088016"><span class="hs-identifier">blk</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ChainDbSpecificArgs"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbSpecificArgs"><span class="hs-identifier">ChainDbSpecificArgs</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-78"></a><span>      </span><a name="cdbsBlocksToAddSize"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbsBlocksToAddSize"><span class="hs-identifier">cdbsBlocksToAddSize</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word</span><span>
</span><a name="line-79"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbsCheckInFuture"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbsCheckInFuture"><span class="hs-identifier">cdbsCheckInFuture</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Util.Args.html#HKD"><span class="hs-identifier hs-type">HKD</span></a><span> </span><a href="#local-6989586621680088014"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Fragment.InFuture.html#CheckInFuture"><span class="hs-identifier hs-type">CheckInFuture</span></a><span> </span><a href="#local-6989586621680088015"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621680088016"><span class="hs-identifier hs-type">blk</span></a><span class="hs-special">)</span><span>
</span><a name="line-80"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbsGcDelay"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbsGcDelay"><span class="hs-identifier">cdbsGcDelay</span></a></a><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DiffTime</span><span>
</span><a name="line-81"></a><span>      </span><span class="hs-comment">-- ^ Delay between copying a block to the ImmutableDB and triggering a</span><span>
</span><a name="line-82"></a><span>      </span><span class="hs-comment">-- garbage collection for the corresponding slot on the VolatileDB.</span><span>
</span><a name="line-83"></a><span>      </span><span class="hs-comment">--</span><span>
</span><a name="line-84"></a><span>      </span><span class="hs-comment">-- The goal of the delay is to ensure that the write to the ImmutableDB</span><span>
</span><a name="line-85"></a><span>      </span><span class="hs-comment">-- has been flushed to disk before deleting the block from the</span><span>
</span><a name="line-86"></a><span>      </span><span class="hs-comment">-- VolatileDB, so that a crash won't result in the loss of the block.</span><span>
</span><a name="line-87"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbsGcInterval"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbsGcInterval"><span class="hs-identifier">cdbsGcInterval</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DiffTime</span><span>
</span><a name="line-88"></a><span>      </span><span class="hs-comment">-- ^ Batch all scheduled GCs so that at most one GC happens every</span><span>
</span><a name="line-89"></a><span>      </span><span class="hs-comment">-- 'cdbsGcInterval'.</span><span>
</span><a name="line-90"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbsRegistry"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbsRegistry"><span class="hs-identifier">cdbsRegistry</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Util.Args.html#HKD"><span class="hs-identifier hs-type">HKD</span></a><span> </span><a href="#local-6989586621680088014"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Util.ResourceRegistry.html#ResourceRegistry"><span class="hs-identifier hs-type">ResourceRegistry</span></a><span> </span><a href="#local-6989586621680088015"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span>      </span><span class="hs-comment">-- ^ TODO: the ImmutableDB takes a 'ResourceRegistry' too, but we're</span><span>
</span><a name="line-92"></a><span>      </span><span class="hs-comment">-- using it for ChainDB-specific things. Revisit these arguments.</span><span>
</span><a name="line-93"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbsTracer"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbsTracer"><span class="hs-identifier">cdbsTracer</span></a></a><span>          </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/contra-tracer-0.1.0.0/noopt/doc/html/contra-tracer/src/Control.Tracer.html#Tracer"><span class="hs-identifier hs-type">Tracer</span></a><span> </span><a href="#local-6989586621680088015"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Types.html#TraceEvent"><span class="hs-identifier hs-type">TraceEvent</span></a><span> </span><a href="#local-6989586621680088016"><span class="hs-identifier hs-type">blk</span></a><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span class="hs-comment">-- | Default arguments</span><span>
</span><a name="line-97"></a><span class="hs-comment">--</span><span>
</span><a name="line-98"></a><span class="hs-comment">-- The following fields must still be defined:</span><span>
</span><a name="line-99"></a><span class="hs-comment">--</span><span>
</span><a name="line-100"></a><span class="hs-comment">-- * 'cdbsTracer'</span><span>
</span><a name="line-101"></a><span class="hs-comment">-- * 'cdbsRegistry'</span><span>
</span><a name="line-102"></a><span class="hs-comment">-- * 'cdbsCheckInFuture'</span><span>
</span><a name="line-103"></a><span class="hs-comment">--</span><span>
</span><a name="line-104"></a><span class="hs-comment">-- We a 'cdbsGcDelay' of 60 seconds and a 'cdbsGcInterval' of 10 seconds, this</span><span>
</span><a name="line-105"></a><span class="hs-comment">-- means (see the properties in &quot;Test.Ouroboros.Storage.ChainDB.GcSchedule&quot;):</span><span>
</span><a name="line-106"></a><span class="hs-comment">--</span><span>
</span><a name="line-107"></a><span class="hs-comment">-- * The length of the 'GcSchedule' queue is @&lt;= &#8968;gcDelay / gcInterval&#8969; + 1@,</span><span>
</span><a name="line-108"></a><span class="hs-comment">--   i.e., @&lt;= 7@.</span><span>
</span><a name="line-109"></a><span class="hs-comment">-- * The overlap (number of blocks in both the VolatileDB and the ImmutableDB)</span><span>
</span><a name="line-110"></a><span class="hs-comment">--   is the number of blocks synced in @gcDelay + gcInterval@ = 70s. E.g, when</span><span>
</span><a name="line-111"></a><span class="hs-comment">--   bulk syncing at 1k-2k blocks/s, this means 70k-140k blocks. During normal</span><span>
</span><a name="line-112"></a><span class="hs-comment">--   operation, we receive 1 block/20s (for Byron /and/ for Shelley), meaning</span><span>
</span><a name="line-113"></a><span class="hs-comment">--   at most 4 blocks.</span><span>
</span><a name="line-114"></a><span class="hs-comment">-- * The unnecessary overlap (the blocks that we haven't GC'ed yet but could</span><span>
</span><a name="line-115"></a><span class="hs-comment">--   have, because of batching) &lt; the number of blocks sync in @gcInterval@.</span><span>
</span><a name="line-116"></a><span class="hs-comment">--   E.g., when syncing at 1k-2k blocks/s, this means 10k-20k blocks. During</span><span>
</span><a name="line-117"></a><span class="hs-comment">--   normal operation, we receive 1 block/20s, meaning at most 1 block.</span><span>
</span><a name="line-118"></a><span class="hs-identifier">defaultSpecificArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621680088027"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbSpecificArgs"><span class="hs-identifier hs-type">ChainDbSpecificArgs</span></a><span> </span><a href="Ouroboros.Consensus.Util.Args.html#Defaults"><span class="hs-identifier hs-type">Defaults</span></a><span> </span><a href="#local-6989586621680088027"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621680088028"><span class="hs-identifier hs-type">blk</span></a><span>
</span><a name="line-119"></a><a name="defaultSpecificArgs"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#defaultSpecificArgs"><span class="hs-identifier">defaultSpecificArgs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbSpecificArgs"><span class="hs-identifier hs-var">ChainDbSpecificArgs</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-120"></a><span>      </span><span class="hs-identifier">cdbsBlocksToAddSize</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">10</span><span>
</span><a name="line-121"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbsCheckInFuture</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="Ouroboros.Consensus.Util.Args.html#NoDefault"><span class="hs-identifier hs-var">NoDefault</span></a><span>
</span><a name="line-122"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbsGcDelay</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">secondsToDiffTime</span><span> </span><span class="hs-number">60</span><span>
</span><a name="line-123"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbsGcInterval</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">secondsToDiffTime</span><span> </span><span class="hs-number">10</span><span>
</span><a name="line-124"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbsRegistry</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="Ouroboros.Consensus.Util.Args.html#NoDefault"><span class="hs-identifier hs-var">NoDefault</span></a><span>
</span><a name="line-125"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbsTracer</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/contra-tracer-0.1.0.0/noopt/doc/html/contra-tracer/src/Control.Tracer.html#nullTracer"><span class="hs-identifier hs-var">nullTracer</span></a><span>
</span><a name="line-126"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span class="hs-comment">-- | Default arguments for use within IO</span><span>
</span><a name="line-129"></a><span class="hs-comment">--</span><span>
</span><a name="line-130"></a><span class="hs-comment">-- See 'ImmutableDB.defaultArgs', 'VolatileDB.defaultArgs', 'LgrDB.defaultArgs',</span><span>
</span><a name="line-131"></a><span class="hs-comment">-- and 'defaultSpecificArgs' for a list of which fields are not given a default</span><span>
</span><a name="line-132"></a><span class="hs-comment">-- and must therefore be set explicitly.</span><span>
</span><a name="line-133"></a><span class="hs-identifier">defaultArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbArgs"><span class="hs-identifier hs-type">ChainDbArgs</span></a><span> </span><a href="Ouroboros.Consensus.Util.Args.html#Defaults"><span class="hs-identifier hs-type">Defaults</span></a><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621680088026"><span class="hs-identifier hs-type">blk</span></a><span>
</span><a name="line-134"></a><a name="defaultArgs"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#defaultArgs"><span class="hs-identifier">defaultArgs</span></a></a><span> </span><a name="local-6989586621680088029"><a href="#local-6989586621680088029"><span class="hs-identifier">fp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#toChainDbArgs"><span class="hs-identifier hs-var">toChainDbArgs</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Storage.ImmutableDB.Impl.html#defaultArgs"><span class="hs-identifier hs-var">ImmutableDB.defaultArgs</span></a><span> </span><a href="#local-6989586621680088029"><span class="hs-identifier hs-var">fp</span></a><span class="hs-special">)</span><span>
</span><a name="line-135"></a><span>                               </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Storage.VolatileDB.Impl.html#defaultArgs"><span class="hs-identifier hs-var">VolatileDB.defaultArgs</span></a><span>  </span><a href="#local-6989586621680088029"><span class="hs-identifier hs-var">fp</span></a><span class="hs-special">)</span><span>
</span><a name="line-136"></a><span>                               </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.LgrDB.html#defaultArgs"><span class="hs-identifier hs-var">LgrDB.defaultArgs</span></a><span>       </span><a href="#local-6989586621680088029"><span class="hs-identifier hs-var">fp</span></a><span class="hs-special">)</span><span>
</span><a name="line-137"></a><span>                               </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#defaultSpecificArgs"><span class="hs-identifier hs-var">defaultSpecificArgs</span></a><span>
</span><a name="line-138"></a><span>
</span><a name="line-139"></a><span>
</span><a name="line-140"></a><span class="hs-comment">-- | Internal: split 'ChainDbArgs' into 'ImmutableDbArgs', 'VolatileDbArgs,</span><span>
</span><a name="line-141"></a><span class="hs-comment">-- 'LgrDbArgs', and 'ChainDbSpecificArgs'.</span><span>
</span><a name="line-142"></a><span class="hs-identifier">fromChainDbArgs</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-143"></a><span>     </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621680088023"><a href="#local-6989586621680088023"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621680088024"><a href="#local-6989586621680088024"><span class="hs-identifier">blk</span></a></a><span> </span><a name="local-6989586621680088025"><a href="#local-6989586621680088025"><span class="hs-identifier">f</span></a></a><span class="hs-operator">.</span><span> </span><a href="Ouroboros.Consensus.Util.Args.html#MapHKD"><span class="hs-identifier hs-type">MapHKD</span></a><span> </span><a href="#local-6989586621680088025"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-144"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbArgs"><span class="hs-identifier hs-type">ChainDbArgs</span></a><span> </span><a href="#local-6989586621680088025"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621680088023"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621680088024"><span class="hs-identifier hs-type">blk</span></a><span>
</span><a name="line-145"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><a href="Ouroboros.Consensus.Storage.ImmutableDB.Impl.html#ImmutableDbArgs"><span class="hs-identifier hs-type">ImmutableDB.ImmutableDbArgs</span></a><span> </span><a href="#local-6989586621680088025"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621680088023"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621680088024"><span class="hs-identifier hs-type">blk</span></a><span>
</span><a name="line-146"></a><span>     </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.Storage.VolatileDB.Impl.html#VolatileDbArgs"><span class="hs-identifier hs-type">VolatileDB.VolatileDbArgs</span></a><span>   </span><a href="#local-6989586621680088025"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621680088023"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621680088024"><span class="hs-identifier hs-type">blk</span></a><span>
</span><a name="line-147"></a><span>     </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.LgrDB.html#LgrDbArgs"><span class="hs-identifier hs-type">LgrDB.LgrDbArgs</span></a><span>             </span><a href="#local-6989586621680088025"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621680088023"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621680088024"><span class="hs-identifier hs-type">blk</span></a><span>
</span><a name="line-148"></a><span>     </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbSpecificArgs"><span class="hs-identifier hs-type">ChainDbSpecificArgs</span></a><span>         </span><a href="#local-6989586621680088025"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621680088023"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621680088024"><span class="hs-identifier hs-type">blk</span></a><span>
</span><a name="line-149"></a><span>     </span><span class="hs-special">)</span><span>
</span><a name="line-150"></a><a name="fromChainDbArgs"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#fromChainDbArgs"><span class="hs-identifier">fromChainDbArgs</span></a></a><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbArgs"><span class="hs-identifier hs-var">ChainDbArgs</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-151"></a><span>      </span><a href="Ouroboros.Consensus.Storage.ImmutableDB.Impl.html#ImmutableDbArgs"><span class="hs-identifier hs-var">ImmutableDB.ImmutableDbArgs</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-152"></a><span>          </span><span class="hs-identifier">immCacheConfig</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088043"><span class="hs-identifier hs-var">cdbImmutableDbCacheConfig</span></a><span>
</span><a name="line-153"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">immCheckIntegrity</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088040"><span class="hs-identifier hs-var">cdbCheckIntegrity</span></a><span>
</span><a name="line-154"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">immChunkInfo</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088039"><span class="hs-identifier hs-var">cdbChunkInfo</span></a><span>
</span><a name="line-155"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">immCodecConfig</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Ouroboros.Consensus.Util.Args.html#mapHKD"><span class="hs-identifier hs-var">mapHKD</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="#local-6989586621680088025"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Block.Abstract.html#CodecConfig"><span class="hs-identifier hs-type">CodecConfig</span></a><span> </span><a href="#local-6989586621680088024"><span class="hs-identifier hs-type">blk</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Ouroboros.Consensus.Config.html#configCodec"><span class="hs-identifier hs-var">configCodec</span></a><span> </span><a href="#local-6989586621680088038"><span class="hs-identifier hs-var">cdbTopLevelConfig</span></a><span>
</span><a name="line-156"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">immHasFS</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088030"><span class="hs-identifier hs-var">cdbHasFSImmutableDB</span></a><span>
</span><a name="line-157"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">immRegistry</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088046"><span class="hs-identifier hs-var">cdbRegistry</span></a><span>
</span><a name="line-158"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">immTracer</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">contramap</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Types.html#TraceImmutableDBEvent"><span class="hs-identifier hs-var">TraceImmutableDBEvent</span></a><span> </span><a href="#local-6989586621680088044"><span class="hs-identifier hs-var">cdbTracer</span></a><span>
</span><a name="line-159"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">immValidationPolicy</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088033"><span class="hs-identifier hs-var">cdbImmutableDbValidation</span></a><span>
</span><a name="line-160"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-161"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.Storage.VolatileDB.Impl.html#VolatileDbArgs"><span class="hs-identifier hs-var">VolatileDB.VolatileDbArgs</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-162"></a><span>          </span><span class="hs-identifier">volCheckIntegrity</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088040"><span class="hs-identifier hs-var">cdbCheckIntegrity</span></a><span>
</span><a name="line-163"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">volCodecConfig</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="Ouroboros.Consensus.Util.Args.html#mapHKD"><span class="hs-identifier hs-var">mapHKD</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="#local-6989586621680088025"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Block.Abstract.html#CodecConfig"><span class="hs-identifier hs-type">CodecConfig</span></a><span> </span><a href="#local-6989586621680088024"><span class="hs-identifier hs-type">blk</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Ouroboros.Consensus.Config.html#configCodec"><span class="hs-identifier hs-var">configCodec</span></a><span> </span><a href="#local-6989586621680088038"><span class="hs-identifier hs-var">cdbTopLevelConfig</span></a><span>
</span><a name="line-164"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">volHasFS</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088031"><span class="hs-identifier hs-var">cdbHasFSVolatileDB</span></a><span>
</span><a name="line-165"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">volMaxBlocksPerFile</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088035"><span class="hs-identifier hs-var">cdbMaxBlocksPerFile</span></a><span>
</span><a name="line-166"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">volValidationPolicy</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088034"><span class="hs-identifier hs-var">cdbVolatileDbValidation</span></a><span>
</span><a name="line-167"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">volTracer</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">contramap</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Types.html#TraceVolatileDBEvent"><span class="hs-identifier hs-var">TraceVolatileDBEvent</span></a><span> </span><a href="#local-6989586621680088044"><span class="hs-identifier hs-var">cdbTracer</span></a><span>
</span><a name="line-168"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-169"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.LgrDB.html#LgrDbArgs"><span class="hs-identifier hs-var">LgrDB.LgrDbArgs</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-170"></a><span>          </span><span class="hs-identifier">lgrTopLevelConfig</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088038"><span class="hs-identifier hs-var">cdbTopLevelConfig</span></a><span>
</span><a name="line-171"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lgrHasFS</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088032"><span class="hs-identifier hs-var">cdbHasFSLgrDB</span></a><span>
</span><a name="line-172"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lgrParams</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088036"><span class="hs-identifier hs-var">cdbParamsLgrDB</span></a><span>
</span><a name="line-173"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lgrDiskPolicy</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088037"><span class="hs-identifier hs-var">cdbDiskPolicy</span></a><span>
</span><a name="line-174"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lgrGenesis</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088041"><span class="hs-identifier hs-var">cdbGenesis</span></a><span>
</span><a name="line-175"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lgrTracer</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">contramap</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Types.html#TraceLedgerEvent"><span class="hs-identifier hs-var">TraceLedgerEvent</span></a><span> </span><a href="#local-6989586621680088044"><span class="hs-identifier hs-var">cdbTracer</span></a><span>
</span><a name="line-176"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lgrTraceLedger</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088045"><span class="hs-identifier hs-var">cdbTraceLedger</span></a><span>
</span><a name="line-177"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-178"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbSpecificArgs"><span class="hs-identifier hs-var">ChainDbSpecificArgs</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-179"></a><span>          </span><span class="hs-identifier">cdbsTracer</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088044"><span class="hs-identifier hs-var">cdbTracer</span></a><span>
</span><a name="line-180"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbsRegistry</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088046"><span class="hs-identifier hs-var">cdbRegistry</span></a><span>
</span><a name="line-181"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbsGcDelay</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088047"><span class="hs-identifier hs-var">cdbGcDelay</span></a><span>
</span><a name="line-182"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbsGcInterval</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088048"><span class="hs-identifier hs-var">cdbGcInterval</span></a><span>
</span><a name="line-183"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbsCheckInFuture</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088042"><span class="hs-identifier hs-var">cdbCheckInFuture</span></a><span>
</span><a name="line-184"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbsBlocksToAddSize</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088049"><span class="hs-identifier hs-var">cdbBlocksToAddSize</span></a><span>
</span><a name="line-185"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-186"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-187"></a><span>
</span><a name="line-188"></a><span class="hs-comment">-- | Internal: construct 'ChainDbArgs' from 'ImmutableDbArgs', 'VolatileDbArgs,</span><span>
</span><a name="line-189"></a><span class="hs-comment">-- 'LgrDbArgs', and 'ChainDbSpecificArgs'.</span><span>
</span><a name="line-190"></a><span class="hs-comment">--</span><span>
</span><a name="line-191"></a><span class="hs-comment">-- Useful in 'defaultArgs'</span><span>
</span><a name="line-192"></a><span class="hs-identifier">toChainDbArgs</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-193"></a><span>     </span><a href="Ouroboros.Consensus.Storage.ImmutableDB.Impl.html#ImmutableDbArgs"><span class="hs-identifier hs-type">ImmutableDB.ImmutableDbArgs</span></a><span> </span><a href="#local-6989586621680088020"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621680088021"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621680088022"><span class="hs-identifier hs-type">blk</span></a><span>
</span><a name="line-194"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.Storage.VolatileDB.Impl.html#VolatileDbArgs"><span class="hs-identifier hs-type">VolatileDB.VolatileDbArgs</span></a><span>   </span><a href="#local-6989586621680088020"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621680088021"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621680088022"><span class="hs-identifier hs-type">blk</span></a><span>
</span><a name="line-195"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.LgrDB.html#LgrDbArgs"><span class="hs-identifier hs-type">LgrDB.LgrDbArgs</span></a><span>             </span><a href="#local-6989586621680088020"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621680088021"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621680088022"><span class="hs-identifier hs-type">blk</span></a><span>
</span><a name="line-196"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbSpecificArgs"><span class="hs-identifier hs-type">ChainDbSpecificArgs</span></a><span>         </span><a href="#local-6989586621680088020"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621680088021"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621680088022"><span class="hs-identifier hs-type">blk</span></a><span>
</span><a name="line-197"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbArgs"><span class="hs-identifier hs-type">ChainDbArgs</span></a><span>                 </span><a href="#local-6989586621680088020"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621680088021"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621680088022"><span class="hs-identifier hs-type">blk</span></a><span>
</span><a name="line-198"></a><a name="toChainDbArgs"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#toChainDbArgs"><span class="hs-identifier">toChainDbArgs</span></a></a><span> </span><a href="Ouroboros.Consensus.Storage.ImmutableDB.Impl.html#ImmutableDbArgs"><span class="hs-identifier hs-var">ImmutableDB.ImmutableDbArgs</span></a><span> </span><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span>
</span><a name="line-199"></a><span>              </span><a href="Ouroboros.Consensus.Storage.VolatileDB.Impl.html#VolatileDbArgs"><span class="hs-identifier hs-var">VolatileDB.VolatileDbArgs</span></a><span> </span><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span>
</span><a name="line-200"></a><span>              </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.LgrDB.html#LgrDbArgs"><span class="hs-identifier hs-var">LgrDB.LgrDbArgs</span></a><span> </span><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span>
</span><a name="line-201"></a><span>              </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbSpecificArgs"><span class="hs-identifier hs-var">ChainDbSpecificArgs</span></a><span> </span><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbArgs"><span class="hs-identifier hs-var">ChainDbArgs</span></a><span class="hs-special">{</span><span>
</span><a name="line-202"></a><span>      </span><span class="hs-comment">-- HasFS instances</span><span>
</span><a name="line-203"></a><span>      </span><span class="hs-identifier">cdbHasFSImmutableDB</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088054"><span class="hs-identifier hs-var">immHasFS</span></a><span>
</span><a name="line-204"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbHasFSVolatileDB</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088060"><span class="hs-identifier hs-var">volHasFS</span></a><span>
</span><a name="line-205"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbHasFSLgrDB</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088066"><span class="hs-identifier hs-var">lgrHasFS</span></a><span>
</span><a name="line-206"></a><span>      </span><span class="hs-comment">-- Policy</span><span>
</span><a name="line-207"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbImmutableDbValidation</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088057"><span class="hs-identifier hs-var">immValidationPolicy</span></a><span>
</span><a name="line-208"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbVolatileDbValidation</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088063"><span class="hs-identifier hs-var">volValidationPolicy</span></a><span>
</span><a name="line-209"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbMaxBlocksPerFile</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088061"><span class="hs-identifier hs-var">volMaxBlocksPerFile</span></a><span>
</span><a name="line-210"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbParamsLgrDB</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088067"><span class="hs-identifier hs-var">lgrParams</span></a><span>
</span><a name="line-211"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbDiskPolicy</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088064"><span class="hs-identifier hs-var">lgrDiskPolicy</span></a><span>
</span><a name="line-212"></a><span>      </span><span class="hs-comment">-- Integration</span><span>
</span><a name="line-213"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbTopLevelConfig</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088068"><span class="hs-identifier hs-var">lgrTopLevelConfig</span></a><span>
</span><a name="line-214"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbChunkInfo</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088052"><span class="hs-identifier hs-var">immChunkInfo</span></a><span>
</span><a name="line-215"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbCheckIntegrity</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088051"><span class="hs-identifier hs-var">immCheckIntegrity</span></a><span>
</span><a name="line-216"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbGenesis</span><span>                </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088065"><span class="hs-identifier hs-var">lgrGenesis</span></a><span>
</span><a name="line-217"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbCheckInFuture</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088072"><span class="hs-identifier hs-var">cdbsCheckInFuture</span></a><span>
</span><a name="line-218"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbImmutableDbCacheConfig</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088050"><span class="hs-identifier hs-var">immCacheConfig</span></a><span>
</span><a name="line-219"></a><span>      </span><span class="hs-comment">-- Misc</span><span>
</span><a name="line-220"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbTracer</span><span>                 </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088076"><span class="hs-identifier hs-var">cdbsTracer</span></a><span>
</span><a name="line-221"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbTraceLedger</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088069"><span class="hs-identifier hs-var">lgrTraceLedger</span></a><span>
</span><a name="line-222"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbRegistry</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088055"><span class="hs-identifier hs-var">immRegistry</span></a><span>
</span><a name="line-223"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbGcDelay</span><span>                </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088073"><span class="hs-identifier hs-var">cdbsGcDelay</span></a><span>
</span><a name="line-224"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbGcInterval</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088074"><span class="hs-identifier hs-var">cdbsGcInterval</span></a><span>
</span><a name="line-225"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbBlocksToAddSize</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621680088071"><span class="hs-identifier hs-var">cdbsBlocksToAddSize</span></a><span>
</span><a name="line-226"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-227"></a></pre></body></html>