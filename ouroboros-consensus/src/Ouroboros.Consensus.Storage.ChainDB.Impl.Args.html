<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ExistentialQuantification #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE RankNTypes                #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE RecordWildCards           #-}</span><span>
</span><a name="line-4"></a><span>
</span><a name="line-5"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ouroboros.Consensus.Storage.ChainDB.Impl.Args</span><span>
</span><a name="line-6"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbArgs"><span class="hs-identifier hs-type">ChainDbArgs</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-7"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbSpecificArgs"><span class="hs-identifier hs-type">ChainDbSpecificArgs</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-8"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#defaultArgs"><span class="hs-identifier hs-var">defaultArgs</span></a><span>
</span><a name="line-9"></a><span>    </span><span class="hs-comment">-- * Internal</span><span>
</span><a name="line-10"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#fromChainDbArgs"><span class="hs-identifier hs-var">fromChainDbArgs</span></a><span>
</span><a name="line-11"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Codec.CBOR.Decoding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Decoder</span><span class="hs-special">)</span><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Codec.CBOR.Encoding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Encoding</span><span class="hs-special">)</span><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString.Lazy</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Lazy</span><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Time.Clock</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">DiffTime</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">secondsToDiffTime</span><span class="hs-special">)</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span>           </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/contra-tracer-0.1.0.0/noopt/doc/html/contra-tracer/src/Control.Tracer.html"><span class="hs-identifier">Control.Tracer</span></a><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/contra-tracer-0.1.0.0/noopt/doc/html/contra-tracer/src/Control.Tracer.html#Tracer"><span class="hs-identifier hs-type">Tracer</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">contramap</span><span class="hs-special">)</span><span>
</span><a name="line-19"></a><span>
</span><a name="line-20"></a><span class="hs-keyword">import</span><span>           </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html"><span class="hs-identifier">Cardano.Slotting.Slot</span></a><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span>           </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src/Ouroboros.Network.Block.html"><span class="hs-identifier">Ouroboros.Network.Block</span></a><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src/Ouroboros.Network.Block.html#HeaderHash"><span class="hs-identifier hs-type">HeaderHash</span></a><span class="hs-special">)</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.Block.html"><span class="hs-identifier">Ouroboros.Consensus.Block</span></a><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.BlockchainTime.html"><span class="hs-identifier">Ouroboros.Consensus.BlockchainTime</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.BlockchainTime.API.html#BlockchainTime"><span class="hs-identifier hs-type">BlockchainTime</span></a><span class="hs-special">)</span><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.Config.html"><span class="hs-identifier">Ouroboros.Consensus.Config</span></a><span>
</span><a name="line-27"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.HeaderValidation.html"><span class="hs-identifier">Ouroboros.Consensus.HeaderValidation</span></a><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.Ledger.Abstract.html"><span class="hs-identifier">Ouroboros.Consensus.Ledger.Abstract</span></a><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.Ledger.Extended.html"><span class="hs-identifier">Ouroboros.Consensus.Ledger.Extended</span></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.Protocol.Abstract.html"><span class="hs-identifier">Ouroboros.Consensus.Protocol.Abstract</span></a><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.Util.ResourceRegistry.html"><span class="hs-identifier">Ouroboros.Consensus.Util.ResourceRegistry</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Util.ResourceRegistry.html#ResourceRegistry"><span class="hs-identifier hs-type">ResourceRegistry</span></a><span class="hs-special">)</span><span>
</span><a name="line-32"></a><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.Storage.Common.html"><span class="hs-identifier">Ouroboros.Consensus.Storage.Common</span></a><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.Storage.FS.API.html"><span class="hs-identifier">Ouroboros.Consensus.Storage.FS.API</span></a><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.ImmDB.html"><span class="hs-identifier">Ouroboros.Consensus.Storage.ChainDB.Impl.ImmDB</span></a><span>
</span><a name="line-37"></a><span>                     </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Storage.Common.html#BinaryInfo"><span class="hs-identifier hs-type">BinaryInfo</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.Storage.ImmutableDB.Chunks.Internal.html#ChunkInfo"><span class="hs-identifier hs-type">ChunkInfo</span></a><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.Storage.ImmutableDB.Types.html#HashInfo"><span class="hs-identifier hs-type">HashInfo</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.ImmDB.html"><span class="hs-identifier">Ouroboros.Consensus.Storage.ChainDB.Impl.ImmDB</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">ImmDB</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.LgrDB.html"><span class="hs-identifier">Ouroboros.Consensus.Storage.ChainDB.Impl.LgrDB</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">LgrDB</span><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span>           </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Types.html"><span class="hs-identifier">Ouroboros.Consensus.Storage.ChainDB.Impl.Types</span></a><span>
</span><a name="line-41"></a><span>                     </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Types.html#TraceEvent"><span class="hs-identifier hs-type">TraceEvent</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.VolDB.html"><span class="hs-identifier">Ouroboros.Consensus.Storage.ChainDB.Impl.VolDB</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">VolDB</span><span>
</span><a name="line-43"></a><span>
</span><a name="line-44"></a><span class="hs-comment">{-------------------------------------------------------------------------------
  Arguments
-------------------------------------------------------------------------------}</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span class="hs-keyword">data</span><span> </span><a name="ChainDbArgs"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbArgs"><span class="hs-identifier">ChainDbArgs</span></a></a><span> </span><a name="local-6989586621679657506"><a href="#local-6989586621679657506"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679657507"><a href="#local-6989586621679657507"><span class="hs-identifier">blk</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679657508"><a href="#local-6989586621679657508"><span class="hs-identifier">h1</span></a></a><span> </span><a name="local-6989586621679657509"><a href="#local-6989586621679657509"><span class="hs-identifier">h2</span></a></a><span> </span><a name="local-6989586621679657510"><a href="#local-6989586621679657510"><span class="hs-identifier">h3</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679657508"><span class="hs-identifier hs-type">h1</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679657509"><span class="hs-identifier hs-type">h2</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679657510"><span class="hs-identifier hs-type">h3</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="ChainDbArgs"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbArgs"><span class="hs-identifier">ChainDbArgs</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-49"></a><span>
</span><a name="line-50"></a><span>      </span><span class="hs-comment">-- Decoders</span><span>
</span><a name="line-51"></a><span>      </span><a name="cdbDecodeHash"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbDecodeHash"><span class="hs-identifier">cdbDecodeHash</span></a></a><span>           </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679657511"><a href="#local-6989586621679657511"><span class="hs-identifier">s</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Decoder</span><span> </span><a href="#local-6989586621679657511"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src/Ouroboros.Network.Block.html#HeaderHash"><span class="hs-identifier hs-type">HeaderHash</span></a><span> </span><a href="#local-6989586621679657507"><span class="hs-identifier hs-type">blk</span></a><span class="hs-special">)</span><span>
</span><a name="line-52"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbDecodeBlock"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbDecodeBlock"><span class="hs-identifier">cdbDecodeBlock</span></a></a><span>          </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679657512"><a href="#local-6989586621679657512"><span class="hs-identifier">s</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Decoder</span><span> </span><a href="#local-6989586621679657512"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Lazy.ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679657507"><span class="hs-identifier hs-type">blk</span></a><span class="hs-special">)</span><span>
</span><a name="line-53"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbDecodeHeader"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbDecodeHeader"><span class="hs-identifier">cdbDecodeHeader</span></a></a><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679657513"><a href="#local-6989586621679657513"><span class="hs-identifier">s</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Decoder</span><span> </span><a href="#local-6989586621679657513"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Lazy.ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.Block.Abstract.html#Header"><span class="hs-identifier hs-type">Header</span></a><span> </span><a href="#local-6989586621679657507"><span class="hs-identifier hs-type">blk</span></a><span class="hs-special">)</span><span>
</span><a name="line-54"></a><span>      </span><span class="hs-comment">-- ^ The given encoding will include the header envelope</span><span>
</span><a name="line-55"></a><span>      </span><span class="hs-comment">-- ('cdbAddHdrEnv').</span><span>
</span><a name="line-56"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbDecodeLedger"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbDecodeLedger"><span class="hs-identifier">cdbDecodeLedger</span></a></a><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679657514"><a href="#local-6989586621679657514"><span class="hs-identifier">s</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Decoder</span><span> </span><a href="#local-6989586621679657514"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Ledger.Abstract.html#LedgerState"><span class="hs-identifier hs-type">LedgerState</span></a><span> </span><a href="#local-6989586621679657507"><span class="hs-identifier hs-type">blk</span></a><span class="hs-special">)</span><span>
</span><a name="line-57"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbDecodeTipInfo"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbDecodeTipInfo"><span class="hs-identifier">cdbDecodeTipInfo</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679657515"><a href="#local-6989586621679657515"><span class="hs-identifier">s</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Decoder</span><span> </span><a href="#local-6989586621679657515"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.HeaderValidation.html#TipInfo"><span class="hs-identifier hs-type">TipInfo</span></a><span> </span><a href="#local-6989586621679657507"><span class="hs-identifier hs-type">blk</span></a><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbDecodeConsensusState"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbDecodeConsensusState"><span class="hs-identifier">cdbDecodeConsensusState</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679657516"><a href="#local-6989586621679657516"><span class="hs-identifier">s</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-identifier hs-type">Decoder</span><span> </span><a href="#local-6989586621679657516"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Protocol.Abstract.html#ConsensusState"><span class="hs-identifier hs-type">ConsensusState</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Block.Abstract.html#BlockProtocol"><span class="hs-identifier hs-type">BlockProtocol</span></a><span> </span><a href="#local-6989586621679657507"><span class="hs-identifier hs-type">blk</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span>
</span><a name="line-60"></a><span>      </span><span class="hs-comment">-- Encoders</span><span>
</span><a name="line-61"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbEncodeHash"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbEncodeHash"><span class="hs-identifier">cdbEncodeHash</span></a></a><span>           </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src/Ouroboros.Network.Block.html#HeaderHash"><span class="hs-identifier hs-type">HeaderHash</span></a><span> </span><a href="#local-6989586621679657507"><span class="hs-identifier hs-type">blk</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Encoding</span><span>
</span><a name="line-62"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbEncodeBlock"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbEncodeBlock"><span class="hs-identifier">cdbEncodeBlock</span></a></a><span>          </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679657507"><span class="hs-identifier hs-type">blk</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.Storage.Common.html#BinaryInfo"><span class="hs-identifier hs-type">BinaryInfo</span></a><span> </span><span class="hs-identifier hs-type">Encoding</span><span>
</span><a name="line-63"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbEncodeHeader"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbEncodeHeader"><span class="hs-identifier">cdbEncodeHeader</span></a></a><span>         </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Block.Abstract.html#Header"><span class="hs-identifier hs-type">Header</span></a><span> </span><a href="#local-6989586621679657507"><span class="hs-identifier hs-type">blk</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Encoding</span><span>
</span><a name="line-64"></a><span>      </span><span class="hs-comment">-- ^ The returned encoding must include the header envelope</span><span>
</span><a name="line-65"></a><span>      </span><span class="hs-comment">-- ('cdbAddHdrEnv').</span><span>
</span><a name="line-66"></a><span>      </span><span class="hs-comment">--</span><span>
</span><a name="line-67"></a><span>      </span><span class="hs-comment">-- This should be cheap, preferably \( O(1) \), as the Readers will</span><span>
</span><a name="line-68"></a><span>      </span><span class="hs-comment">-- often be encoding the in-memory headers. (It is cheap for Byron</span><span>
</span><a name="line-69"></a><span>      </span><span class="hs-comment">-- headers, as we store the serialisation in the annotation.)</span><span>
</span><a name="line-70"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbEncodeLedger"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbEncodeLedger"><span class="hs-identifier">cdbEncodeLedger</span></a></a><span>         </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Ledger.Abstract.html#LedgerState"><span class="hs-identifier hs-type">LedgerState</span></a><span> </span><a href="#local-6989586621679657507"><span class="hs-identifier hs-type">blk</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Encoding</span><span>
</span><a name="line-71"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbEncodeTipInfo"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbEncodeTipInfo"><span class="hs-identifier">cdbEncodeTipInfo</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.HeaderValidation.html#TipInfo"><span class="hs-identifier hs-type">TipInfo</span></a><span> </span><a href="#local-6989586621679657507"><span class="hs-identifier hs-type">blk</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Encoding</span><span>
</span><a name="line-72"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbEncodeConsensusState"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbEncodeConsensusState"><span class="hs-identifier">cdbEncodeConsensusState</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Protocol.Abstract.html#ConsensusState"><span class="hs-identifier hs-type">ConsensusState</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Block.Abstract.html#BlockProtocol"><span class="hs-identifier hs-type">BlockProtocol</span></a><span> </span><a href="#local-6989586621679657507"><span class="hs-identifier hs-type">blk</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Encoding</span><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span>      </span><span class="hs-comment">-- HasFS instances</span><span>
</span><a name="line-75"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbHasFSImmDb"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbHasFSImmDb"><span class="hs-identifier">cdbHasFSImmDb</span></a></a><span>           </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Storage.FS.API.html#HasFS"><span class="hs-identifier hs-type">HasFS</span></a><span> </span><a href="#local-6989586621679657506"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679657508"><span class="hs-identifier hs-type">h1</span></a><span>
</span><a name="line-76"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbHasFSVolDb"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbHasFSVolDb"><span class="hs-identifier">cdbHasFSVolDb</span></a></a><span>           </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Storage.FS.API.html#HasFS"><span class="hs-identifier hs-type">HasFS</span></a><span> </span><a href="#local-6989586621679657506"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679657509"><span class="hs-identifier hs-type">h2</span></a><span>
</span><a name="line-77"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbHasFSLgrDB"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbHasFSLgrDB"><span class="hs-identifier">cdbHasFSLgrDB</span></a></a><span>           </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Storage.FS.API.html#HasFS"><span class="hs-identifier hs-type">HasFS</span></a><span> </span><a href="#local-6989586621679657506"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679657510"><span class="hs-identifier hs-type">h3</span></a><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span>      </span><span class="hs-comment">-- Policy</span><span>
</span><a name="line-80"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbImmValidation"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbImmValidation"><span class="hs-identifier">cdbImmValidation</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Storage.ImmutableDB.Types.html#ValidationPolicy"><span class="hs-identifier hs-type">ImmDB.ValidationPolicy</span></a><span>
</span><a name="line-81"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbVolValidation"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbVolValidation"><span class="hs-identifier">cdbVolValidation</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Storage.VolatileDB.Types.html#BlockValidationPolicy"><span class="hs-identifier hs-type">VolDB.BlockValidationPolicy</span></a><span>
</span><a name="line-82"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbBlocksPerFile"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbBlocksPerFile"><span class="hs-identifier">cdbBlocksPerFile</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Storage.VolatileDB.Types.html#BlocksPerFile"><span class="hs-identifier hs-type">VolDB.BlocksPerFile</span></a><span>
</span><a name="line-83"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbParamsLgrDB"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbParamsLgrDB"><span class="hs-identifier">cdbParamsLgrDB</span></a></a><span>          </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Storage.LedgerDB.InMemory.html#LedgerDbParams"><span class="hs-identifier hs-type">LgrDB.LedgerDbParams</span></a><span>
</span><a name="line-84"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbDiskPolicy"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbDiskPolicy"><span class="hs-identifier">cdbDiskPolicy</span></a></a><span>           </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Storage.LedgerDB.DiskPolicy.html#DiskPolicy"><span class="hs-identifier hs-type">LgrDB.DiskPolicy</span></a><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span>      </span><span class="hs-comment">-- Integration</span><span>
</span><a name="line-87"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbTopLevelConfig"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbTopLevelConfig"><span class="hs-identifier">cdbTopLevelConfig</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Config.html#TopLevelConfig"><span class="hs-identifier hs-type">TopLevelConfig</span></a><span> </span><a href="#local-6989586621679657507"><span class="hs-identifier hs-type">blk</span></a><span>
</span><a name="line-88"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbChunkInfo"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbChunkInfo"><span class="hs-identifier">cdbChunkInfo</span></a></a><span>            </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Storage.ImmutableDB.Chunks.Internal.html#ChunkInfo"><span class="hs-identifier hs-type">ChunkInfo</span></a><span>
</span><a name="line-89"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbHashInfo"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbHashInfo"><span class="hs-identifier">cdbHashInfo</span></a></a><span>             </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Storage.ImmutableDB.Types.html#HashInfo"><span class="hs-identifier hs-type">HashInfo</span></a><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src/Ouroboros.Network.Block.html#HeaderHash"><span class="hs-identifier hs-type">HeaderHash</span></a><span> </span><a href="#local-6989586621679657507"><span class="hs-identifier hs-type">blk</span></a><span class="hs-special">)</span><span>
</span><a name="line-90"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbIsEBB"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbIsEBB"><span class="hs-identifier">cdbIsEBB</span></a></a><span>                </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Block.Abstract.html#Header"><span class="hs-identifier hs-type">Header</span></a><span> </span><a href="#local-6989586621679657507"><span class="hs-identifier hs-type">blk</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-slotting-0.1.0.0/noopt/doc/html/cardano-slotting/src/Cardano.Slotting.Slot.html#EpochNo"><span class="hs-identifier hs-type">EpochNo</span></a><span>
</span><a name="line-91"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbCheckIntegrity"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbCheckIntegrity"><span class="hs-identifier">cdbCheckIntegrity</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679657507"><span class="hs-identifier hs-type">blk</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-92"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbGenesis"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbGenesis"><span class="hs-identifier">cdbGenesis</span></a></a><span>              </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679657506"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Ledger.Extended.html#ExtLedgerState"><span class="hs-identifier hs-type">ExtLedgerState</span></a><span> </span><a href="#local-6989586621679657507"><span class="hs-identifier hs-type">blk</span></a><span class="hs-special">)</span><span>
</span><a name="line-93"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbBlockchainTime"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbBlockchainTime"><span class="hs-identifier">cdbBlockchainTime</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.BlockchainTime.API.html#BlockchainTime"><span class="hs-identifier hs-type">BlockchainTime</span></a><span> </span><a href="#local-6989586621679657506"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-94"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbAddHdrEnv"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbAddHdrEnv"><span class="hs-identifier">cdbAddHdrEnv</span></a></a><span>            </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Block.EBB.html#IsEBB"><span class="hs-identifier hs-type">IsEBB</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/ouroboros-network-0.1.0.0/noopt/doc/html/ouroboros-network/src/Ouroboros.Network.DeltaQ.html#SizeInBytes"><span class="hs-identifier hs-type">SizeInBytes</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Lazy.ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Lazy.ByteString</span><span>
</span><a name="line-95"></a><span>      </span><span class="hs-comment">-- ^ The header envelope will only be added after extracting the binary</span><span>
</span><a name="line-96"></a><span>      </span><span class="hs-comment">-- header from the binary block. Note that we never have to remove an</span><span>
</span><a name="line-97"></a><span>      </span><span class="hs-comment">-- envelope.</span><span>
</span><a name="line-98"></a><span>      </span><span class="hs-comment">--</span><span>
</span><a name="line-99"></a><span>      </span><span class="hs-comment">-- The 'SizeInBytes' is the size of the block.</span><span>
</span><a name="line-100"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbImmDbCacheConfig"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbImmDbCacheConfig"><span class="hs-identifier">cdbImmDbCacheConfig</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Storage.ImmutableDB.Impl.Index.Cache.html#CacheConfig"><span class="hs-identifier hs-type">ImmDB.CacheConfig</span></a><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span>      </span><span class="hs-comment">-- Misc</span><span>
</span><a name="line-103"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbTracer"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbTracer"><span class="hs-identifier">cdbTracer</span></a></a><span>               </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/contra-tracer-0.1.0.0/noopt/doc/html/contra-tracer/src/Control.Tracer.html#Tracer"><span class="hs-identifier hs-type">Tracer</span></a><span> </span><a href="#local-6989586621679657506"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Types.html#TraceEvent"><span class="hs-identifier hs-type">TraceEvent</span></a><span> </span><a href="#local-6989586621679657507"><span class="hs-identifier hs-type">blk</span></a><span class="hs-special">)</span><span>
</span><a name="line-104"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbTraceLedger"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbTraceLedger"><span class="hs-identifier">cdbTraceLedger</span></a></a><span>          </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/contra-tracer-0.1.0.0/noopt/doc/html/contra-tracer/src/Control.Tracer.html#Tracer"><span class="hs-identifier hs-type">Tracer</span></a><span> </span><a href="#local-6989586621679657506"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.LgrDB.html#LedgerDB"><span class="hs-identifier hs-type">LgrDB.LedgerDB</span></a><span> </span><a href="#local-6989586621679657507"><span class="hs-identifier hs-type">blk</span></a><span class="hs-special">)</span><span>
</span><a name="line-105"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbRegistry"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbRegistry"><span class="hs-identifier">cdbRegistry</span></a></a><span>             </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Util.ResourceRegistry.html#ResourceRegistry"><span class="hs-identifier hs-type">ResourceRegistry</span></a><span> </span><a href="#local-6989586621679657506"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-106"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbGcDelay"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbGcDelay"><span class="hs-identifier">cdbGcDelay</span></a></a><span>              </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DiffTime</span><span>
</span><a name="line-107"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbGcInterval"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbGcInterval"><span class="hs-identifier">cdbGcInterval</span></a></a><span>           </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DiffTime</span><span>
</span><a name="line-108"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbBlocksToAddSize"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbBlocksToAddSize"><span class="hs-identifier">cdbBlocksToAddSize</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word</span><span>
</span><a name="line-109"></a><span>      </span><span class="hs-comment">-- ^ Size of the queue used to store asynchronously added blocks. This</span><span>
</span><a name="line-110"></a><span>      </span><span class="hs-comment">-- is the maximum number of blocks that could be kept in memory at the</span><span>
</span><a name="line-111"></a><span>      </span><span class="hs-comment">-- same time when the background thread processing the blocks can't keep</span><span>
</span><a name="line-112"></a><span>      </span><span class="hs-comment">-- up.</span><span>
</span><a name="line-113"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-114"></a><span>
</span><a name="line-115"></a><span class="hs-comment">-- | Arguments specific to the ChainDB, not to the ImmutableDB, VolatileDB, or</span><span>
</span><a name="line-116"></a><span class="hs-comment">-- LedgerDB.</span><span>
</span><a name="line-117"></a><span class="hs-keyword">data</span><span> </span><a name="ChainDbSpecificArgs"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbSpecificArgs"><span class="hs-identifier">ChainDbSpecificArgs</span></a></a><span> </span><a name="local-6989586621679657504"><a href="#local-6989586621679657504"><span class="hs-identifier">m</span></a></a><span> </span><a name="local-6989586621679657505"><a href="#local-6989586621679657505"><span class="hs-identifier">blk</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ChainDbSpecificArgs"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbSpecificArgs"><span class="hs-identifier">ChainDbSpecificArgs</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-118"></a><span>      </span><a name="cdbsTracer"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbsTracer"><span class="hs-identifier">cdbsTracer</span></a></a><span>          </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/contra-tracer-0.1.0.0/noopt/doc/html/contra-tracer/src/Control.Tracer.html#Tracer"><span class="hs-identifier hs-type">Tracer</span></a><span> </span><a href="#local-6989586621679657504"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Types.html#TraceEvent"><span class="hs-identifier hs-type">TraceEvent</span></a><span> </span><a href="#local-6989586621679657505"><span class="hs-identifier hs-type">blk</span></a><span class="hs-special">)</span><span>
</span><a name="line-119"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbsRegistry"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbsRegistry"><span class="hs-identifier">cdbsRegistry</span></a></a><span>        </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Util.ResourceRegistry.html#ResourceRegistry"><span class="hs-identifier hs-type">ResourceRegistry</span></a><span> </span><a href="#local-6989586621679657504"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-120"></a><span>      </span><span class="hs-comment">-- ^ TODO: the ImmutableDB takes a 'ResourceRegistry' too, but we're</span><span>
</span><a name="line-121"></a><span>      </span><span class="hs-comment">-- using it for ChainDB-specific things. Revisit these arguments.</span><span>
</span><a name="line-122"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbsGcDelay"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbsGcDelay"><span class="hs-identifier">cdbsGcDelay</span></a></a><span>         </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DiffTime</span><span>
</span><a name="line-123"></a><span>      </span><span class="hs-comment">-- ^ Delay between copying a block to the ImmutableDB and triggering a</span><span>
</span><a name="line-124"></a><span>      </span><span class="hs-comment">-- garbage collection for the corresponding slot on the VolatileDB.</span><span>
</span><a name="line-125"></a><span>      </span><span class="hs-comment">--</span><span>
</span><a name="line-126"></a><span>      </span><span class="hs-comment">-- The goal of the delay is to ensure that the write to the ImmutableDB</span><span>
</span><a name="line-127"></a><span>      </span><span class="hs-comment">-- has been flushed to disk before deleting the block from the</span><span>
</span><a name="line-128"></a><span>      </span><span class="hs-comment">-- VolatileDB, so that a crash won't result in the loss of the block.</span><span>
</span><a name="line-129"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbsGcInterval"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbsGcInterval"><span class="hs-identifier">cdbsGcInterval</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">DiffTime</span><span>
</span><a name="line-130"></a><span>      </span><span class="hs-comment">-- ^ Batch all scheduled GCs so that at most one GC happens every</span><span>
</span><a name="line-131"></a><span>      </span><span class="hs-comment">-- 'cdbsGcInterval'.</span><span>
</span><a name="line-132"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbsBlockchainTime"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbsBlockchainTime"><span class="hs-identifier">cdbsBlockchainTime</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.BlockchainTime.API.html#BlockchainTime"><span class="hs-identifier hs-type">BlockchainTime</span></a><span> </span><a href="#local-6989586621679657504"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-133"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbsEncodeHeader"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbsEncodeHeader"><span class="hs-identifier">cdbsEncodeHeader</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Block.Abstract.html#Header"><span class="hs-identifier hs-type">Header</span></a><span> </span><a href="#local-6989586621679657505"><span class="hs-identifier hs-type">blk</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Encoding</span><span>
</span><a name="line-134"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="cdbsBlocksToAddSize"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#cdbsBlocksToAddSize"><span class="hs-identifier">cdbsBlocksToAddSize</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Word</span><span>
</span><a name="line-135"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-136"></a><span>
</span><a name="line-137"></a><span class="hs-comment">-- | Default arguments</span><span>
</span><a name="line-138"></a><span class="hs-comment">--</span><span>
</span><a name="line-139"></a><span class="hs-comment">-- The following fields must still be defined:</span><span>
</span><a name="line-140"></a><span class="hs-comment">--</span><span>
</span><a name="line-141"></a><span class="hs-comment">-- * 'cdbsTracer'</span><span>
</span><a name="line-142"></a><span class="hs-comment">-- * 'cdbsRegistry'</span><span>
</span><a name="line-143"></a><span class="hs-comment">-- * 'cdbsBlockchainTime'</span><span>
</span><a name="line-144"></a><span class="hs-comment">-- * 'cdbsEncodeHeader'</span><span>
</span><a name="line-145"></a><span class="hs-comment">--</span><span>
</span><a name="line-146"></a><span class="hs-comment">-- We a 'cdbsGcDelay' of 60 seconds and a 'cdbsGcInterval' of 10 seconds, this</span><span>
</span><a name="line-147"></a><span class="hs-comment">-- means (see the properties in &quot;Test.Ouroboros.Storage.ChainDB.GcSchedule&quot;):</span><span>
</span><a name="line-148"></a><span class="hs-comment">--</span><span>
</span><a name="line-149"></a><span class="hs-comment">-- * The length of the 'GcSchedule' queue is @&lt;= &#8968;gcDelay / gcInterval&#8969; + 1@,</span><span>
</span><a name="line-150"></a><span class="hs-comment">--   i.e., @&lt;= 7@.</span><span>
</span><a name="line-151"></a><span class="hs-comment">-- * The overlap (number of blocks in both the VolatileDB and the ImmutableDB)</span><span>
</span><a name="line-152"></a><span class="hs-comment">--   is the number of blocks synced in @gcDelay + gcInterval@ = 70s. E.g, when</span><span>
</span><a name="line-153"></a><span class="hs-comment">--   bulk syncing at 1k-2k blocks/s, this means 70k-140k blocks. During normal</span><span>
</span><a name="line-154"></a><span class="hs-comment">--   operation, we receive 1 block/20s (for Byron /and/ for Shelley), meaning</span><span>
</span><a name="line-155"></a><span class="hs-comment">--   at most 4 blocks.</span><span>
</span><a name="line-156"></a><span class="hs-comment">-- * The unnecessary overlap (the blocks that we haven't GC'ed yet but could</span><span>
</span><a name="line-157"></a><span class="hs-comment">--   have, because of batching) &lt; the number of blocks sync in @gcInterval@.</span><span>
</span><a name="line-158"></a><span class="hs-comment">--   E.g., when syncing at 1k-2k blocks/s, this means 10k-20k blocks. During</span><span>
</span><a name="line-159"></a><span class="hs-comment">--   normal operation, we receive 1 block/20s, meaning at most 1 block.</span><span>
</span><a name="line-160"></a><span class="hs-identifier">defaultSpecificArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbSpecificArgs"><span class="hs-identifier hs-type">ChainDbSpecificArgs</span></a><span> </span><a href="#local-6989586621679657522"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679657523"><span class="hs-identifier hs-type">blk</span></a><span>
</span><a name="line-161"></a><a name="defaultSpecificArgs"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#defaultSpecificArgs"><span class="hs-identifier">defaultSpecificArgs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbSpecificArgs"><span class="hs-identifier hs-var">ChainDbSpecificArgs</span></a><span class="hs-special">{</span><span>
</span><a name="line-162"></a><span>      </span><span class="hs-identifier">cdbsGcDelay</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">secondsToDiffTime</span><span> </span><span class="hs-number">60</span><span>
</span><a name="line-163"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbsGcInterval</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">secondsToDiffTime</span><span> </span><span class="hs-number">10</span><span>
</span><a name="line-164"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbsBlocksToAddSize</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">10</span><span>
</span><a name="line-165"></a><span>      </span><span class="hs-comment">-- Fields without a default</span><span>
</span><a name="line-166"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbsTracer</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;no default for cdbsTracer&quot;</span><span>
</span><a name="line-167"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbsRegistry</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;no default for cdbsRegistry&quot;</span><span>
</span><a name="line-168"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbsBlockchainTime</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;no default for cdbsBlockchainTime&quot;</span><span>
</span><a name="line-169"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbsEncodeHeader</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;no default for cdbsEncodeHeader&quot;</span><span>
</span><a name="line-170"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-171"></a><span>
</span><a name="line-172"></a><span class="hs-comment">-- | Default arguments for use within IO</span><span>
</span><a name="line-173"></a><span class="hs-comment">--</span><span>
</span><a name="line-174"></a><span class="hs-comment">-- See 'ImmDB.defaultArgs', 'VolDB.defaultArgs', 'LgrDB.defaultArgs', and</span><span>
</span><a name="line-175"></a><span class="hs-comment">-- 'defaultSpecificArgs' for a list of which fields are not given a default</span><span>
</span><a name="line-176"></a><span class="hs-comment">-- and must therefore be set explicitly.</span><span>
</span><a name="line-177"></a><span class="hs-identifier">defaultArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbArgs"><span class="hs-identifier hs-type">ChainDbArgs</span></a><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679657521"><span class="hs-identifier hs-type">blk</span></a><span>
</span><a name="line-178"></a><a name="defaultArgs"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#defaultArgs"><span class="hs-identifier">defaultArgs</span></a></a><span> </span><a name="local-6989586621679657524"><a href="#local-6989586621679657524"><span class="hs-identifier">fp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#toChainDbArgs"><span class="hs-identifier hs-var">toChainDbArgs</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.ImmDB.html#defaultArgs"><span class="hs-identifier hs-var">ImmDB.defaultArgs</span></a><span> </span><a href="#local-6989586621679657524"><span class="hs-identifier hs-var">fp</span></a><span class="hs-special">)</span><span>
</span><a name="line-179"></a><span>                               </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.VolDB.html#defaultArgs"><span class="hs-identifier hs-var">VolDB.defaultArgs</span></a><span> </span><a href="#local-6989586621679657524"><span class="hs-identifier hs-var">fp</span></a><span class="hs-special">)</span><span>
</span><a name="line-180"></a><span>                               </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.LgrDB.html#defaultArgs"><span class="hs-identifier hs-var">LgrDB.defaultArgs</span></a><span> </span><a href="#local-6989586621679657524"><span class="hs-identifier hs-var">fp</span></a><span class="hs-special">)</span><span>
</span><a name="line-181"></a><span>                               </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#defaultSpecificArgs"><span class="hs-identifier hs-var">defaultSpecificArgs</span></a><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span>
</span><a name="line-184"></a><span class="hs-comment">-- | Internal: split 'ChainDbArgs' into 'ImmDbArgs', 'VolDbArgs, 'LgrDbArgs',</span><span>
</span><a name="line-185"></a><span class="hs-comment">-- and 'ChainDbSpecificArgs'.</span><span>
</span><a name="line-186"></a><span class="hs-identifier">fromChainDbArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Block.Abstract.html#GetHeader"><span class="hs-identifier hs-type">GetHeader</span></a><span> </span><a href="#local-6989586621679657519"><span class="hs-identifier hs-type">blk</span></a><span>
</span><a name="line-187"></a><span>                </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbArgs"><span class="hs-identifier hs-type">ChainDbArgs</span></a><span> </span><a href="#local-6989586621679657520"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679657519"><span class="hs-identifier hs-type">blk</span></a><span>
</span><a name="line-188"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.ImmDB.html#ImmDbArgs"><span class="hs-identifier hs-type">ImmDB.ImmDbArgs</span></a><span>     </span><a href="#local-6989586621679657520"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679657519"><span class="hs-identifier hs-type">blk</span></a><span>
</span><a name="line-189"></a><span>                   </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.VolDB.html#VolDbArgs"><span class="hs-identifier hs-type">VolDB.VolDbArgs</span></a><span>     </span><a href="#local-6989586621679657520"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679657519"><span class="hs-identifier hs-type">blk</span></a><span>
</span><a name="line-190"></a><span>                   </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.LgrDB.html#LgrDbArgs"><span class="hs-identifier hs-type">LgrDB.LgrDbArgs</span></a><span>     </span><a href="#local-6989586621679657520"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679657519"><span class="hs-identifier hs-type">blk</span></a><span>
</span><a name="line-191"></a><span>                   </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbSpecificArgs"><span class="hs-identifier hs-type">ChainDbSpecificArgs</span></a><span> </span><a href="#local-6989586621679657520"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679657519"><span class="hs-identifier hs-type">blk</span></a><span>
</span><a name="line-192"></a><span>                   </span><span class="hs-special">)</span><span>
</span><a name="line-193"></a><a name="fromChainDbArgs"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#fromChainDbArgs"><span class="hs-identifier">fromChainDbArgs</span></a></a><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbArgs"><span class="hs-identifier hs-var">ChainDbArgs</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-194"></a><span>      </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.ImmDB.html#ImmDbArgs"><span class="hs-identifier hs-var">ImmDB.ImmDbArgs</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-195"></a><span>          </span><span class="hs-identifier">immDecodeHash</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657525"><span class="hs-identifier hs-var">cdbDecodeHash</span></a><span>
</span><a name="line-196"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">immDecodeBlock</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657526"><span class="hs-identifier hs-var">cdbDecodeBlock</span></a><span>
</span><a name="line-197"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">immDecodeHeader</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657527"><span class="hs-identifier hs-var">cdbDecodeHeader</span></a><span>
</span><a name="line-198"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">immEncodeHash</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657531"><span class="hs-identifier hs-var">cdbEncodeHash</span></a><span>
</span><a name="line-199"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">immEncodeBlock</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657532"><span class="hs-identifier hs-var">cdbEncodeBlock</span></a><span>
</span><a name="line-200"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">immChunkInfo</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657546"><span class="hs-identifier hs-var">cdbChunkInfo</span></a><span>
</span><a name="line-201"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">immHashInfo</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657547"><span class="hs-identifier hs-var">cdbHashInfo</span></a><span>
</span><a name="line-202"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">immValidation</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657540"><span class="hs-identifier hs-var">cdbImmValidation</span></a><span>
</span><a name="line-203"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">immIsEBB</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657548"><span class="hs-identifier hs-var">cdbIsEBB</span></a><span>
</span><a name="line-204"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">immCheckIntegrity</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657549"><span class="hs-identifier hs-var">cdbCheckIntegrity</span></a><span>
</span><a name="line-205"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">immHasFS</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657537"><span class="hs-identifier hs-var">cdbHasFSImmDb</span></a><span>
</span><a name="line-206"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">immTracer</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">contramap</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Types.html#TraceImmDBEvent"><span class="hs-identifier hs-var">TraceImmDBEvent</span></a><span> </span><a href="#local-6989586621679657554"><span class="hs-identifier hs-var">cdbTracer</span></a><span>
</span><a name="line-207"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">immAddHdrEnv</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657552"><span class="hs-identifier hs-var">cdbAddHdrEnv</span></a><span>
</span><a name="line-208"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">immCacheConfig</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657553"><span class="hs-identifier hs-var">cdbImmDbCacheConfig</span></a><span>
</span><a name="line-209"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">immRegistry</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657556"><span class="hs-identifier hs-var">cdbRegistry</span></a><span>
</span><a name="line-210"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-211"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.VolDB.html#VolDbArgs"><span class="hs-identifier hs-var">VolDB.VolDbArgs</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-212"></a><span>          </span><span class="hs-identifier">volHasFS</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657538"><span class="hs-identifier hs-var">cdbHasFSVolDb</span></a><span>
</span><a name="line-213"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">volCheckIntegrity</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657549"><span class="hs-identifier hs-var">cdbCheckIntegrity</span></a><span>
</span><a name="line-214"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">volBlocksPerFile</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657542"><span class="hs-identifier hs-var">cdbBlocksPerFile</span></a><span>
</span><a name="line-215"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">volDecodeHeader</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657527"><span class="hs-identifier hs-var">cdbDecodeHeader</span></a><span>
</span><a name="line-216"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">volDecodeBlock</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657526"><span class="hs-identifier hs-var">cdbDecodeBlock</span></a><span>
</span><a name="line-217"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">volEncodeBlock</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657532"><span class="hs-identifier hs-var">cdbEncodeBlock</span></a><span>
</span><a name="line-218"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">volAddHdrEnv</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657552"><span class="hs-identifier hs-var">cdbAddHdrEnv</span></a><span>
</span><a name="line-219"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">volValidation</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657541"><span class="hs-identifier hs-var">cdbVolValidation</span></a><span>
</span><a name="line-220"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">volTracer</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">contramap</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Types.html#TraceVolDBEvent"><span class="hs-identifier hs-var">TraceVolDBEvent</span></a><span> </span><a href="#local-6989586621679657554"><span class="hs-identifier hs-var">cdbTracer</span></a><span>
</span><a name="line-221"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">volIsEBB</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679657560"><a href="#local-6989586621679657560"><span class="hs-identifier">blk</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679657548"><span class="hs-identifier hs-var">cdbIsEBB</span></a><span> </span><span class="hs-special">(</span><a href="Ouroboros.Consensus.Block.Abstract.html#getHeader"><span class="hs-identifier hs-var">getHeader</span></a><span> </span><a href="#local-6989586621679657560"><span class="hs-identifier hs-var">blk</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-222"></a><span>                                          </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.Block.EBB.html#IsNotEBB"><span class="hs-identifier hs-var">IsNotEBB</span></a><span>
</span><a name="line-223"></a><span>                                          </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.Block.EBB.html#IsEBB"><span class="hs-identifier hs-var">IsEBB</span></a><span>
</span><a name="line-224"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-225"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.LgrDB.html#LgrDbArgs"><span class="hs-identifier hs-var">LgrDB.LgrDbArgs</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-226"></a><span>          </span><span class="hs-identifier">lgrTopLevelConfig</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657545"><span class="hs-identifier hs-var">cdbTopLevelConfig</span></a><span>
</span><a name="line-227"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lgrHasFS</span><span>                </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657539"><span class="hs-identifier hs-var">cdbHasFSLgrDB</span></a><span>
</span><a name="line-228"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lgrDecodeLedger</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657528"><span class="hs-identifier hs-var">cdbDecodeLedger</span></a><span>
</span><a name="line-229"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lgrDecodeConsensusState</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657530"><span class="hs-identifier hs-var">cdbDecodeConsensusState</span></a><span>
</span><a name="line-230"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lgrDecodeHash</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657525"><span class="hs-identifier hs-var">cdbDecodeHash</span></a><span>
</span><a name="line-231"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lgrDecodeTipInfo</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657529"><span class="hs-identifier hs-var">cdbDecodeTipInfo</span></a><span>
</span><a name="line-232"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lgrEncodeLedger</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657534"><span class="hs-identifier hs-var">cdbEncodeLedger</span></a><span>
</span><a name="line-233"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lgrEncodeConsensusState</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657536"><span class="hs-identifier hs-var">cdbEncodeConsensusState</span></a><span>
</span><a name="line-234"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lgrEncodeHash</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657531"><span class="hs-identifier hs-var">cdbEncodeHash</span></a><span>
</span><a name="line-235"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lgrEncodeTipInfo</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657535"><span class="hs-identifier hs-var">cdbEncodeTipInfo</span></a><span>
</span><a name="line-236"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lgrParams</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657543"><span class="hs-identifier hs-var">cdbParamsLgrDB</span></a><span>
</span><a name="line-237"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lgrDiskPolicy</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657544"><span class="hs-identifier hs-var">cdbDiskPolicy</span></a><span>
</span><a name="line-238"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lgrGenesis</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657550"><span class="hs-identifier hs-var">cdbGenesis</span></a><span>
</span><a name="line-239"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lgrTracer</span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">contramap</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Types.html#TraceLedgerEvent"><span class="hs-identifier hs-var">TraceLedgerEvent</span></a><span> </span><a href="#local-6989586621679657554"><span class="hs-identifier hs-var">cdbTracer</span></a><span>
</span><a name="line-240"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lgrTraceLedger</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657555"><span class="hs-identifier hs-var">cdbTraceLedger</span></a><span>
</span><a name="line-241"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-242"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbSpecificArgs"><span class="hs-identifier hs-var">ChainDbSpecificArgs</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-243"></a><span>          </span><span class="hs-identifier">cdbsTracer</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657554"><span class="hs-identifier hs-var">cdbTracer</span></a><span>
</span><a name="line-244"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbsRegistry</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657556"><span class="hs-identifier hs-var">cdbRegistry</span></a><span>
</span><a name="line-245"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbsGcDelay</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657557"><span class="hs-identifier hs-var">cdbGcDelay</span></a><span>
</span><a name="line-246"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbsGcInterval</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657558"><span class="hs-identifier hs-var">cdbGcInterval</span></a><span>
</span><a name="line-247"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbsBlockchainTime</span><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657551"><span class="hs-identifier hs-var">cdbBlockchainTime</span></a><span>
</span><a name="line-248"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbsEncodeHeader</span><span>    </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657533"><span class="hs-identifier hs-var">cdbEncodeHeader</span></a><span>
</span><a name="line-249"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbsBlocksToAddSize</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657559"><span class="hs-identifier hs-var">cdbBlocksToAddSize</span></a><span>
</span><a name="line-250"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-251"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-252"></a><span>
</span><a name="line-253"></a><span class="hs-comment">-- | Internal: construct 'ChainDbArgs' from 'ImmDbArgs', 'VolDbArgs,</span><span>
</span><a name="line-254"></a><span class="hs-comment">-- 'LgrDbArgs', and 'ChainDbSpecificArgs'.</span><span>
</span><a name="line-255"></a><span class="hs-comment">--</span><span>
</span><a name="line-256"></a><span class="hs-comment">-- Useful in 'defaultArgs'</span><span>
</span><a name="line-257"></a><span class="hs-identifier">toChainDbArgs</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.ImmDB.html#ImmDbArgs"><span class="hs-identifier hs-type">ImmDB.ImmDbArgs</span></a><span>     </span><a href="#local-6989586621679657517"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679657518"><span class="hs-identifier hs-type">blk</span></a><span>
</span><a name="line-258"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.VolDB.html#VolDbArgs"><span class="hs-identifier hs-type">VolDB.VolDbArgs</span></a><span>     </span><a href="#local-6989586621679657517"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679657518"><span class="hs-identifier hs-type">blk</span></a><span>
</span><a name="line-259"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.LgrDB.html#LgrDbArgs"><span class="hs-identifier hs-type">LgrDB.LgrDbArgs</span></a><span>     </span><a href="#local-6989586621679657517"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679657518"><span class="hs-identifier hs-type">blk</span></a><span>
</span><a name="line-260"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbSpecificArgs"><span class="hs-identifier hs-type">ChainDbSpecificArgs</span></a><span> </span><a href="#local-6989586621679657517"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679657518"><span class="hs-identifier hs-type">blk</span></a><span>
</span><a name="line-261"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbArgs"><span class="hs-identifier hs-type">ChainDbArgs</span></a><span>         </span><a href="#local-6989586621679657517"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679657518"><span class="hs-identifier hs-type">blk</span></a><span>
</span><a name="line-262"></a><a name="toChainDbArgs"><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#toChainDbArgs"><span class="hs-identifier">toChainDbArgs</span></a></a><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.ImmDB.html#ImmDbArgs"><span class="hs-identifier hs-var">ImmDB.ImmDbArgs</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span>
</span><a name="line-263"></a><span>              </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.VolDB.html#VolDbArgs"><span class="hs-identifier hs-var">VolDB.VolDbArgs</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span>
</span><a name="line-264"></a><span>              </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.LgrDB.html#LgrDbArgs"><span class="hs-identifier hs-var">LgrDB.LgrDbArgs</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span>
</span><a name="line-265"></a><span>              </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbSpecificArgs"><span class="hs-identifier hs-var">ChainDbSpecificArgs</span></a><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ouroboros.Consensus.Storage.ChainDB.Impl.Args.html#ChainDbArgs"><span class="hs-identifier hs-var">ChainDbArgs</span></a><span class="hs-special">{</span><span>
</span><a name="line-266"></a><span>      </span><span class="hs-comment">-- Decoders</span><span>
</span><a name="line-267"></a><span>      </span><span class="hs-identifier">cdbDecodeHash</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657561"><span class="hs-identifier hs-var">immDecodeHash</span></a><span>
</span><a name="line-268"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbDecodeBlock</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657562"><span class="hs-identifier hs-var">immDecodeBlock</span></a><span>
</span><a name="line-269"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbDecodeHeader</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657563"><span class="hs-identifier hs-var">immDecodeHeader</span></a><span>
</span><a name="line-270"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbDecodeLedger</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657588"><span class="hs-identifier hs-var">lgrDecodeLedger</span></a><span>
</span><a name="line-271"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbDecodeTipInfo</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657590"><span class="hs-identifier hs-var">lgrDecodeTipInfo</span></a><span>
</span><a name="line-272"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbDecodeConsensusState</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657591"><span class="hs-identifier hs-var">lgrDecodeConsensusState</span></a><span>
</span><a name="line-273"></a><span>      </span><span class="hs-comment">-- Encoders</span><span>
</span><a name="line-274"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbEncodeHash</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657564"><span class="hs-identifier hs-var">immEncodeHash</span></a><span>
</span><a name="line-275"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbEncodeBlock</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657565"><span class="hs-identifier hs-var">immEncodeBlock</span></a><span>
</span><a name="line-276"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbEncodeHeader</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657606"><span class="hs-identifier hs-var">cdbsEncodeHeader</span></a><span>
</span><a name="line-277"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbEncodeLedger</span><span>         </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657592"><span class="hs-identifier hs-var">lgrEncodeLedger</span></a><span>
</span><a name="line-278"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbEncodeTipInfo</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657594"><span class="hs-identifier hs-var">lgrEncodeTipInfo</span></a><span>
</span><a name="line-279"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbEncodeConsensusState</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657595"><span class="hs-identifier hs-var">lgrEncodeConsensusState</span></a><span>
</span><a name="line-280"></a><span>      </span><span class="hs-comment">-- HasFS instances</span><span>
</span><a name="line-281"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbHasFSImmDb</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657572"><span class="hs-identifier hs-var">immHasFS</span></a><span>
</span><a name="line-282"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbHasFSVolDb</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657576"><span class="hs-identifier hs-var">volHasFS</span></a><span>
</span><a name="line-283"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbHasFSLgrDB</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657587"><span class="hs-identifier hs-var">lgrHasFS</span></a><span>
</span><a name="line-284"></a><span>      </span><span class="hs-comment">-- Policy</span><span>
</span><a name="line-285"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbImmValidation</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657568"><span class="hs-identifier hs-var">immValidation</span></a><span>
</span><a name="line-286"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbVolValidation</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657584"><span class="hs-identifier hs-var">volValidation</span></a><span>
</span><a name="line-287"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbBlocksPerFile</span><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657578"><span class="hs-identifier hs-var">volBlocksPerFile</span></a><span>
</span><a name="line-288"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbParamsLgrDB</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657596"><span class="hs-identifier hs-var">lgrParams</span></a><span>
</span><a name="line-289"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbDiskPolicy</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657597"><span class="hs-identifier hs-var">lgrDiskPolicy</span></a><span>
</span><a name="line-290"></a><span>      </span><span class="hs-comment">-- Integration</span><span>
</span><a name="line-291"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbTopLevelConfig</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657586"><span class="hs-identifier hs-var">lgrTopLevelConfig</span></a><span>
</span><a name="line-292"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbChunkInfo</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657566"><span class="hs-identifier hs-var">immChunkInfo</span></a><span>
</span><a name="line-293"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbHashInfo</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657567"><span class="hs-identifier hs-var">immHashInfo</span></a><span>
</span><a name="line-294"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbIsEBB</span><span>                </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657569"><span class="hs-identifier hs-var">immIsEBB</span></a><span>
</span><a name="line-295"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbCheckIntegrity</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657570"><span class="hs-identifier hs-var">immCheckIntegrity</span></a><span>
</span><a name="line-296"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbGenesis</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657598"><span class="hs-identifier hs-var">lgrGenesis</span></a><span>
</span><a name="line-297"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbBlockchainTime</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657605"><span class="hs-identifier hs-var">cdbsBlockchainTime</span></a><span>
</span><a name="line-298"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbAddHdrEnv</span><span>            </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657571"><span class="hs-identifier hs-var">immAddHdrEnv</span></a><span>
</span><a name="line-299"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbImmDbCacheConfig</span><span>     </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657574"><span class="hs-identifier hs-var">immCacheConfig</span></a><span>
</span><a name="line-300"></a><span>      </span><span class="hs-comment">-- Misc</span><span>
</span><a name="line-301"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbTracer</span><span>               </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657601"><span class="hs-identifier hs-var">cdbsTracer</span></a><span>
</span><a name="line-302"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbTraceLedger</span><span>          </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657600"><span class="hs-identifier hs-var">lgrTraceLedger</span></a><span>
</span><a name="line-303"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbRegistry</span><span>             </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657575"><span class="hs-identifier hs-var">immRegistry</span></a><span>
</span><a name="line-304"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbGcDelay</span><span>              </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657603"><span class="hs-identifier hs-var">cdbsGcDelay</span></a><span>
</span><a name="line-305"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbGcInterval</span><span>           </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657604"><span class="hs-identifier hs-var">cdbsGcInterval</span></a><span>
</span><a name="line-306"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cdbBlocksToAddSize</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679657607"><span class="hs-identifier hs-var">cdbsBlocksToAddSize</span></a><span>
</span><a name="line-307"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-308"></a></pre></body></html>