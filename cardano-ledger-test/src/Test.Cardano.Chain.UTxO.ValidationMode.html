<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns    #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE TemplateHaskell   #-}</span><span>
</span><a name="line-4"></a><span>
</span><a name="line-5"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Test.Cardano.Chain.UTxO.ValidationMode</span><span>
</span><a name="line-6"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#tests"><span class="hs-identifier hs-var">tests</span></a><span>
</span><a name="line-7"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-8"></a><span class="hs-keyword">where</span><span>
</span><a name="line-9"></a><span>
</span><a name="line-10"></a><span class="hs-keyword">import</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-prelude-0.1.0.0/noopt/doc/html/cardano-prelude/src/Cardano.Prelude.html"><span class="hs-identifier">Cardano.Prelude</span></a><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-prelude-test-0.1.0.0/noopt/doc/html/cardano-prelude-test/src/Test.Cardano.Prelude.html"><span class="hs-identifier">Test.Cardano.Prelude</span></a><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">BS</span><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map.Strict</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">M</span><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Vector</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">V</span><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span class="hs-keyword">import</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-binary-1.5.0/noopt/doc/html/cardano-binary/src/Cardano.Binary.html"><span class="hs-identifier">Cardano.Binary</span></a><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-binary-1.5.0/noopt/doc/html/cardano-binary/src/Cardano.Binary.Annotated.html#Annotated"><span class="hs-identifier hs-type">Annotated</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-18"></a><span class="hs-keyword">import</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.Block.html"><span class="hs-identifier">Cardano.Chain.Block</span></a><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.Block.ValidationMode.html#BlockValidationMode"><span class="hs-identifier hs-type">BlockValidationMode</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-19"></a><span class="hs-keyword">import</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.Common.html"><span class="hs-identifier">Cardano.Chain.Common</span></a><span>
</span><a name="line-20"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.Common.TxFeePolicy.html#TxFeePolicy"><span class="hs-identifier hs-type">TxFeePolicy</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-21"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.Common.TxSizeLinear.html#calculateTxSizeLinear"><span class="hs-identifier hs-var">calculateTxSizeLinear</span></a><span>
</span><a name="line-22"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.Common.Lovelace.html#lovelaceToInteger"><span class="hs-identifier hs-var">lovelaceToInteger</span></a><span>
</span><a name="line-23"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.Update.html"><span class="hs-identifier">Cardano.Chain.Update</span></a><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.Update.ProtocolParameters.html#ProtocolParameters"><span class="hs-identifier hs-type">ProtocolParameters</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.html"><span class="hs-identifier">Cardano.Chain.UTxO</span></a><span>
</span><a name="line-26"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.TxAux.html#ATxAux"><span class="hs-identifier hs-type">ATxAux</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-27"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.Validation.html#Environment"><span class="hs-identifier hs-type">Environment</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-28"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.Tx.html#TxId"><span class="hs-identifier hs-type">TxId</span></a><span>
</span><a name="line-29"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.Validation.html#TxValidationError"><span class="hs-identifier hs-type">TxValidationError</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-30"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.ValidationMode.html#TxValidationMode"><span class="hs-identifier hs-type">TxValidationMode</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.Validation.html#UTxOValidationError"><span class="hs-identifier hs-type">UTxOValidationError</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-32"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.html"><span class="hs-identifier">Cardano.Chain.UTxO</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">UTxO</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.ValidationMode.html"><span class="hs-identifier">Cardano.Chain.ValidationMode</span></a><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.ValidationMode.html#ValidationMode"><span class="hs-identifier hs-type">ValidationMode</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-35"></a><span class="hs-keyword">import</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-crypto-wrapper-1.3.0/noopt/doc/html/cardano-crypto-wrapper/src/Cardano.Crypto.html"><span class="hs-identifier">Cardano.Crypto</span></a><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-crypto-wrapper-1.3.0/noopt/doc/html/cardano-crypto-wrapper/src/Cardano.Crypto.ProtocolMagic.html#getProtocolMagicId"><span class="hs-identifier hs-var">getProtocolMagicId</span></a><span class="hs-special">)</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Hedgehog</span><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Hedgehog.Gen</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Gen</span><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Hedgehog.Range</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Range</span><span>
</span><a name="line-40"></a><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/byron-spec-ledger-0.1.0.0/noopt/doc/html/byron-spec-ledger/src/Byron.Spec.Ledger.Core.html"><span class="hs-identifier">Byron.Spec.Ledger.Core</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Abstract</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/byron-spec-ledger-0.1.0.0/noopt/doc/html/byron-spec-ledger/src/Byron.Spec.Ledger.Core.Generators.html"><span class="hs-identifier">Byron.Spec.Ledger.Core.Generators</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Abstract</span><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/byron-spec-ledger-0.1.0.0/noopt/doc/html/byron-spec-ledger/src/Byron.Spec.Ledger.Update.html"><span class="hs-identifier">Byron.Spec.Ledger.Update</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Abstract</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/byron-spec-ledger-0.1.0.0/noopt/doc/html/byron-spec-ledger/src/Byron.Spec.Ledger.Update.Generators.html"><span class="hs-identifier">Byron.Spec.Ledger.Update.Generators</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Abstract</span><span>
</span><a name="line-45"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/byron-spec-ledger-0.1.0.0/noopt/doc/html/byron-spec-ledger/src/Byron.Spec.Ledger.UTxO.html"><span class="hs-identifier">Byron.Spec.Ledger.UTxO</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Abstract</span><span>
</span><a name="line-46"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/byron-spec-ledger-0.1.0.0/noopt/doc/html/byron-spec-ledger/src/Byron.Spec.Ledger.UTxO.Generators.html"><span class="hs-identifier">Byron.Spec.Ledger.UTxO.Generators</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Abstract</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span> </span><a href="Test.Cardano.Chain.Elaboration.Update.html"><span class="hs-identifier">Test.Cardano.Chain.Elaboration.Update</span></a><span> </span><span class="hs-special">(</span><a href="Test.Cardano.Chain.Elaboration.Update.html#elaboratePParams"><span class="hs-identifier hs-var">elaboratePParams</span></a><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><a href="Test.Cardano.Chain.Elaboration.UTxO.html"><span class="hs-identifier">Test.Cardano.Chain.Elaboration.UTxO</span></a><span> </span><span class="hs-special">(</span><a href="Test.Cardano.Chain.Elaboration.UTxO.html#elaborateTxBS"><span class="hs-identifier hs-var">elaborateTxBS</span></a><span class="hs-special">)</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><a href="Test.Cardano.Chain.UTxO.Gen.html"><span class="hs-identifier">Test.Cardano.Chain.UTxO.Gen</span></a><span> </span><span class="hs-special">(</span><a href="Test.Cardano.Chain.UTxO.Gen.html#genVKWitness"><span class="hs-identifier hs-var">genVKWitness</span></a><span class="hs-special">)</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><a href="Test.Cardano.Chain.UTxO.Model.html"><span class="hs-identifier">Test.Cardano.Chain.UTxO.Model</span></a><span> </span><span class="hs-special">(</span><a href="Test.Cardano.Chain.UTxO.Model.html#elaborateInitialUTxO"><span class="hs-identifier hs-var">elaborateInitialUTxO</span></a><span class="hs-special">)</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-crypto-test-1.3.0/noopt/doc/html/cardano-crypto-test/src/Test.Cardano.Crypto.Dummy.html"><span class="hs-identifier">Test.Cardano.Crypto.Dummy</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Dummy</span><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><a href="Test.Options.html"><span class="hs-identifier">Test.Options</span></a><span> </span><span class="hs-special">(</span><a href="Test.Options.html#TSGroup"><span class="hs-identifier hs-type">TSGroup</span></a><span class="hs-special">,</span><span> </span><a href="Test.Options.html#TSProperty"><span class="hs-identifier hs-type">TSProperty</span></a><span class="hs-special">,</span><span> </span><a href="Test.Options.html#withTestsTS"><span class="hs-identifier hs-var">withTestsTS</span></a><span class="hs-special">)</span><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-56"></a><span class="hs-comment">-- TxValidationMode Properties</span><span>
</span><a name="line-57"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span class="hs-comment">-- | Property: When calling 'updateUTxO' given a valid transaction, 'UTxO'</span><span>
</span><a name="line-60"></a><span class="hs-comment">-- validation should pass in all 'TxValidationMode's.</span><span>
</span><a name="line-61"></a><span class="hs-identifier">ts_prop_updateUTxO_Valid</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Test.Options.html#TSProperty"><span class="hs-identifier hs-type">TSProperty</span></a><span>
</span><a name="line-62"></a><a name="ts_prop_updateUTxO_Valid"><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#ts_prop_updateUTxO_Valid"><span class="hs-identifier">ts_prop_updateUTxO_Valid</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-63"></a><span>  </span><a href="Test.Options.html#withTestsTS"><span class="hs-identifier hs-var">withTestsTS</span></a><span> </span><span class="hs-number">300</span><span>
</span><a name="line-64"></a><span>    </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">property</span><span>
</span><a name="line-65"></a><span>    </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-66"></a><span>      </span><span class="hs-comment">-- Generate abstract `PParamsAddrsAndUTxO`</span><span>
</span><a name="line-67"></a><span>      </span><a name="local-6989586621679277478"><a href="#local-6989586621679277478"><span class="hs-identifier">ppau</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#PParamsAddrsAndUTxO"><span class="hs-identifier hs-var">PParamsAddrsAndUTxO</span></a><span> </span><a name="local-6989586621679277479"><a href="#local-6989586621679277479"><span class="hs-identifier">abstractPparams</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679277480"><a href="#local-6989586621679277480"><span class="hs-identifier">abstractUtxo</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-68"></a><span>        </span><span class="hs-identifier hs-var">forAll</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#genPParamsAddrsAndUTxO"><span class="hs-identifier hs-var">genPParamsAddrsAndUTxO</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Range.constant</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">5</span><span class="hs-special">)</span><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><span>      </span><span class="hs-comment">-- Elaborate abstract values to concrete.</span><span>
</span><a name="line-71"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679277481"><a href="#local-6989586621679277481"><span class="hs-identifier">pparams</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Test.Cardano.Chain.Elaboration.Update.html#elaboratePParams"><span class="hs-identifier hs-var">elaboratePParams</span></a><span> </span><a href="#local-6989586621679277479"><span class="hs-identifier hs-var">abstractPparams</span></a><span>
</span><a name="line-72"></a><span>          </span><span class="hs-special">(</span><a name="local-6989586621679277482"><a href="#local-6989586621679277482"><span class="hs-identifier">utxo</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679277483"><a href="#local-6989586621679277483"><span class="hs-identifier">txIdMap</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Test.Cardano.Chain.UTxO.Model.html#elaborateInitialUTxO"><span class="hs-identifier hs-var">elaborateInitialUTxO</span></a><span> </span><a href="#local-6989586621679277480"><span class="hs-identifier hs-var">abstractUtxo</span></a><span>
</span><a name="line-73"></a><span>
</span><a name="line-74"></a><span>      </span><span class="hs-comment">-- Generate abstract transaction and elaborate.</span><span>
</span><a name="line-75"></a><span>      </span><a name="local-6989586621679277484"><a href="#local-6989586621679277484"><span class="hs-identifier">abstractTxWits</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">forAll</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#genValidTxWits"><span class="hs-identifier hs-var">genValidTxWits</span></a><span> </span><a href="#local-6989586621679277478"><span class="hs-identifier hs-var">ppau</span></a><span> </span><a href="#local-6989586621679277483"><span class="hs-identifier hs-var">txIdMap</span></a><span>
</span><a name="line-76"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679277485"><a href="#local-6989586621679277485"><span class="hs-identifier">tx</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Test.Cardano.Chain.Elaboration.UTxO.html#elaborateTxBS"><span class="hs-identifier hs-var">elaborateTxBS</span></a><span>
</span><a name="line-77"></a><span>            </span><span class="hs-special">(</span><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#elaborateTxId"><span class="hs-identifier hs-var">elaborateTxId</span></a><span> </span><a href="#local-6989586621679277483"><span class="hs-identifier hs-var">txIdMap</span></a><span class="hs-special">)</span><span>
</span><a name="line-78"></a><span>            </span><a href="#local-6989586621679277484"><span class="hs-identifier hs-var">abstractTxWits</span></a><span>
</span><a name="line-79"></a><span>
</span><a name="line-80"></a><span>      </span><span class="hs-comment">-- Validate the generated concrete transaction</span><span>
</span><a name="line-81"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679277486"><a href="#local-6989586621679277486"><span class="hs-identifier">pm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-crypto-test-1.3.0/noopt/doc/html/cardano-crypto-test/src/Test.Cardano.Crypto.Dummy.html#aProtocolMagic"><span class="hs-identifier hs-var">Dummy.aProtocolMagic</span></a><span>
</span><a name="line-82"></a><span>          </span><a name="local-6989586621679277487"><a href="#local-6989586621679277487"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.Validation.html#Environment"><span class="hs-identifier hs-var">Environment</span></a><span> </span><a href="#local-6989586621679277486"><span class="hs-identifier hs-var">pm</span></a><span> </span><a href="#local-6989586621679277481"><span class="hs-identifier hs-var">pparams</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.UTxOConfiguration.html#defaultUTxOConfiguration"><span class="hs-identifier hs-var">UTxO.defaultUTxOConfiguration</span></a><span>
</span><a name="line-83"></a><span>      </span><a name="local-6989586621679277488"><a href="#local-6989586621679277488"><span class="hs-identifier">vMode</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">forAll</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.ValidationMode.html#ValidationMode"><span class="hs-identifier hs-var">ValidationMode</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.Block.ValidationMode.html#BlockValidation"><span class="hs-identifier hs-var">BlockValidation</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#genValidationMode"><span class="hs-identifier hs-var">genValidationMode</span></a><span>
</span><a name="line-84"></a><span>      </span><a name="local-6989586621679277489"><a href="#local-6989586621679277489"><span class="hs-identifier">updateRes</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier">runReaderT</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679277488"><span class="hs-identifier hs-var">vMode</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">runExceptT</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-85"></a><span>        </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.Validation.html#updateUTxO"><span class="hs-identifier hs-var">UTxO.updateUTxO</span></a><span> </span><a href="#local-6989586621679277487"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679277482"><span class="hs-identifier hs-var">utxo</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679277485"><span class="hs-identifier hs-var">tx</span></a><span class="hs-special">]</span><span>
</span><a name="line-86"></a><span>      </span><span class="hs-identifier hs-var">void</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">evalEither</span><span> </span><a href="#local-6989586621679277489"><span class="hs-identifier hs-var">updateRes</span></a><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span class="hs-comment">-- | Property: When calling 'updateUTxO' given a valid transaction with an</span><span>
</span><a name="line-89"></a><span class="hs-comment">-- invalid witness, 'UTxO' validation should pass in both the</span><span>
</span><a name="line-90"></a><span class="hs-comment">-- 'TxValidationNoCrypto' and 'NoTxValidation' modes. This is because neither</span><span>
</span><a name="line-91"></a><span class="hs-comment">-- of these modes verify the cryptographic integrity of a transaction.</span><span>
</span><a name="line-92"></a><span class="hs-identifier">ts_prop_updateUTxO_InvalidWit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Test.Options.html#TSProperty"><span class="hs-identifier hs-type">TSProperty</span></a><span>
</span><a name="line-93"></a><a name="ts_prop_updateUTxO_InvalidWit"><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#ts_prop_updateUTxO_InvalidWit"><span class="hs-identifier">ts_prop_updateUTxO_InvalidWit</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-94"></a><span>  </span><a href="Test.Options.html#withTestsTS"><span class="hs-identifier hs-var">withTestsTS</span></a><span> </span><span class="hs-number">300</span><span>
</span><a name="line-95"></a><span>    </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">property</span><span>
</span><a name="line-96"></a><span>    </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-97"></a><span>      </span><span class="hs-comment">-- Generate abstract `PParamsAddrsAndUTxO`</span><span>
</span><a name="line-98"></a><span>      </span><a name="local-6989586621679277492"><a href="#local-6989586621679277492"><span class="hs-identifier">ppau</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#PParamsAddrsAndUTxO"><span class="hs-identifier hs-var">PParamsAddrsAndUTxO</span></a><span> </span><a name="local-6989586621679277493"><a href="#local-6989586621679277493"><span class="hs-identifier">abstractPparams</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679277494"><a href="#local-6989586621679277494"><span class="hs-identifier">abstractUtxo</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><a name="line-99"></a><span>        </span><span class="hs-identifier hs-var">forAll</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#genPParamsAddrsAndUTxO"><span class="hs-identifier hs-var">genPParamsAddrsAndUTxO</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Range.constant</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">5</span><span class="hs-special">)</span><span>
</span><a name="line-100"></a><span>
</span><a name="line-101"></a><span>      </span><span class="hs-comment">-- Elaborate abstract values to concrete.</span><span>
</span><a name="line-102"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679277495"><a href="#local-6989586621679277495"><span class="hs-identifier">pparams</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Test.Cardano.Chain.Elaboration.Update.html#elaboratePParams"><span class="hs-identifier hs-var">elaboratePParams</span></a><span> </span><a href="#local-6989586621679277493"><span class="hs-identifier hs-var">abstractPparams</span></a><span>
</span><a name="line-103"></a><span>          </span><span class="hs-special">(</span><a name="local-6989586621679277496"><a href="#local-6989586621679277496"><span class="hs-identifier">utxo</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679277497"><a href="#local-6989586621679277497"><span class="hs-identifier">txIdMap</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Test.Cardano.Chain.UTxO.Model.html#elaborateInitialUTxO"><span class="hs-identifier hs-var">elaborateInitialUTxO</span></a><span> </span><a href="#local-6989586621679277494"><span class="hs-identifier hs-var">abstractUtxo</span></a><span>
</span><a name="line-104"></a><span>
</span><a name="line-105"></a><span>      </span><span class="hs-comment">-- Generate abstract transaction and elaborate.</span><span>
</span><a name="line-106"></a><span>      </span><a name="local-6989586621679277498"><a href="#local-6989586621679277498"><span class="hs-identifier">abstractTxWits</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">forAll</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#genValidTxWits"><span class="hs-identifier hs-var">genValidTxWits</span></a><span> </span><a href="#local-6989586621679277492"><span class="hs-identifier hs-var">ppau</span></a><span> </span><a href="#local-6989586621679277497"><span class="hs-identifier hs-var">txIdMap</span></a><span>
</span><a name="line-107"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679277499"><a href="#local-6989586621679277499"><span class="hs-identifier">tx</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Test.Cardano.Chain.Elaboration.UTxO.html#elaborateTxBS"><span class="hs-identifier hs-var">elaborateTxBS</span></a><span>
</span><a name="line-108"></a><span>            </span><span class="hs-special">(</span><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#elaborateTxId"><span class="hs-identifier hs-var">elaborateTxId</span></a><span> </span><a href="#local-6989586621679277497"><span class="hs-identifier hs-var">txIdMap</span></a><span class="hs-special">)</span><span>
</span><a name="line-109"></a><span>            </span><a href="#local-6989586621679277498"><span class="hs-identifier hs-var">abstractTxWits</span></a><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span>      </span><span class="hs-comment">-- Generate an invalid 'TxWitness' and utilize it in the valid</span><span>
</span><a name="line-112"></a><span>      </span><span class="hs-comment">-- transaction generated above.</span><span>
</span><a name="line-113"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679277500"><a href="#local-6989586621679277500"><span class="hs-identifier">pm</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-crypto-test-1.3.0/noopt/doc/html/cardano-crypto-test/src/Test.Cardano.Crypto.Dummy.html#aProtocolMagic"><span class="hs-identifier hs-var">Dummy.aProtocolMagic</span></a><span>
</span><a name="line-114"></a><span>      </span><a name="local-6989586621679277501"><a href="#local-6989586621679277501"><span class="hs-identifier">invalidWitness</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">forAll</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-115"></a><span>        </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-binary-1.5.0/noopt/doc/html/cardano-binary/src/Cardano.Binary.Annotated.html#Annotated"><span class="hs-identifier hs-var">Annotated</span></a><span>
</span><a name="line-116"></a><span>          </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">V.fromList</span><span>
</span><a name="line-117"></a><span>                </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">Gen.list</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Range.linear</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-number">10</span><span class="hs-special">)</span><span>
</span><a name="line-118"></a><span>                             </span><span class="hs-special">(</span><a href="Test.Cardano.Chain.UTxO.Gen.html#genVKWitness"><span class="hs-identifier hs-var">genVKWitness</span></a><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-crypto-wrapper-1.3.0/noopt/doc/html/cardano-crypto-wrapper/src/Cardano.Crypto.ProtocolMagic.html#getProtocolMagicId"><span class="hs-identifier hs-var">getProtocolMagicId</span></a><span> </span><a href="#local-6989586621679277500"><span class="hs-identifier hs-var">pm</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-119"></a><span>              </span><span class="hs-special">)</span><span>
</span><a name="line-120"></a><span>          </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-prelude-test-0.1.0.0/noopt/doc/html/cardano-prelude-test/src/Test.Cardano.Prelude.Gen.html#genBytes"><span class="hs-identifier hs-var">genBytes</span></a><span> </span><span class="hs-number">32</span><span>
</span><a name="line-121"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679277502"><a href="#local-6989586621679277502"><span class="hs-identifier">txInvalidWit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679277499"><span class="hs-identifier hs-var">tx</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">aTaWitness</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679277501"><span class="hs-identifier hs-var">invalidWitness</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-122"></a><span>
</span><a name="line-123"></a><span>      </span><span class="hs-comment">-- Validate the generated concrete transaction</span><span>
</span><a name="line-124"></a><span>      </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679277503"><a href="#local-6989586621679277503"><span class="hs-identifier">env</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.Validation.html#Environment"><span class="hs-identifier hs-var">Environment</span></a><span> </span><a href="#local-6989586621679277500"><span class="hs-identifier hs-var">pm</span></a><span> </span><a href="#local-6989586621679277495"><span class="hs-identifier hs-var">pparams</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.UTxOConfiguration.html#defaultUTxOConfiguration"><span class="hs-identifier hs-var">UTxO.defaultUTxOConfiguration</span></a><span>
</span><a name="line-125"></a><span>      </span><a name="local-6989586621679277504"><a href="#local-6989586621679277504"><span class="hs-identifier">vMode</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">forAll</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.ValidationMode.html#ValidationMode"><span class="hs-identifier hs-var">ValidationMode</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.Block.ValidationMode.html#BlockValidation"><span class="hs-identifier hs-var">BlockValidation</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#genValidationMode"><span class="hs-identifier hs-var">genValidationMode</span></a><span>
</span><a name="line-126"></a><span>      </span><a name="local-6989586621679277505"><a href="#local-6989586621679277505"><span class="hs-identifier">updateRes</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier">runReaderT</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679277504"><span class="hs-identifier hs-var">vMode</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">runExceptT</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-127"></a><span>        </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.Validation.html#updateUTxO"><span class="hs-identifier hs-var">UTxO.updateUTxO</span></a><span> </span><a href="#local-6989586621679277503"><span class="hs-identifier hs-var">env</span></a><span> </span><a href="#local-6989586621679277496"><span class="hs-identifier hs-var">utxo</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679277502"><span class="hs-identifier hs-var">txInvalidWit</span></a><span class="hs-special">]</span><span>
</span><a name="line-128"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679277505"><span class="hs-identifier hs-var">updateRes</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-129"></a><span>        </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679277506"><a href="#local-6989586621679277506"><span class="hs-identifier">err</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679277490"><span class="hs-identifier hs-var">isInvalidWitnessError</span></a><span> </span><a href="#local-6989586621679277506"><span class="hs-identifier hs-var">err</span></a><span>
</span><a name="line-130"></a><span>                        </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">txValidationMode</span><span> </span><a href="#local-6989586621679277504"><span class="hs-identifier hs-var">vMode</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.ValidationMode.html#TxValidation"><span class="hs-identifier hs-var">TxValidation</span></a><span>
</span><a name="line-131"></a><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">success</span><span>
</span><a name="line-132"></a><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">failure</span><span>
</span><a name="line-133"></a><span>        </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">txValidationMode</span><span> </span><a href="#local-6989586621679277504"><span class="hs-identifier hs-var">vMode</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.ValidationMode.html#TxValidation"><span class="hs-identifier hs-var">TxValidation</span></a><span>
</span><a name="line-134"></a><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">failure</span><span>
</span><a name="line-135"></a><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">success</span><span>
</span><a name="line-136"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-137"></a><span>  </span><span class="hs-identifier">isInvalidWitnessError</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.Validation.html#UTxOValidationError"><span class="hs-identifier hs-type">UTxOValidationError</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-138"></a><span>  </span><a name="local-6989586621679277490"><a href="#local-6989586621679277490"><span class="hs-identifier">isInvalidWitnessError</span></a></a><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.Validation.html#UTxOValidationTxValidationError"><span class="hs-identifier hs-var">UTxOValidationTxValidationError</span></a><span> </span><a name="local-6989586621679277491"><a href="#local-6989586621679277491"><span class="hs-identifier">err</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679277491"><span class="hs-identifier hs-var">err</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-139"></a><span>    </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.Validation.html#TxValidationWitnessWrongSignature"><span class="hs-identifier hs-var">TxValidationWitnessWrongSignature</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-140"></a><span>    </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.Validation.html#TxValidationWitnessWrongKey"><span class="hs-identifier hs-var">TxValidationWitnessWrongKey</span></a><span class="hs-special">{</span><span class="hs-special">}</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-141"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-142"></a><span>  </span><span class="hs-identifier">isInvalidWitnessError</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-143"></a><span>
</span><a name="line-144"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-145"></a><span class="hs-comment">-- Generators</span><span>
</span><a name="line-146"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-147"></a><span>
</span><a name="line-148"></a><span class="hs-identifier">genAbstractAddrs</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Range</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Gen</span><span> </span><span class="hs-special">[</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/byron-spec-ledger-0.1.0.0/noopt/doc/html/byron-spec-ledger/src/Byron.Spec.Ledger.Core.html#Addr"><span class="hs-identifier hs-type">Abstract.Addr</span></a><span class="hs-special">]</span><span>
</span><a name="line-149"></a><a name="genAbstractAddrs"><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#genAbstractAddrs"><span class="hs-identifier">genAbstractAddrs</span></a></a><span> </span><a name="local-6989586621679277507"><a href="#local-6989586621679277507"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Gen.list</span><span> </span><a href="#local-6989586621679277507"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/byron-spec-ledger-0.1.0.0/noopt/doc/html/byron-spec-ledger/src/Byron.Spec.Ledger.Core.Generators.html#addrGen"><span class="hs-identifier hs-var">Abstract.addrGen</span></a><span>
</span><a name="line-150"></a><span>
</span><a name="line-151"></a><span class="hs-identifier">genInitialAbstractUTxO</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/byron-spec-ledger-0.1.0.0/noopt/doc/html/byron-spec-ledger/src/Byron.Spec.Ledger.Core.html#Addr"><span class="hs-identifier hs-type">Abstract.Addr</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Gen</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/byron-spec-ledger-0.1.0.0/noopt/doc/html/byron-spec-ledger/src/Byron.Spec.Ledger.UTxO.html#UTxO"><span class="hs-identifier hs-type">Abstract.UTxO</span></a><span>
</span><a name="line-152"></a><a name="genInitialAbstractUTxO"><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#genInitialAbstractUTxO"><span class="hs-identifier">genInitialAbstractUTxO</span></a></a><span> </span><a name="local-6989586621679277508"><a href="#local-6989586621679277508"><span class="hs-identifier">addrs</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-153"></a><span>  </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/byron-spec-ledger-0.1.0.0/noopt/doc/html/byron-spec-ledger/src/Byron.Spec.Ledger.UTxO.html#fromTxOuts"><span class="hs-identifier hs-var">Abstract.fromTxOuts</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/byron-spec-ledger-0.1.0.0/noopt/doc/html/byron-spec-ledger/src/Byron.Spec.Ledger.UTxO.Generators.html#genInitialTxOuts"><span class="hs-identifier hs-var">Abstract.genInitialTxOuts</span></a><span> </span><a href="#local-6989586621679277508"><span class="hs-identifier hs-var">addrs</span></a><span>
</span><a name="line-154"></a><span>
</span><a name="line-155"></a><span class="hs-identifier">genPParamsAddrsAndUTxO</span><span>
</span><a name="line-156"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Range</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-157"></a><span>  </span><span class="hs-comment">-- ^ Range for generation of 'Abstract.Addr's.</span><span>
</span><a name="line-158"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Gen</span><span> </span><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#PParamsAddrsAndUTxO"><span class="hs-identifier hs-type">PParamsAddrsAndUTxO</span></a><span>
</span><a name="line-159"></a><a name="genPParamsAddrsAndUTxO"><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#genPParamsAddrsAndUTxO"><span class="hs-identifier">genPParamsAddrsAndUTxO</span></a></a><span> </span><a name="local-6989586621679277509"><a href="#local-6989586621679277509"><span class="hs-identifier">addrRange</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-160"></a><span>  </span><a name="local-6989586621679277510"><a href="#local-6989586621679277510"><span class="hs-identifier">abstractPparams</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/byron-spec-ledger-0.1.0.0/noopt/doc/html/byron-spec-ledger/src/Byron.Spec.Ledger.Update.Generators.html#pparamsGen"><span class="hs-identifier hs-var">Abstract.pparamsGen</span></a><span>
</span><a name="line-161"></a><span>  </span><a name="local-6989586621679277511"><a href="#local-6989586621679277511"><span class="hs-identifier">abstractAddrs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#genAbstractAddrs"><span class="hs-identifier hs-var">genAbstractAddrs</span></a><span> </span><a href="#local-6989586621679277509"><span class="hs-identifier hs-var">addrRange</span></a><span>
</span><a name="line-162"></a><span>  </span><a name="local-6989586621679277512"><a href="#local-6989586621679277512"><span class="hs-identifier">abstractUtxo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#genInitialAbstractUTxO"><span class="hs-identifier hs-var">genInitialAbstractUTxO</span></a><span> </span><a href="#local-6989586621679277511"><span class="hs-identifier hs-var">abstractAddrs</span></a><span>
</span><a name="line-163"></a><span>  </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#PParamsAddrsAndUTxO"><span class="hs-identifier hs-var">PParamsAddrsAndUTxO</span></a><span> </span><a href="#local-6989586621679277510"><span class="hs-identifier hs-var">abstractPparams</span></a><span> </span><a href="#local-6989586621679277511"><span class="hs-identifier hs-var">abstractAddrs</span></a><span> </span><a href="#local-6989586621679277512"><span class="hs-identifier hs-var">abstractUtxo</span></a><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span class="hs-identifier">genValidTxWits</span><span>
</span><a name="line-166"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#PParamsAddrsAndUTxO"><span class="hs-identifier hs-type">PParamsAddrsAndUTxO</span></a><span>
</span><a name="line-167"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/byron-spec-ledger-0.1.0.0/noopt/doc/html/byron-spec-ledger/src/Byron.Spec.Ledger.UTxO.html#TxId"><span class="hs-identifier hs-type">Abstract.TxId</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.Tx.html#TxId"><span class="hs-identifier hs-type">TxId</span></a><span>
</span><a name="line-168"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Gen</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/byron-spec-ledger-0.1.0.0/noopt/doc/html/byron-spec-ledger/src/Byron.Spec.Ledger.UTxO.html#Tx"><span class="hs-identifier hs-type">Abstract.Tx</span></a><span>
</span><a name="line-169"></a><a name="genValidTxWits"><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#genValidTxWits"><span class="hs-identifier">genValidTxWits</span></a></a><span> </span><a name="local-6989586621679277513"><a href="#local-6989586621679277513"><span class="hs-identifier">ppau</span></a></a><span> </span><a name="local-6989586621679277514"><a href="#local-6989586621679277514"><span class="hs-identifier">txIdMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-170"></a><span>  </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/byron-spec-ledger-0.1.0.0/noopt/doc/html/byron-spec-ledger/src/Byron.Spec.Ledger.UTxO.Generators.html#genTxFromUTxO"><span class="hs-identifier hs-var">Abstract.genTxFromUTxO</span></a><span>
</span><a name="line-171"></a><span>    </span><a href="#local-6989586621679277516"><span class="hs-identifier hs-var">ppauAddrs</span></a><span>
</span><a name="line-172"></a><span>    </span><span class="hs-special">(</span><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#abstractTxFee"><span class="hs-identifier hs-var">abstractTxFee</span></a><span> </span><a href="#local-6989586621679277514"><span class="hs-identifier hs-var">txIdMap</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">ppTxFeePolicy</span><span> </span><a href="#local-6989586621679277518"><span class="hs-identifier hs-var">pparams</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-173"></a><span>    </span><a href="#local-6989586621679277517"><span class="hs-identifier hs-var">ppauUTxO</span></a><span>
</span><a name="line-174"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-175"></a><span>  </span><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#PParamsAddrsAndUTxO"><span class="hs-identifier hs-var">PParamsAddrsAndUTxO</span></a><span>
</span><a name="line-176"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="local-6989586621679277515"><a href="#local-6989586621679277515"><span class="hs-identifier">ppauPParams</span></a></a><span>
</span><a name="line-177"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679277516"><a href="#local-6989586621679277516"><span class="hs-identifier">ppauAddrs</span></a></a><span>
</span><a name="line-178"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="local-6989586621679277517"><a href="#local-6989586621679277517"><span class="hs-identifier">ppauUTxO</span></a></a><span>
</span><a name="line-179"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679277513"><span class="hs-identifier hs-var">ppau</span></a><span>
</span><a name="line-180"></a><span>
</span><a name="line-181"></a><span>  </span><a name="local-6989586621679277518"><a href="#local-6989586621679277518"><span class="hs-identifier">pparams</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Test.Cardano.Chain.Elaboration.Update.html#elaboratePParams"><span class="hs-identifier hs-var">elaboratePParams</span></a><span> </span><a href="#local-6989586621679277515"><span class="hs-identifier hs-var">ppauPParams</span></a><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span class="hs-identifier">genValidationMode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Gen</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.ValidationMode.html#TxValidationMode"><span class="hs-identifier hs-type">TxValidationMode</span></a><span>
</span><a name="line-184"></a><a name="genValidationMode"><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#genValidationMode"><span class="hs-identifier">genValidationMode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Gen.element</span><span>
</span><a name="line-185"></a><span>  </span><span class="hs-special">[</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.ValidationMode.html#TxValidation"><span class="hs-identifier hs-var">TxValidation</span></a><span>
</span><a name="line-186"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.ValidationMode.html#TxValidationNoCrypto"><span class="hs-identifier hs-var">TxValidationNoCrypto</span></a><span>
</span><a name="line-187"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.ValidationMode.html#NoTxValidation"><span class="hs-identifier hs-var">NoTxValidation</span></a><span>
</span><a name="line-188"></a><span>  </span><span class="hs-special">]</span><span>
</span><a name="line-189"></a><span>
</span><a name="line-190"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-191"></a><span class="hs-comment">-- Helpers</span><span>
</span><a name="line-192"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-193"></a><span>
</span><a name="line-194"></a><span class="hs-keyword">data</span><span> </span><a name="PParamsAddrsAndUTxO"><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#PParamsAddrsAndUTxO"><span class="hs-identifier">PParamsAddrsAndUTxO</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="PParamsAddrsAndUTxO"><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#PParamsAddrsAndUTxO"><span class="hs-identifier">PParamsAddrsAndUTxO</span></a></a><span>
</span><a name="line-195"></a><span>  </span><span class="hs-special">{</span><span> </span><a name="ppauPParams"><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#ppauPParams"><span class="hs-identifier">ppauPParams</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/byron-spec-ledger-0.1.0.0/noopt/doc/html/byron-spec-ledger/src/Byron.Spec.Ledger.Update.html#PParams"><span class="hs-identifier hs-type">Abstract.PParams</span></a><span>
</span><a name="line-196"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="ppauAddrs"><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#ppauAddrs"><span class="hs-identifier">ppauAddrs</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/byron-spec-ledger-0.1.0.0/noopt/doc/html/byron-spec-ledger/src/Byron.Spec.Ledger.Core.html#Addr"><span class="hs-identifier hs-type">Abstract.Addr</span></a><span class="hs-special">]</span><span>
</span><a name="line-197"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="ppauUTxO"><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#ppauUTxO"><span class="hs-identifier">ppauUTxO</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/byron-spec-ledger-0.1.0.0/noopt/doc/html/byron-spec-ledger/src/Byron.Spec.Ledger.UTxO.html#UTxO"><span class="hs-identifier hs-type">Abstract.UTxO</span></a><span>
</span><a name="line-198"></a><span>  </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span class="hs-comment">-- | Elaborate an 'Abstract.Tx', calculate the 'Concrete.Lovelace' fee, then</span><span>
</span><a name="line-201"></a><span class="hs-comment">-- convert back to an 'Abstract.Lovelace'.</span><span>
</span><a name="line-202"></a><span class="hs-comment">-- n.b. Calculating the fee with 'Abstract.pcMinFee', for example, proved to</span><span>
</span><a name="line-203"></a><span class="hs-comment">-- be ineffective as it utilizes the 'Abstract.Size' of the 'Abstract.Tx' in</span><span>
</span><a name="line-204"></a><span class="hs-comment">-- its calculation when we really need to take into account the actual</span><span>
</span><a name="line-205"></a><span class="hs-comment">-- concrete size in bytes.</span><span>
</span><a name="line-206"></a><span class="hs-identifier">abstractTxFee</span><span>
</span><a name="line-207"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/byron-spec-ledger-0.1.0.0/noopt/doc/html/byron-spec-ledger/src/Byron.Spec.Ledger.UTxO.html#TxId"><span class="hs-identifier hs-type">Abstract.TxId</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.Tx.html#TxId"><span class="hs-identifier hs-type">UTxO.TxId</span></a><span>
</span><a name="line-208"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.Common.TxFeePolicy.html#TxFeePolicy"><span class="hs-identifier hs-type">TxFeePolicy</span></a><span>
</span><a name="line-209"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/byron-spec-ledger-0.1.0.0/noopt/doc/html/byron-spec-ledger/src/Byron.Spec.Ledger.UTxO.html#Tx"><span class="hs-identifier hs-type">Abstract.Tx</span></a><span>
</span><a name="line-210"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/byron-spec-ledger-0.1.0.0/noopt/doc/html/byron-spec-ledger/src/Byron.Spec.Ledger.Core.html#Lovelace"><span class="hs-identifier hs-type">Abstract.Lovelace</span></a><span>
</span><a name="line-211"></a><a name="abstractTxFee"><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#abstractTxFee"><span class="hs-identifier">abstractTxFee</span></a></a><span> </span><a name="local-6989586621679277519"><a href="#local-6989586621679277519"><span class="hs-identifier">txIdMap</span></a></a><span> </span><a name="local-6989586621679277520"><a href="#local-6989586621679277520"><span class="hs-identifier">tfp</span></a></a><span> </span><a name="local-6989586621679277521"><a href="#local-6989586621679277521"><span class="hs-identifier">aTx</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-212"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.TxAux.html#ATxAux"><span class="hs-identifier hs-var">ATxAux</span></a><span> </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-binary-1.5.0/noopt/doc/html/cardano-binary/src/Cardano.Binary.Annotated.html#Annotated"><span class="hs-identifier hs-var">Annotated</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679277522"><a href="#local-6989586621679277522"><span class="hs-identifier">txBytes</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Test.Cardano.Chain.Elaboration.UTxO.html#elaborateTxBS"><span class="hs-identifier hs-var">elaborateTxBS</span></a><span>
</span><a name="line-213"></a><span>        </span><span class="hs-special">(</span><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#elaborateTxId"><span class="hs-identifier hs-var">elaborateTxId</span></a><span> </span><a href="#local-6989586621679277519"><span class="hs-identifier hs-var">txIdMap</span></a><span class="hs-special">)</span><span>
</span><a name="line-214"></a><span>        </span><a href="#local-6989586621679277521"><span class="hs-identifier hs-var">aTx</span></a><span>
</span><a name="line-215"></a><span>      </span><a name="local-6989586621679277523"><a href="#local-6989586621679277523"><span class="hs-identifier">cLovelace</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679277520"><span class="hs-identifier hs-var">tfp</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-216"></a><span>        </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.Common.TxFeePolicy.html#TxFeePolicyTxSizeLinear"><span class="hs-identifier hs-var">TxFeePolicyTxSizeLinear</span></a><span> </span><a name="local-6989586621679277524"><a href="#local-6989586621679277524"><span class="hs-identifier">txSizeLinear</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-217"></a><span>          </span><span class="hs-identifier hs-var">either</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">show</span><span class="hs-special">)</span><span>
</span><a name="line-218"></a><span>                  </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679277525"><a href="#local-6989586621679277525"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679277525"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-219"></a><span>                  </span><span class="hs-special">(</span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.Common.TxSizeLinear.html#calculateTxSizeLinear"><span class="hs-identifier hs-var">calculateTxSizeLinear</span></a><span>
</span><a name="line-220"></a><span>                    </span><a href="#local-6989586621679277524"><span class="hs-identifier hs-var">txSizeLinear</span></a><span>
</span><a name="line-221"></a><span>                    </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">BS.length</span><span> </span><a href="#local-6989586621679277522"><span class="hs-identifier hs-var">txBytes</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-222"></a><span>  </span><span class="hs-comment">-- Add an extra lovelace to the fee to compensate for rounding errors</span><span>
</span><a name="line-223"></a><span>  </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/byron-spec-ledger-0.1.0.0/noopt/doc/html/byron-spec-ledger/src/Byron.Spec.Ledger.Core.html#Lovelace"><span class="hs-identifier hs-var">Abstract.Lovelace</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.Common.Lovelace.html#lovelaceToInteger"><span class="hs-identifier hs-var">lovelaceToInteger</span></a><span> </span><a href="#local-6989586621679277523"><span class="hs-identifier hs-var">cLovelace</span></a><span class="hs-special">)</span><span>
</span><a name="line-224"></a><span>
</span><a name="line-225"></a><span class="hs-identifier">elaborateTxId</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/byron-spec-ledger-0.1.0.0/noopt/doc/html/byron-spec-ledger/src/Byron.Spec.Ledger.UTxO.html#TxId"><span class="hs-identifier hs-type">Abstract.TxId</span></a><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.Tx.html#TxId"><span class="hs-identifier hs-type">UTxO.TxId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/byron-spec-ledger-0.1.0.0/noopt/doc/html/byron-spec-ledger/src/Byron.Spec.Ledger.UTxO.html#TxId"><span class="hs-identifier hs-type">Abstract.TxId</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="file:///__w/ouroboros-network/ouroboros-network/dist-newstyle/build/x86_64-linux/ghc-8.6.5/cardano-ledger-0.1.0.0/noopt/doc/html/cardano-ledger/src/Cardano.Chain.UTxO.Tx.html#TxId"><span class="hs-identifier hs-type">TxId</span></a><span>
</span><a name="line-226"></a><a name="elaborateTxId"><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#elaborateTxId"><span class="hs-identifier">elaborateTxId</span></a></a><span> </span><a name="local-6989586621679277526"><a href="#local-6989586621679277526"><span class="hs-identifier">txIdMap</span></a></a><span> </span><a name="local-6989586621679277527"><a href="#local-6989586621679277527"><span class="hs-identifier">abstractTxId</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-227"></a><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">M.lookup</span><span> </span><a href="#local-6989586621679277527"><span class="hs-identifier hs-var">abstractTxId</span></a><span> </span><a href="#local-6989586621679277526"><span class="hs-identifier hs-var">txIdMap</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-228"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">panic</span><span> </span><span class="hs-string">&quot;elaborateTxId: Missing abstract TxId during elaboration&quot;</span><span>
</span><a name="line-229"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679277528"><a href="#local-6989586621679277528"><span class="hs-identifier">x</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679277528"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-230"></a><span>
</span><a name="line-231"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-232"></a><span class="hs-comment">-- Main Test Export</span><span>
</span><a name="line-233"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-234"></a><span>
</span><a name="line-235"></a><span class="hs-identifier">tests</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Test.Options.html#TSGroup"><span class="hs-identifier hs-type">TSGroup</span></a><span>
</span><a name="line-236"></a><a name="tests"><a href="Test.Cardano.Chain.UTxO.ValidationMode.html#tests"><span class="hs-identifier">tests</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="">$$discoverPropArg</span><span>
</span><a name="line-237"></a></pre></body></html>